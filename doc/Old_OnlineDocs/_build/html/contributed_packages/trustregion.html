

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Trust Region Framework Method Solver &mdash; Pyomo 6.5.1.dev0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="MC++ Interface" href="mcpp.html" />
    <link rel="prev" title="Sensitivity Toolbox" href="sensitivity_toolbox.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Pyomo
          

          
          </a>

          
            
            
              <div class="version">
                6.5.1.dev0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../citing_pyomo.html">Citing Pyomo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyomo_overview/index.html">Pyomo Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyomo_modeling_components/index.html">Pyomo Modeling Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../solving_pyomo_models.html">Solving Pyomo Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../working_models.html">Working with Pyomo Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../working_abstractmodels/index.html">Working with Abstract Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../model_transformations/index.html">Model Transformations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modeling_extensions/index.html">Modeling Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial_examples.html">Pyomo Tutorial Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../model_debugging/index.html">Debugging Pyomo Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced_topics/index.html">Advanced Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../errors.html">Common Warnings/Errors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer_reference/index.html">Developer Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../library_reference/index.html">Library Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribution_guide.html">Contributing to Pyomo</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Third-Party Contributions</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="community.html">Community Detection for Pyomo models</a></li>
<li class="toctree-l2"><a class="reference internal" href="doe/doe.html">Pyomo.DoE</a></li>
<li class="toctree-l2"><a class="reference internal" href="gdpopt.html">GDPopt logic-based solver</a></li>
<li class="toctree-l2"><a class="reference internal" href="iis.html">Infeasible Irreducible System (IIS) Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="incidence/index.html">Incidence Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="mindtpy.html">MindtPy Solver</a></li>
<li class="toctree-l2"><a class="reference internal" href="mpc/index.html">MPC</a></li>
<li class="toctree-l2"><a class="reference internal" href="multistart.html">Multistart Solver</a></li>
<li class="toctree-l2"><a class="reference internal" href="preprocessing.html">Nonlinear Preprocessing Transformations</a></li>
<li class="toctree-l2"><a class="reference internal" href="parmest/index.html">Parameter Estimation with <code class="docutils literal notranslate"><span class="pre">parmest</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="pynumero/index.html">PyNumero</a></li>
<li class="toctree-l2"><a class="reference internal" href="pyros.html">PyROS Solver</a></li>
<li class="toctree-l2"><a class="reference internal" href="sensitivity_toolbox.html">Sensitivity Toolbox</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Trust Region Framework Method Solver</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#methodology-overview">Methodology Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#trf-inputs">TRF Inputs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#trf-solver-interface">TRF Solver Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="#trf-usage-example">TRF Usage Example</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#step-0-import-pyomo">Step 0: Import Pyomo</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-1-define-the-external-function-and-its-gradient">Step 1: Define the external function and its gradient</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-2-create-the-model">Step 2: Create the model</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-3-solve-with-trf">Step 3: Solve with TRF</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="mcpp.html">MC++ Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="satsolver.html">z3 SMT Sat Solver Interface</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../related_packages.html">Related Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bibliography.html">Bibliography</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Pyomo</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Third-Party Contributions</a> &raquo;</li>
        
      <li>Trust Region Framework Method Solver</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/contributed_packages/trustregion.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="trust-region-framework-method-solver">
<h1>Trust Region Framework Method Solver<a class="headerlink" href="#trust-region-framework-method-solver" title="Permalink to this headline">Â¶</a></h1>
<p>The Trust Region Framework (TRF) method solver allows users to solve hybrid
glass box/black box optimization problems in which parts of the system are
modeled with open, equation-based models and parts of the system are black
boxes. This method utilizes surrogate models that substitute high-fidelity
models with low-fidelity basis functions, thus avoiding the direct implementation
of the large, computationally expensive high-fidelity models. This is done
iteratively, resulting in fewer calls to the computationally expensive functions.</p>
<p>This module implements the method from Yoshio &amp; Biegler
[<a class="reference external" href="https://doi.org/10.1002/aic.17054">Yoshio &amp; Biegler, 2021</a>] and represents a rewrite of the original 2018
implementation of the algorithm from Eason &amp; Biegler [<a class="reference external" href="https://doi.org/10.1002/aic.16364">Eason &amp; Biegler, 2018</a>].</p>
<p>In the context of this updated module, black box functions are implemented as
Pyomo External Functions.</p>
<p>This work was conducted as part of the Institute for the Design of Advanced
Energy Systems (<a class="reference external" href="https://idaes.org">IDAES</a>) with support through the
Simulation-Based Engineering, Crosscutting Research Program within the U.S.
Department of Energyâs Office of Fossil Energy and Carbon Management.</p>
<div class="section" id="methodology-overview">
<h2>Methodology Overview<a class="headerlink" href="#methodology-overview" title="Permalink to this headline">Â¶</a></h2>
<p>The formulation of the original hybrid problem is:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align*}
\displaystyle \min_{} &amp; ~~ f\left(z, w, d\left(w\right)\right) &amp; \\
\displaystyle \text{s.t.} \quad \: &amp; ~~ h\left(z, w, d\left(w\right)\right) = 0 \\
\displaystyle &amp; ~~ g\left(z, w, d\left(w\right)\right) \leq 0
\end{align*}\end{split}\]</div>
<p>where:</p>
<ul class="simple">
<li><span class="math notranslate nohighlight">\(w \in \mathbb{R}^m\)</span> are the inputs to the external functions</li>
<li><span class="math notranslate nohighlight">\(z \in \mathbb{R}^n\)</span> are the remaining decision variables (i.e., degrees of freedom)</li>
<li><span class="math notranslate nohighlight">\(d(w) : \mathbb{R}^m \to \mathbb{R}^p\)</span> are the outputs of the external functions as a function of <span class="math notranslate nohighlight">\(w\)</span></li>
<li><span class="math notranslate nohighlight">\(f\)</span>, <cite>h</cite>, <cite>g</cite>, <cite>d</cite> are all assumed to be twice continuously differentiable</li>
</ul>
<p>This formulation is reworked to separate all external function information as
follows to enable the usage of the trust region method:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align*}
\displaystyle \min_{x} &amp; ~~ f\left(x\right) &amp; \\
\displaystyle \text{s.t.} \quad \: &amp; ~~ h\left(x\right) = 0 \\
\displaystyle &amp; ~~ g\left(x\right) \leq 0 \\
\displaystyle &amp; ~~ y = d\left(w\right)
\end{align*}\end{split}\]</div>
<p>where:</p>
<ul class="simple">
<li><span class="math notranslate nohighlight">\(y \in \mathbb{R}^p\)</span> are the outputs of the external functions</li>
<li><span class="math notranslate nohighlight">\(x^T = [w^T, y^T, z^T]\)</span> is a set of all inputs and outputs</li>
</ul>
<p>Using this formulation and a user-supplied low-fidelity/ideal model basis function
<span class="math notranslate nohighlight">\(b\left(w\right)\)</span>, the algorithm iteratively solves subproblems using
the surrogate model:</p>
<div class="math notranslate nohighlight">
\[\begin{align*}
r_k\left(w\right) = b\left(w\right) + \left( d\left(w_k\right) - b\left(w_k\right) \right) + \left( \nabla d\left(w_k\right) - \nabla b\left(w_k\right) \right)^T \left( w - w_k \right)
\end{align*}\]</div>
<p>This acts similarly to Newtonâs method in that small, incremental steps are taken
towards an optimal solution. At each iteration, the current solution of the
subproblem is compared to the previous solution to ensure that
the iteration has moved in a direction towards an optimal solution. If not true,
the step is rejected. If true, the step is accepted and the surrogate
model is updated for the next iteration.</p>
<p>When using TRF, please consider citing the above papers.</p>
</div>
<div class="section" id="trf-inputs">
<h2>TRF Inputs<a class="headerlink" href="#trf-inputs" title="Permalink to this headline">Â¶</a></h2>
<p>The required inputs to the TRF
<a class="reference internal" href="#pyomo.contrib.trustregion.TRF.TrustRegionSolver.solve" title="pyomo.contrib.trustregion.TRF.TrustRegionSolver.solve"><code class="xref py py-meth docutils literal notranslate"><span class="pre">solve</span></code></a>
method are the following:</p>
<ul class="simple">
<li>The optimization model</li>
<li>List of degree of freedom variables within the model</li>
</ul>
<p>The optional input to the TRF
<a class="reference internal" href="#pyomo.contrib.trustregion.TRF.TrustRegionSolver.solve" title="pyomo.contrib.trustregion.TRF.TrustRegionSolver.solve"><code class="xref py py-meth docutils literal notranslate"><span class="pre">solve</span></code></a>
method is the following:</p>
<ul class="simple">
<li>The external function surrogate model rule (âbasis functionâ)</li>
</ul>
</div>
<div class="section" id="trf-solver-interface">
<h2>TRF Solver Interface<a class="headerlink" href="#trf-solver-interface" title="Permalink to this headline">Â¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The keyword arguments can be updated at solver instantiation or later when the <code class="docutils literal notranslate"><span class="pre">solve</span></code> method is called.</p>
</div>
<dl class="py class">
<dt id="pyomo.contrib.trustregion.TRF.TrustRegionSolver">
<em class="property">class </em><code class="descclassname">pyomo.contrib.trustregion.TRF.</code><code class="descname">TrustRegionSolver</code><span class="sig-paren">(</span><em><span class="o">**</span><span class="n">kwds</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pyomo/contrib/trustregion/TRF.html#TrustRegionSolver"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyomo.contrib.trustregion.TRF.TrustRegionSolver" title="Permalink to this definition">Â¶</a></dt>
<dd><p>The Trust Region Solver is a âsolverâ based on the 2016/2018/2020 AiChE
papers by Eason (2016/2018), Yoshio (2020), and Biegler.</p>
<dl class="py method">
<dt id="pyomo.contrib.trustregion.TRF.TrustRegionSolver.solve">
<code class="descname">solve</code><span class="sig-paren">(</span><em><span class="n">model</span></em>, <em><span class="n">degrees_of_freedom_variables</span></em>, <em><span class="n">ext_fcn_surrogate_map_rule</span><span class="o">=</span><span class="default_value">None</span></em>, <em><span class="o">**</span><span class="n">kwds</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pyomo/contrib/trustregion/TRF.html#TrustRegionSolver.solve"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pyomo.contrib.trustregion.TRF.TrustRegionSolver.solve" title="Permalink to this definition">Â¶</a></dt>
<dd><p>This method calls the TRF algorithm.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>model</strong> (<a class="reference internal" href="../library_reference/aml/index.html#pyomo.environ.ConcreteModel" title="pyomo.environ.ConcreteModel"><em>ConcreteModel</em></a>) â The model to be solved using the Trust Region Framework.</li>
<li><strong>degrees_of_freedom_variables</strong> (<em>List</em><em>[</em><a class="reference internal" href="../library_reference/aml/index.html#pyomo.environ.Var" title="pyomo.environ.Var"><em>Var</em></a><em>]</em>) â User-supplied input. The user must provide a list of vars which
are the degrees of freedom or decision variables within
the model.</li>
<li><strong>ext_fcn_surrogate_map_rule</strong> (<em>Function</em><em>, </em><em>optional</em>) â In the 2020 Yoshio/Biegler paper, this is referred to as
the basis function <cite>b(w)</cite>.
This is the low-fidelity model with which to solve the original
process model problem and which is integrated into the
surrogate model.
The default is 0 (i.e., no basis function rule.)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">Keyword Arguments:</th></tr>
<tr class="field-even field"><td>&#160;</td><td class="field-body"><ul class="first last simple">
<li><strong>solver</strong> (<em>default='ipopt'</em>) â Solver to use. Default = <code class="docutils literal notranslate"><span class="pre">ipopt</span></code>.</li>
<li><strong>keepfiles</strong> (<a class="reference internal" href="../library_reference/common/config.html#pyomo.common.config.Bool" title="pyomo.common.config.Bool"><em>Bool</em></a><em>, </em><em>default=False</em>) â Optional. Whether or not to write files of sub-problems for use in
debugging. Default = False.</li>
<li><strong>tee</strong> (<a class="reference internal" href="../library_reference/common/config.html#pyomo.common.config.Bool" title="pyomo.common.config.Bool"><em>Bool</em></a><em>, </em><em>default=False</em>) â Optional. Sets the <code class="docutils literal notranslate"><span class="pre">tee</span></code> for sub-solver(s) utilized. Default =
False.</li>
<li><strong>verbose</strong> (<a class="reference internal" href="../library_reference/common/config.html#pyomo.common.config.Bool" title="pyomo.common.config.Bool"><em>Bool</em></a><em>, </em><em>default=False</em>) â Optional. When True, print each iterationâs relevant information to
the console as well as to the log. Default = False.</li>
<li><strong>trust_radius</strong> (<a class="reference internal" href="../library_reference/common/config.html#pyomo.common.config.PositiveFloat" title="pyomo.common.config.PositiveFloat"><em>PositiveFloat</em></a><em>, </em><em>default=1.0</em>) â Initial trust region radius <code class="docutils literal notranslate"><span class="pre">delta_0</span></code>. Default = 1.0.</li>
<li><strong>minimum_radius</strong> (<a class="reference internal" href="../library_reference/common/config.html#pyomo.common.config.PositiveFloat" title="pyomo.common.config.PositiveFloat"><em>PositiveFloat</em></a><em>, </em><em>default=1e-06</em>) â Minimum allowed trust region radius <code class="docutils literal notranslate"><span class="pre">delta_min</span></code>. Default = 1e-6.</li>
<li><strong>maximum_radius</strong> (<a class="reference internal" href="../library_reference/common/config.html#pyomo.common.config.PositiveFloat" title="pyomo.common.config.PositiveFloat"><em>PositiveFloat</em></a><em>, </em><em>default=100.0</em>) â Maximum allowed trust region radius. If trust region radius reaches
maximum allowed, solver will exit. Default = 100 * trust_radius.</li>
<li><strong>maximum_iterations</strong> (<a class="reference internal" href="../library_reference/common/config.html#pyomo.common.config.PositiveInt" title="pyomo.common.config.PositiveInt"><em>PositiveInt</em></a><em>, </em><em>default=50</em>) â Maximum allowed number of iterations. Default = 50.</li>
<li><strong>feasibility_termination</strong> (<a class="reference internal" href="../library_reference/common/config.html#pyomo.common.config.PositiveFloat" title="pyomo.common.config.PositiveFloat"><em>PositiveFloat</em></a><em>, </em><em>default=1e-05</em>) â Feasibility measure termination tolerance <code class="docutils literal notranslate"><span class="pre">epsilon_theta</span></code>. Default =
1e-5.</li>
<li><strong>step_size_termination</strong> (<a class="reference internal" href="../library_reference/common/config.html#pyomo.common.config.PositiveFloat" title="pyomo.common.config.PositiveFloat"><em>PositiveFloat</em></a><em>, </em><em>default=1e-05</em>) â Step size termination tolerance <code class="docutils literal notranslate"><span class="pre">epsilon_s</span></code>. Matches the feasibility
termination tolerance by default.</li>
<li><strong>minimum_feasibility</strong> (<a class="reference internal" href="../library_reference/common/config.html#pyomo.common.config.PositiveFloat" title="pyomo.common.config.PositiveFloat"><em>PositiveFloat</em></a><em>, </em><em>default=0.0001</em>) â Minimum feasibility measure <code class="docutils literal notranslate"><span class="pre">theta_min</span></code>. Default = 1e-4.</li>
<li><strong>switch_condition_kappa_theta</strong> (<a class="reference internal" href="../library_reference/common/config.html#pyomo.common.config.In" title="pyomo.common.config.In"><em>In</em></a><em>(</em><em>0..1</em><em>)</em><em>, </em><em>default=0.1</em>) â Switching condition parameter <code class="docutils literal notranslate"><span class="pre">kappa_theta</span></code>. Contained in open set
(0, 1). Default = 0.1.</li>
<li><strong>switch_condition_gamma_s</strong> (<a class="reference internal" href="../library_reference/common/config.html#pyomo.common.config.PositiveFloat" title="pyomo.common.config.PositiveFloat"><em>PositiveFloat</em></a><em>, </em><em>default=2.0</em>) â Switching condition parameter <code class="docutils literal notranslate"><span class="pre">gamma_s</span></code>. Must satisfy: <code class="docutils literal notranslate"><span class="pre">gamma_s</span> <span class="pre">&gt;</span>
<span class="pre">1/(1+mu)</span></code> where <code class="docutils literal notranslate"><span class="pre">mu</span></code> is contained in set (0, 1]. Default = 2.0.</li>
<li><strong>radius_update_param_gamma_c</strong> (<a class="reference internal" href="../library_reference/common/config.html#pyomo.common.config.In" title="pyomo.common.config.In"><em>In</em></a><em>(</em><em>0..1</em><em>)</em><em>, </em><em>default=0.5</em>) â Lower trust region update parameter <code class="docutils literal notranslate"><span class="pre">gamma_c</span></code>. Default = 0.5.</li>
<li><strong>radius_update_param_gamma_e</strong> (<a class="reference internal" href="../library_reference/common/config.html#pyomo.common.config.In" title="pyomo.common.config.In"><em>In</em></a><em>[</em><em>1..inf</em><em>]</em><em>, </em><em>default=2.5</em>) â Upper trust region update parameter <code class="docutils literal notranslate"><span class="pre">gamma_e</span></code>. Default = 2.5.</li>
<li><strong>ratio_test_param_eta_1</strong> (<a class="reference internal" href="../library_reference/common/config.html#pyomo.common.config.In" title="pyomo.common.config.In"><em>In</em></a><em>(</em><em>0..1</em><em>)</em><em>, </em><em>default=0.05</em>) â Lower ratio test parameter <code class="docutils literal notranslate"><span class="pre">eta_1</span></code>. Must satisfy: <code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">&lt;</span> <span class="pre">eta_1</span> <span class="pre">&lt;=</span>
<span class="pre">eta_2</span> <span class="pre">&lt;</span> <span class="pre">1</span></code>. Default = 0.05.</li>
<li><strong>ratio_test_param_eta_2</strong> (<a class="reference internal" href="../library_reference/common/config.html#pyomo.common.config.In" title="pyomo.common.config.In"><em>In</em></a><em>(</em><em>0..1</em><em>)</em><em>, </em><em>default=0.2</em>) â Lower ratio test parameter <code class="docutils literal notranslate"><span class="pre">eta_2</span></code>. Must satisfy: <code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">&lt;</span> <span class="pre">eta_1</span> <span class="pre">&lt;=</span>
<span class="pre">eta_2</span> <span class="pre">&lt;</span> <span class="pre">1</span></code>. Default = 0.2.</li>
<li><strong>maximum_feasibility</strong> (<a class="reference internal" href="../library_reference/common/config.html#pyomo.common.config.PositiveFloat" title="pyomo.common.config.PositiveFloat"><em>PositiveFloat</em></a><em>, </em><em>default=50.0</em>) â Maximum allowable feasibility measure <code class="docutils literal notranslate"><span class="pre">theta_max</span></code>. Parameter for use
in filter method.Default = 50.0.</li>
<li><strong>param_filter_gamma_theta</strong> (<a class="reference internal" href="../library_reference/common/config.html#pyomo.common.config.In" title="pyomo.common.config.In"><em>In</em></a><em>(</em><em>0..1</em><em>)</em><em>, </em><em>default=0.01</em>) â Fixed filter parameter <code class="docutils literal notranslate"><span class="pre">gamma_theta</span></code> within (0, 1). Default = 0.01</li>
<li><strong>param_filter_gamma_f</strong> (<a class="reference internal" href="../library_reference/common/config.html#pyomo.common.config.In" title="pyomo.common.config.In"><em>In</em></a><em>(</em><em>0..1</em><em>)</em><em>, </em><em>default=0.01</em>) â Fixed filter parameter <code class="docutils literal notranslate"><span class="pre">gamma_f</span></code> within (0, 1). Default = 0.01</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="trf-usage-example">
<h2>TRF Usage Example<a class="headerlink" href="#trf-usage-example" title="Permalink to this headline">Â¶</a></h2>
<p>Two examples can be found in the <a class="reference external" href="https://github.com/Pyomo/pyomo/tree/main/pyomo/contrib/trustregion/examples">examples</a> subdirectory. One of them is
implemented below.</p>
<div class="section" id="step-0-import-pyomo">
<h3>Step 0: Import Pyomo<a class="headerlink" href="#step-0-import-pyomo" title="Permalink to this headline">Â¶</a></h3>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># === Required imports ===</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pyomo.environ</span> <span class="k">as</span> <span class="nn">pyo</span>
</pre></div>
</div>
</div>
<div class="section" id="step-1-define-the-external-function-and-its-gradient">
<h3>Step 1: Define the external function and its gradient<a class="headerlink" href="#step-1-define-the-external-function-and-its-gradient" title="Permalink to this headline">Â¶</a></h3>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># === Define a &#39;black box&#39; function and its gradient ===</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">ext_fcn</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">pyo</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">grad_ext_fcn</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">fixed</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">args</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="p">[</span> <span class="n">pyo</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">),</span> <span class="o">-</span><span class="n">pyo</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span> <span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="step-2-create-the-model">
<h3>Step 2: Create the model<a class="headerlink" href="#step-2-create-the-model" title="Permalink to this headline">Â¶</a></h3>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># === Construct the Pyomo model object ===</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">create_model</span><span class="p">():</span>
<span class="gp">... </span>    <span class="n">m</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">ConcreteModel</span><span class="p">()</span>
<span class="gp">... </span>    <span class="n">m</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Example 1: Eason&#39;</span>
<span class="gp">... </span>    <span class="n">m</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">Reals</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="mf">2.</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">m</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">initialize</span><span class="o">=</span><span class="mf">2.</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="n">m</span><span class="o">.</span><span class="n">ext_fcn</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">ExternalFunction</span><span class="p">(</span><span class="n">ext_fcn</span><span class="p">,</span> <span class="n">grad_ext_fcn</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="n">m</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Objective</span><span class="p">(</span>
<span class="gp">... </span>        <span class="n">expr</span><span class="o">=</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">m</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> \
<span class="gp">... </span>           <span class="o">+</span> <span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span><span class="o">**</span><span class="mi">4</span> <span class="o">+</span> <span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span><span class="o">**</span><span class="mi">6</span>
<span class="gp">... </span>    <span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="n">m</span><span class="o">.</span><span class="n">c1</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span>
<span class="gp">... </span>        <span class="n">expr</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="n">ext_fcn</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span><span class="o">*</span><span class="n">pyo</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span>
<span class="gp">... </span>        <span class="p">)</span>
<span class="gp">... </span>    <span class="n">m</span><span class="o">.</span><span class="n">c2</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">4</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">8</span><span class="o">+</span><span class="n">pyo</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="p">))</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">m</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">create_model</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="step-3-solve-with-trf">
<h3>Step 3: Solve with TRF<a class="headerlink" href="#step-3-solve-with-trf" title="Permalink to this headline">Â¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Reminder from earlier that the <code class="docutils literal notranslate"><span class="pre">solve</span></code> method requires the user pass the model and a list of variables
which represent the degrees of freedom in the model. The user may also pass
a low-fidelity/ideal model (or âbasis functionâ) to this method to improve
convergence.</p>
</div>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># === Instantiate the TRF solver object ===</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">trf_solver</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">SolverFactory</span><span class="p">(</span><span class="s1">&#39;trustregion&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># === Solve with TRF ===</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">trf_solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">model</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">model</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
<span class="go">EXIT: Optimal solution found.</span>
<span class="gp">...</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="#pyomo.contrib.trustregion.TRF.TrustRegionSolver.solve" title="pyomo.contrib.trustregion.TRF.TrustRegionSolver.solve"><code class="xref py py-meth docutils literal notranslate"><span class="pre">solve</span></code></a>
method returns a clone of the original model which has been run
through TRF algorithm, thus leaving the original model intact.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">TRF is still under a beta release. Please provide feedback and/or
report any problems by opening an issue on the Pyomo
<a class="reference external" href="https://github.com/Pyomo/pyomo/issues/new/choose">GitHub page</a>.</p>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="mcpp.html" class="btn btn-neutral float-right" title="MC++ Interface" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="sensitivity_toolbox.html" class="btn btn-neutral float-left" title="Sensitivity Toolbox" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2008-2023, Sandia National Laboratories.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>