

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Overview &mdash; Pyomo 6.5.1.dev0 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Examples" href="examples.html" />
    <link rel="prev" title="MPC" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Pyomo
          

          
          </a>

          
            
            
              <div class="version">
                6.5.1.dev0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../citing_pyomo.html">Citing Pyomo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pyomo_overview/index.html">Pyomo Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pyomo_modeling_components/index.html">Pyomo Modeling Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../solving_pyomo_models.html">Solving Pyomo Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../working_models.html">Working with Pyomo Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../working_abstractmodels/index.html">Working with Abstract Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../model_transformations/index.html">Model Transformations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modeling_extensions/index.html">Modeling Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial_examples.html">Pyomo Tutorial Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../model_debugging/index.html">Debugging Pyomo Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advanced_topics/index.html">Advanced Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../errors.html">Common Warnings/Errors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer_reference/index.html">Developer Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../library_reference/index.html">Library Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contribution_guide.html">Contributing to Pyomo</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Third-Party Contributions</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../community.html">Community Detection for Pyomo models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../doe/doe.html">Pyomo.DoE</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gdpopt.html">GDPopt logic-based solver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iis.html">Infeasible Irreducible System (IIS) Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="../incidence/index.html">Incidence Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mindtpy.html">MindtPy Solver</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">MPC</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#what-does-this-package-contain">What does this package contain?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#what-is-the-goal-of-this-package">What is the goal of this package?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#why-is-this-package-useful">Why is this package useful?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#who-develops-and-maintains-this-package">Who develops and maintains this package?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="faq.html">Frequently asked questions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../multistart.html">Multistart Solver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preprocessing.html">Nonlinear Preprocessing Transformations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../parmest/index.html">Parameter Estimation with <code class="docutils literal notranslate"><span class="pre">parmest</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../pynumero/index.html">PyNumero</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pyros.html">PyROS Solver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sensitivity_toolbox.html">Sensitivity Toolbox</a></li>
<li class="toctree-l2"><a class="reference internal" href="../trustregion.html">Trust Region Framework Method Solver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mcpp.html">MC++ Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../satsolver.html">z3 SMT Sat Solver Interface</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../related_packages.html">Related Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bibliography.html">Bibliography</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Pyomo</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Third-Party Contributions</a> &raquo;</li>
        
          <li><a href="index.html">MPC</a> &raquo;</li>
        
      <li>Overview</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/contributed_packages/mpc/overview.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="overview">
<h1>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h1>
<div class="section" id="what-does-this-package-contain">
<h2>What does this package contain?<a class="headerlink" href="#what-does-this-package-contain" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Data structures for values and time series data associated with time-indexed variables (or parameters, or named expressions). Examples are setpoint values associated with a subset of state variables or time series data from a simulation</li>
<li>Utilities for loading and extracting this data into and from variables in a model</li>
<li>Utilities for constructing components from this data (expressions, constraints, and objectives) that are useful for dynamic optimization</li>
</ol>
</div>
<div class="section" id="what-is-the-goal-of-this-package">
<h2>What is the goal of this package?<a class="headerlink" href="#what-is-the-goal-of-this-package" title="Permalink to this headline">¶</a></h2>
<p>This package was written to help developers of Pyomo-based dynamic optimization
case studies, especially rolling horizon dynamic optimization case studies,
write scripts that are small, legible, and maintainable.
It does this by providing utilities for mundane data-management and model
construction tasks, allowing the developer to focus on their application.</p>
</div>
<div class="section" id="why-is-this-package-useful">
<h2>Why is this package useful?<a class="headerlink" href="#why-is-this-package-useful" title="Permalink to this headline">¶</a></h2>
<p>First, it is not normally easy to extract “flattened” time series data,
in which all indexing structure other than time-indexing has been
flattened to yield a set of one-dimensional arrays, from a Pyomo model.
This is an extremely convenient data structure to have for plotting,
analysis, initialization, and manipulation of dynamic models.
If all variables are indexed by time and only time, this data is relatively
easy to obtain.
The first issue comes up when dealing with components that are indexed by
time in addition to some other set(s). For example:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pyomo.environ</span> <span class="k">as</span> <span class="nn">pyo</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">ConcreteModel</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">comp</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">var</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">comp</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">t0</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>   <span class="n">m</span><span class="o">.</span><span class="n">var</span><span class="p">[</span><span class="n">t0</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">var</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">time</span><span class="p">]</span>
<span class="gp">... </span>   <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">comp</span>
<span class="gp">... </span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span>
<span class="go">{&#39;var[0,A]&#39;: [1.0, 1.0, 1.0], &#39;var[0,B]&#39;: [1.0, 1.0, 1.0]}</span>
</pre></div>
</div>
<p>To generate data in this form, we need to (a) know that our variable is indexed
by time and <code class="docutils literal notranslate"><span class="pre">m.comp</span></code> and (b) arbitrarily select a time index <code class="docutils literal notranslate"><span class="pre">t0</span></code> to
generate a unique key for each time series.
This gets more difficult when blocks and time-indexed blocks are used as well.
The first difficulty can be alleviated using
<code class="docutils literal notranslate"><span class="pre">flatten_dae_components</span></code> from <code class="docutils literal notranslate"><span class="pre">pyomo.dae.flatten</span></code>:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pyomo.environ</span> <span class="k">as</span> <span class="nn">pyo</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyomo.dae.flatten</span> <span class="kn">import</span> <span class="n">flatten_dae_components</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">ConcreteModel</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">comp</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">var</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">comp</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">t0</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">scalar_vars</span><span class="p">,</span> <span class="n">dae_vars</span> <span class="o">=</span> <span class="n">flatten_dae_components</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="n">var</span><span class="p">[</span><span class="n">t0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">var</span><span class="p">[:]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">dae_vars</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span>
<span class="go">{&#39;var[0,A]&#39;: [1.0, 1.0, 1.0], &#39;var[0,B]&#39;: [1.0, 1.0, 1.0]}</span>
</pre></div>
</div>
<p>Addressing the arbitrary <code class="docutils literal notranslate"><span class="pre">t0</span></code> index requires us to ask what key we
would like to use to identify each time series in our data structure.
The key should uniquely correspond to a component, or “sub-component”
that is indexed only by time. A slice, e.g. <code class="docutils literal notranslate"><span class="pre">m.var[:,</span> <span class="pre">&quot;A&quot;]</span></code> seems
natural. However, Pyomo provides a better data structure that can
be constructed from a component, slice, or string, called
<code class="docutils literal notranslate"><span class="pre">ComponentUID</span></code>. Being constructable from a string is important as
we may want to store or serialize this data in a form that is agnostic
of any particular <code class="docutils literal notranslate"><span class="pre">ConcreteModel</span></code> object.
We can now generate our data structure as:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>   <span class="n">pyo</span><span class="o">.</span><span class="n">ComponentUID</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">referent</span><span class="p">):</span> <span class="nb">list</span><span class="p">(</span><span class="n">var</span><span class="p">[:]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="gp">... </span>   <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">dae_vars</span>
<span class="gp">... </span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span>
<span class="go">{var[*,A]: [1.0, 1.0, 1.0], var[*,B]: [1.0, 1.0, 1.0]}</span>
</pre></div>
</div>
<p>This is the structure of the underlying dictionary in the <code class="docutils literal notranslate"><span class="pre">TimeSeriesData</span></code>
class provided by this package. We can generate this data using this package
as:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pyomo.environ</span> <span class="k">as</span> <span class="nn">pyo</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyomo.contrib.mpc</span> <span class="kn">import</span> <span class="n">DynamicModelInterface</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">ConcreteModel</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">comp</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">var</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">comp</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Construct a helper class for interfacing model with data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">helper</span> <span class="o">=</span> <span class="n">DynamicModelInterface</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Generates a TimeSeriesData object</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">series_data</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">get_data_at_time</span><span class="p">()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Get the underlying dictionary</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">series_data</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span>
<span class="go">{var[*,A]: [1.0, 1.0, 1.0], var[*,B]: [1.0, 1.0, 1.0]}</span>
</pre></div>
</div>
<p>The first value proposition of this package is that <code class="docutils literal notranslate"><span class="pre">DynamicModelInterface</span></code>
and <code class="docutils literal notranslate"><span class="pre">TimeSeriesData</span></code> provide wrappers to ease loading and extraction of data
via <code class="docutils literal notranslate"><span class="pre">flatten_dae_components</span></code> and <code class="docutils literal notranslate"><span class="pre">ComponentUID</span></code>.</p>
<p>The second difficulty addressed by this package is that of extracting and
loading data between (potentially) different models.
For instance, in model predictive control, we often want to extract data from
a particular time point in a plant model and load it into a controller model
as initial conditions. This can be done as follows:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pyomo.environ</span> <span class="k">as</span> <span class="nn">pyo</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyomo.contrib.mpc</span> <span class="kn">import</span> <span class="n">DynamicModelInterface</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">m1</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">ConcreteModel</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m1</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m1</span><span class="o">.</span><span class="n">comp</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m1</span><span class="o">.</span><span class="n">var</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">m1</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">m1</span><span class="o">.</span><span class="n">comp</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">m2</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">ConcreteModel</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m2</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m2</span><span class="o">.</span><span class="n">comp</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m2</span><span class="o">.</span><span class="n">var</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">m2</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">m2</span><span class="o">.</span><span class="n">comp</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Construct helper objects</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m1_helper</span> <span class="o">=</span> <span class="n">DynamicModelInterface</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">m1</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m2_helper</span> <span class="o">=</span> <span class="n">DynamicModelInterface</span><span class="p">(</span><span class="n">m2</span><span class="p">,</span> <span class="n">m2</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Extract data from final time point of m2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tf</span> <span class="o">=</span> <span class="n">m2</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">last</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tf_data</span> <span class="o">=</span> <span class="n">m2_helper</span><span class="o">.</span><span class="n">get_data_at_time</span><span class="p">(</span><span class="n">tf</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Load data into initial time point of m1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t0</span> <span class="o">=</span> <span class="n">m1</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m1_helper</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">tf_data</span><span class="p">,</span> <span class="n">time_points</span><span class="o">=</span><span class="n">t0</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Get TimeSeriesData object</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">series_data</span> <span class="o">=</span> <span class="n">m1_helper</span><span class="o">.</span><span class="n">get_data_at_time</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Get underlying dictionary</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">series_data</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
<span class="go">{var[*,A]: [2.0, 1.0, 1.0], var[*,B]: [2.0, 1.0, 1.0]}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Here we rely on the fact that our variable has the same name in
both models.</p>
</div>
<p>Finally, this package provides methods for constructing components like
tracking cost expressions and piecewise-constant constraints from the
provided data structures. For example, the following code constructs
a tracking cost expression.</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pyomo.environ</span> <span class="k">as</span> <span class="nn">pyo</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyomo.contrib.mpc</span> <span class="kn">import</span> <span class="n">DynamicModelInterface</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">ConcreteModel</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">comp</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">var</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">comp</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Construct helper object</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">helper</span> <span class="o">=</span> <span class="n">DynamicModelInterface</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Construct data structure for setpoints</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">setpoint</span> <span class="o">=</span> <span class="p">{</span><span class="n">m</span><span class="o">.</span><span class="n">var</span><span class="p">[:,</span> <span class="s2">&quot;A&quot;</span><span class="p">]:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">var</span><span class="p">[:,</span> <span class="s2">&quot;B&quot;</span><span class="p">]:</span> <span class="mf">2.0</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">var_set</span><span class="p">,</span> <span class="n">tr_cost</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">get_penalty_from_target</span><span class="p">(</span><span class="n">setpoint</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">setpoint_idx</span> <span class="o">=</span> <span class="n">var_set</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">tracking_cost</span> <span class="o">=</span> <span class="n">tr_cost</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">tracking_cost</span><span class="o">.</span><span class="n">pprint</span><span class="p">()</span>
<span class="go">tracking_cost : Size=6, Index=tracking_cost_index</span>
<span class="go">    Key    : Expression</span>
<span class="go">    (0, 0) : (var[0,A] - 0.5)**2</span>
<span class="go">    (0, 1) : (var[1,A] - 0.5)**2</span>
<span class="go">    (0, 2) : (var[2,A] - 0.5)**2</span>
<span class="go">    (1, 0) : (var[0,B] - 2.0)**2</span>
<span class="go">    (1, 1) : (var[1,B] - 2.0)**2</span>
<span class="go">    (1, 2) : (var[2,B] - 2.0)**2</span>
</pre></div>
</div>
<p>These methods will hopefully allow developers to declutter dynamic optimization
scripts and pay more attention to the application of the optimization problem
rather than the setup of the optimization problem.</p>
</div>
<div class="section" id="who-develops-and-maintains-this-package">
<h2>Who develops and maintains this package?<a class="headerlink" href="#who-develops-and-maintains-this-package" title="Permalink to this headline">¶</a></h2>
<p>This package was developed by Robert Parker while a PhD student in Larry
Biegler’s group at CMU, with guidance from Bethany Nicholson and John Siirola.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="examples.html" class="btn btn-neutral float-right" title="Examples" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="index.html" class="btn btn-neutral float-left" title="MPC" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2008-2023, Sandia National Laboratories.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>