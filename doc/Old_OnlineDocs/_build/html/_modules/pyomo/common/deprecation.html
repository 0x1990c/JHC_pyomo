

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>pyomo.common.deprecation &mdash; Pyomo 6.5.1.dev0 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/theme_overrides.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/clipboard.min.js"></script>
        <script src="../../../_static/copybutton.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> Pyomo
          

          
          </a>

          
            
            
              <div class="version">
                6.5.1.dev0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../citing_pyomo.html">Citing Pyomo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pyomo_overview/index.html">Pyomo Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pyomo_modeling_components/index.html">Pyomo Modeling Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../solving_pyomo_models.html">Solving Pyomo Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_models.html">Working with Pyomo Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_abstractmodels/index.html">Working with Abstract Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../model_transformations/index.html">Model Transformations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modeling_extensions/index.html">Modeling Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial_examples.html">Pyomo Tutorial Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../model_debugging/index.html">Debugging Pyomo Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../advanced_topics/index.html">Advanced Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../errors.html">Common Warnings/Errors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer_reference/index.html">Developer Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../library_reference/index.html">Library Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contribution_guide.html">Contributing to Pyomo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributed_packages/index.html">Third-Party Contributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../related_packages.html">Related Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../bibliography.html">Bibliography</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Pyomo</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>pyomo.common.deprecation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pyomo.common.deprecation</h1><div class="highlight"><pre>
<span></span><span class="c1">#  ___________________________________________________________________________</span>
<span class="c1">#</span>
<span class="c1">#  Pyomo: Python Optimization Modeling Objects</span>
<span class="c1">#  Copyright (c) 2008-2022</span>
<span class="c1">#  National Technology and Engineering Solutions of Sandia, LLC</span>
<span class="c1">#  Under the terms of Contract DE-NA0003525 with National Technology and</span>
<span class="c1">#  Engineering Solutions of Sandia, LLC, the U.S. Government retains certain</span>
<span class="c1">#  rights in this software.</span>
<span class="c1">#  This software is distributed under the 3-clause BSD License.</span>
<span class="c1">#  ___________________________________________________________________________</span>

<span class="sd">&quot;&quot;&quot;This module provides utilities for deprecating functionality.</span>

<span class="sd">.. autosummary::</span>

<span class="sd">   deprecated</span>
<span class="sd">   deprecation_warning</span>
<span class="sd">   relocated_module</span>
<span class="sd">   relocated_module_attribute</span>
<span class="sd">   RenamedClass</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">textwrap</span>
<span class="kn">import</span> <span class="nn">types</span>

<span class="kn">from</span> <span class="nn">pyomo.common.errors</span> <span class="kn">import</span> <span class="n">DeveloperError</span>

<span class="n">_doc_flag</span> <span class="o">=</span> <span class="s1">&#39;.. deprecated::&#39;</span>


<div class="viewcode-block" id="default_deprecation_msg"><a class="viewcode-back" href="../../../library_reference/common/deprecation.html#pyomo.common.deprecation.default_deprecation_msg">[docs]</a><span class="k">def</span> <span class="nf">default_deprecation_msg</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">user_msg</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">remove_in</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generate the default deprecation message.</span>

<span class="sd">    See deprecated() function for argument details.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">user_msg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="n">_obj</span> <span class="o">=</span> <span class="s1">&#39; class&#39;</span>
        <span class="k">elif</span> <span class="n">inspect</span><span class="o">.</span><span class="n">ismethod</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="n">_obj</span> <span class="o">=</span> <span class="s1">&#39; method&#39;</span>
        <span class="k">elif</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isfunction</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="ow">or</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isbuiltin</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="n">_obj</span> <span class="o">=</span> <span class="s1">&#39; function&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># either @deprecated() an unknown type or called from</span>
            <span class="c1"># deprecation_warning()</span>
            <span class="n">_obj</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="n">_qual</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;__qualname__&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">_qual</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.__init__&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">_qual</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.__new__&#39;</span><span class="p">):</span>
            <span class="n">_obj</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39; class (</span><span class="si">{</span><span class="n">_qual</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span>
        <span class="k">elif</span> <span class="n">_qual</span> <span class="ow">and</span> <span class="n">_obj</span><span class="p">:</span>
            <span class="n">_obj</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39; (</span><span class="si">{</span><span class="n">_qual</span><span class="si">}</span><span class="s1">)&#39;</span>

        <span class="n">user_msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s1">&#39;This</span><span class="si">%s</span><span class="s1"> has been deprecated and may be removed in a &#39;</span>
            <span class="s1">&#39;future release.&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">_obj</span><span class="p">,)</span>
        <span class="p">)</span>
    <span class="n">comment</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">version</span><span class="p">:</span>
        <span class="n">comment</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;deprecated in </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">version</span><span class="p">,))</span>
    <span class="k">if</span> <span class="n">remove_in</span><span class="p">:</span>
        <span class="n">comment</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;will be removed in (or after) </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">remove_in</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">comment</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">user_msg</span> <span class="o">+</span> <span class="s2">&quot;  (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">comment</span><span class="p">),)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">user_msg</span></div>


<span class="k">def</span> <span class="nf">_deprecation_docstring</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">remove_in</span><span class="p">):</span>
    <span class="c1"># Note that _deprecation_docstring is guaranteed to be called by</span>
    <span class="c1"># @deprecated in all situations where we would be creating a</span>
    <span class="c1"># meaningful deprecation message (classes, functions, and methods),</span>
    <span class="c1"># so this is a convenient place to check that the version is</span>
    <span class="c1"># specified.</span>
    <span class="k">if</span> <span class="n">version</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DeveloperError</span><span class="p">(</span><span class="s2">&quot;@deprecated(): missing &#39;version&#39; argument&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">_doc_flag</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="sa">f</span><span class="s1">&#39;   </span><span class="si">{</span><span class="n">default_deprecation_msg</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">remove_in</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">_wrap_class</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">remove_in</span><span class="p">):</span>
    <span class="n">_doc</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># Note: __new_member__ is where enum.Enum buries the user&#39;s original</span>
    <span class="c1"># __new__ method</span>
    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;__new__&#39;</span><span class="p">,</span> <span class="s1">&#39;__init__&#39;</span><span class="p">,</span> <span class="s1">&#39;__new_member__&#39;</span><span class="p">):</span>
        <span class="n">_funcDoc</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="s1">&#39;__doc__&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
        <span class="n">_flagIdx</span> <span class="o">=</span> <span class="n">_funcDoc</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">_doc_flag</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_flagIdx</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">_doc</span> <span class="o">=</span> <span class="n">_funcDoc</span><span class="p">[</span><span class="n">_flagIdx</span><span class="p">:]</span>
            <span class="k">break</span>
    <span class="c1"># Note: test &#39;msg is not None&#39; to revert back to the user-supplied</span>
    <span class="c1"># message.  Checking the fields above is still useful as it lets us know</span>
    <span class="c1"># if there is already a deprecation message on either new or init.</span>
    <span class="k">if</span> <span class="n">msg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">_doc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">_doc</span> <span class="o">=</span> <span class="n">_deprecation_docstring</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">remove_in</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">:</span>
        <span class="n">_doc</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">_doc</span>
    <span class="bp">cls</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s1">&#39;DEPRECATED.</span><span class="se">\n\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">_doc</span>

    <span class="k">if</span> <span class="n">_flagIdx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># No deprecation message on __init__ or __new__: go through and</span>
        <span class="c1"># find the &quot;most derived&quot; implementation of either __new__ or</span>
        <span class="c1"># __init__ and wrap that (breaking ties in favor of __init__)</span>
        <span class="n">field</span> <span class="o">=</span> <span class="s1">&#39;__init__&#39;</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__mro__</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;__new__&#39;</span><span class="p">,</span> <span class="s1">&#39;__init__&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="n">field</span> <span class="o">=</span> <span class="n">f</span>
        <span class="nb">setattr</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">_wrap_func</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">field</span><span class="p">),</span> <span class="n">msg</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">remove_in</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span>


<span class="k">def</span> <span class="nf">_wrap_func</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">remove_in</span><span class="p">):</span>
    <span class="n">message</span> <span class="o">=</span> <span class="n">default_deprecation_msg</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">remove_in</span><span class="p">)</span>

    <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span>
        <span class="n">func</span><span class="p">,</span> <span class="n">assigned</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;__module__&#39;</span><span class="p">,</span> <span class="s1">&#39;__name__&#39;</span><span class="p">,</span> <span class="s1">&#39;__qualname__&#39;</span><span class="p">,</span> <span class="s1">&#39;__annotations__&#39;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">cf</span> <span class="o">=</span> <span class="n">_find_calling_frame</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">deprecation_warning</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">calling_frame</span><span class="o">=</span><span class="n">cf</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">wrapper</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s1">&#39;DEPRECATED.</span><span class="se">\n\n</span><span class="s1">&#39;</span>
    <span class="n">_doc</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="vm">__doc__</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="n">_doc</span><span class="p">:</span>
        <span class="n">wrapper</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">+=</span> <span class="n">_doc</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span>
    <span class="n">wrapper</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">+=</span> <span class="n">_deprecation_docstring</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">remove_in</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wrapper</span>


<span class="k">def</span> <span class="nf">_find_calling_frame</span><span class="p">(</span><span class="n">module_offset</span><span class="p">):</span>
    <span class="n">g</span> <span class="o">=</span> <span class="p">[</span><span class="nb">globals</span><span class="p">()]</span>
    <span class="n">calling_frame</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_back</span>
    <span class="k">while</span> <span class="n">calling_frame</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">calling_frame</span><span class="o">.</span><span class="n">f_globals</span> <span class="ow">is</span> <span class="n">g</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">calling_frame</span> <span class="o">=</span> <span class="n">calling_frame</span><span class="o">.</span><span class="n">f_back</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">module_offset</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">calling_frame</span><span class="o">.</span><span class="n">f_globals</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="k">return</span> <span class="n">calling_frame</span>


<div class="viewcode-block" id="in_testing_environment"><a class="viewcode-back" href="../../../library_reference/common/deprecation.html#pyomo.common.deprecation.in_testing_environment">[docs]</a><span class="k">def</span> <span class="nf">in_testing_environment</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Return True if we are currently running in a &quot;testing&quot; environment</span>

<span class="sd">    This currently includes if nose, nose2, pytest, or Sphinx are</span>
<span class="sd">    running (imported).</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">mod</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span> <span class="k">for</span> <span class="n">mod</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;nose&#39;</span><span class="p">,</span> <span class="s1">&#39;nose2&#39;</span><span class="p">,</span> <span class="s1">&#39;pytest&#39;</span><span class="p">,</span> <span class="s1">&#39;sphinx&#39;</span><span class="p">))</span></div>


<div class="viewcode-block" id="deprecation_warning"><a class="viewcode-back" href="../../../library_reference/common/deprecation.html#pyomo.common.deprecation.deprecation_warning">[docs]</a><span class="k">def</span> <span class="nf">deprecation_warning</span><span class="p">(</span>
    <span class="n">msg</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">remove_in</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">calling_frame</span><span class="o">=</span><span class="kc">None</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Standardized formatter for deprecation warnings</span>

<span class="sd">    This is a standardized routine for formatting deprecation warnings</span>
<span class="sd">    so that things look consistent and &quot;nice&quot;.</span>

<span class="sd">    Args:</span>
<span class="sd">        msg (str): the deprecation message to format</span>

<span class="sd">        logger (str): the logger to use for emitting the warning</span>
<span class="sd">            (default: the calling pyomo package, or &quot;pyomo&quot;)</span>

<span class="sd">        version (str): [required] the version in which the decorated</span>
<span class="sd">            object was deprecated.  General practice is to set version</span>
<span class="sd">            to the current development version (from `pyomo --version`)</span>
<span class="sd">            during development and update it to the actual release as</span>
<span class="sd">            part of the release process.</span>

<span class="sd">        remove_in (str): the version in which the decorated object will be</span>
<span class="sd">            removed from the code.</span>

<span class="sd">        calling_frame (frame): the original frame context that triggered</span>
<span class="sd">            the deprecation warning.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; from pyomo.common.deprecation import deprecation_warning</span>
<span class="sd">    &gt;&gt;&gt; deprecation_warning(&#39;This functionality is deprecated.&#39;, version=&#39;1.2.3&#39;)</span>
<span class="sd">    WARNING: DEPRECATED: This functionality is deprecated.  (deprecated in 1.2.3) ...</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">version</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DeveloperError</span><span class="p">(</span><span class="s2">&quot;deprecation_warning() missing &#39;version&#39; argument&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">logger</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">calling_frame</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cf</span> <span class="o">=</span> <span class="n">calling_frame</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># The relevant module is the one that holds the</span>
            <span class="c1"># function/method that called deprecation_warning</span>
            <span class="n">cf</span> <span class="o">=</span> <span class="n">_find_calling_frame</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">f_globals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;__name__&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">logger</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">logger</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;pyomo&#39;</span><span class="p">):</span>
                <span class="n">logger</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">logger</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span> <span class="o">=</span> <span class="s1">&#39;pyomo&#39;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">logger</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">logger</span><span class="p">)</span>

    <span class="n">msg</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span>
        <span class="sa">f</span><span class="s1">&#39;DEPRECATED: </span><span class="si">{</span><span class="n">default_deprecation_msg</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">remove_in</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">calling_frame</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># The useful thing to let the user know is what called the</span>
        <span class="c1"># function that generated the deprecation warning.  The current</span>
        <span class="c1"># globals() is *this* module.  Walking up the stack to find the</span>
        <span class="c1"># frame where the globals() changes tells us the module that is</span>
        <span class="c1"># issuing the deprecation warning.  As we assume that *that*</span>
        <span class="c1"># module will not trigger its own deprecation warnings, we will</span>
        <span class="c1"># walk farther up until the globals() changes again.</span>
        <span class="n">calling_frame</span> <span class="o">=</span> <span class="n">_find_calling_frame</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">calling_frame</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getframeinfo</span><span class="p">(</span><span class="n">calling_frame</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">(called from </span><span class="si">%s</span><span class="s2">:</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">filename</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">info</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">deprecation_warning</span><span class="o">.</span><span class="n">emitted_warnings</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">deprecation_warning</span><span class="o">.</span><span class="n">emitted_warnings</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">deprecation_warning</span><span class="o">.</span><span class="n">emitted_warnings</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>


<span class="k">if</span> <span class="n">in_testing_environment</span><span class="p">():</span>
    <span class="n">deprecation_warning</span><span class="o">.</span><span class="n">emitted_warnings</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">deprecation_warning</span><span class="o">.</span><span class="n">emitted_warnings</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>


<div class="viewcode-block" id="deprecated"><a class="viewcode-back" href="../../../library_reference/common/deprecation.html#pyomo.common.deprecation.deprecated">[docs]</a><span class="k">def</span> <span class="nf">deprecated</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">remove_in</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Decorator to indicate that a function, method, or class is deprecated.</span>

<span class="sd">    This decorator will cause a warning to be logged when the wrapped</span>
<span class="sd">    function or method is called, or when the deprecated class is</span>
<span class="sd">    constructed.  This decorator also updates the target object&#39;s</span>
<span class="sd">    docstring to indicate that it is deprecated.</span>

<span class="sd">    Args:</span>
<span class="sd">        msg (str): a custom deprecation message (default: &quot;This</span>
<span class="sd">            {function|class} has been deprecated and may be</span>
<span class="sd">            removed in a future release.&quot;)</span>

<span class="sd">        logger (str): the logger to use for emitting the warning</span>
<span class="sd">            (default: the calling pyomo package, or &quot;pyomo&quot;)</span>

<span class="sd">        version (str): [required] the version in which the decorated</span>
<span class="sd">            object was deprecated.  General practice is to set version</span>
<span class="sd">            to the current development version (from `pyomo --version`)</span>
<span class="sd">            during development and update it to the actual release as</span>
<span class="sd">            part of the release process.</span>

<span class="sd">        remove_in (str): the version in which the decorated object will be</span>
<span class="sd">            removed from the code.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; from pyomo.common.deprecation import deprecated</span>
<span class="sd">    &gt;&gt;&gt; @deprecated(version=&#39;1.2.3&#39;)</span>
<span class="sd">    ... def sample_function(x):</span>
<span class="sd">    ...     return 2*x</span>
<span class="sd">    &gt;&gt;&gt; sample_function(5)</span>
<span class="sd">    WARNING: DEPRECATED: This function (sample_function) has been deprecated and</span>
<span class="sd">        may be removed in a future release.  (deprecated in 1.2.3) ...</span>
<span class="sd">    10</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">wrap</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">_wrap_class</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">remove_in</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_wrap_func</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">remove_in</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">wrap</span></div>


<span class="k">def</span> <span class="nf">_import_object</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">remove_in</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">importlib</span> <span class="kn">import</span> <span class="n">import_module</span>

    <span class="n">modname</span><span class="p">,</span> <span class="n">targetname</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">_object</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">import_module</span><span class="p">(</span><span class="n">modname</span><span class="p">),</span> <span class="n">targetname</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">msg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">_object</span><span class="p">):</span>
            <span class="n">_type</span> <span class="o">=</span> <span class="s1">&#39;class&#39;</span>
        <span class="k">elif</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isfunction</span><span class="p">(</span><span class="n">_object</span><span class="p">):</span>
            <span class="n">_type</span> <span class="o">=</span> <span class="s1">&#39;function&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_type</span> <span class="o">=</span> <span class="s1">&#39;attribute&#39;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;the &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; </span><span class="si">{</span><span class="n">_type</span><span class="si">}</span><span class="s2"> has been moved to &#39;</span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
            <span class="s2">&quot;  Please update your import.&quot;</span>
        <span class="p">)</span>
    <span class="n">deprecation_warning</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="n">version</span><span class="p">,</span> <span class="n">remove_in</span><span class="o">=</span><span class="n">remove_in</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_object</span>


<div class="viewcode-block" id="relocated_module"><a class="viewcode-back" href="../../../library_reference/common/deprecation.html#pyomo.common.deprecation.relocated_module">[docs]</a><span class="k">def</span> <span class="nf">relocated_module</span><span class="p">(</span><span class="n">new_name</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">remove_in</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Provide a deprecation path for moved / renamed modules</span>

<span class="sd">    Upon import, the old module (that called `relocated_module()`) will</span>
<span class="sd">    be replaced in `sys.modules` by an alias that points directly to the</span>
<span class="sd">    new module.  As a result, the old module should have only two lines</span>
<span class="sd">    of executable Python code (the import of `relocated_module` and the</span>
<span class="sd">    call to it).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    new_name: str</span>
<span class="sd">        The new (fully-qualified) module name</span>

<span class="sd">    msg: str</span>
<span class="sd">        A custom deprecation message.</span>

<span class="sd">    logger: str</span>
<span class="sd">        The logger to use for emitting the warning (default: the calling</span>
<span class="sd">        pyomo package, or &quot;pyomo&quot;)</span>

<span class="sd">    version: str [required]</span>
<span class="sd">        The version in which the module was renamed or moved.  General</span>
<span class="sd">        practice is to set version to the current development version</span>
<span class="sd">        (from `pyomo --version`) during development and update it to the</span>
<span class="sd">        actual release as part of the release process.</span>

<span class="sd">    remove_in: str</span>
<span class="sd">        The version in which the module will be removed from the code.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; from pyomo.common.deprecation import relocated_module</span>
<span class="sd">    &gt;&gt;&gt; relocated_module(&#39;pyomo.common.deprecation&#39;, version=&#39;1.2.3&#39;)</span>
<span class="sd">    WARNING: DEPRECATED: The &#39;...&#39; module has been moved to</span>
<span class="sd">        &#39;pyomo.common.deprecation&#39;. Please update your import.</span>
<span class="sd">        (deprecated in 1.2.3) ...</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">importlib</span> <span class="kn">import</span> <span class="n">import_module</span>

    <span class="n">new_module</span> <span class="o">=</span> <span class="n">import_module</span><span class="p">(</span><span class="n">new_name</span><span class="p">)</span>

    <span class="c1"># The relevant module (the one being deprecated) is the one that</span>
    <span class="c1"># holds the function/method that called deprecated_module().  The</span>
    <span class="c1"># relevant calling frame for the deprecation warning is the first</span>
    <span class="c1"># frame in the stack that doesn&#39;t look like the importer (i.e., the</span>
    <span class="c1"># thing that imported the deprecated module).</span>
    <span class="n">cf</span> <span class="o">=</span> <span class="n">_find_calling_frame</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">old_name</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">f_globals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;__name__&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;stdin&gt;&#39;</span><span class="p">)</span>
    <span class="n">cf</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">f_back</span>
    <span class="k">if</span> <span class="n">cf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">importer</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">f_back</span><span class="o">.</span><span class="n">f_globals</span><span class="p">[</span><span class="s1">&#39;__name__&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">while</span> <span class="n">cf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">cf</span><span class="o">.</span><span class="n">f_globals</span><span class="p">[</span><span class="s1">&#39;__name__&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">importer</span><span class="p">:</span>
            <span class="n">cf</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">f_back</span>
    <span class="k">if</span> <span class="n">cf</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cf</span> <span class="o">=</span> <span class="n">_find_calling_frame</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">old_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_module</span>
    <span class="k">if</span> <span class="n">msg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;The &#39;</span><span class="si">{</span><span class="n">old_name</span><span class="si">}</span><span class="s2">&#39; module has been moved to &#39;</span><span class="si">{</span><span class="n">new_name</span><span class="si">}</span><span class="s2">&#39;. &quot;</span>
            <span class="s1">&#39;Please update your import.&#39;</span>
        <span class="p">)</span>
    <span class="n">deprecation_warning</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">remove_in</span><span class="p">,</span> <span class="n">cf</span><span class="p">)</span></div>


<div class="viewcode-block" id="relocated_module_attribute"><a class="viewcode-back" href="../../../library_reference/common/deprecation.html#pyomo.common.deprecation.relocated_module_attribute">[docs]</a><span class="k">def</span> <span class="nf">relocated_module_attribute</span><span class="p">(</span>
    <span class="n">local</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">remove_in</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">f_globals</span><span class="o">=</span><span class="kc">None</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Provide a deprecation path for moved / renamed module attributes</span>

<span class="sd">    This function declares that a local module attribute has been moved</span>
<span class="sd">    to another location.  For Python 3.7+, it leverages a</span>
<span class="sd">    module.__getattr__ method to manage the deferred import of the</span>
<span class="sd">    object from the new location (on request), as well as emitting the</span>
<span class="sd">    deprecation warning.</span>

<span class="sd">    It contains backports of the __getattr__ functionality for earlier</span>
<span class="sd">    versions of Python (although the implementation for 3.5+ is more</span>
<span class="sd">    efficient that the implementation for 2.7+)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    local: str</span>
<span class="sd">        The original (local) name of the relocated attribute</span>

<span class="sd">    target: str</span>
<span class="sd">        The new absolute import name of the relocated attribute</span>

<span class="sd">    version: str</span>
<span class="sd">        The Pyomo version when this move was released</span>
<span class="sd">        (passed to deprecation_warning)</span>

<span class="sd">    remove_in: str</span>
<span class="sd">        The Pyomo version when this deprecation path will be removed</span>
<span class="sd">        (passed to deprecation_warning)</span>

<span class="sd">    msg: str</span>
<span class="sd">        If not None, then this specifies a custom deprecation message to</span>
<span class="sd">        be emitted when the attribute is accessed from its original</span>
<span class="sd">        location.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">version</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DeveloperError</span><span class="p">(</span><span class="s2">&quot;relocated_module_attribute(): missing &#39;version&#39; argument&quot;</span><span class="p">)</span>
    <span class="c1"># Historical note: This method only works for Python &gt;= 3.7.  There</span>
    <span class="c1"># were backports to previous Python interpreters, but were removed</span>
    <span class="c1"># after SHA 4e04819aaeefc2c08b7718460918885e12343451</span>
    <span class="k">if</span> <span class="n">f_globals</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">f_globals</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_back</span><span class="o">.</span><span class="n">f_globals</span>
        <span class="k">if</span> <span class="n">f_globals</span><span class="p">[</span><span class="s1">&#39;__name__&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;importlib.&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">DeveloperError</span><span class="p">(</span>
                <span class="s2">&quot;relocated_module_attribute() called from a cythonized &quot;</span>
                <span class="s2">&quot;module without passing f_globals&quot;</span>
            <span class="p">)</span>
    <span class="n">_relocated</span> <span class="o">=</span> <span class="n">f_globals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;__relocated_attrs__&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_relocated</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">f_globals</span><span class="p">[</span><span class="s1">&#39;__relocated_attrs__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_relocated</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">_mod_getattr</span> <span class="o">=</span> <span class="n">f_globals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;__getattr__&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="n">info</span> <span class="o">=</span> <span class="n">_relocated</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">target_obj</span> <span class="o">=</span> <span class="n">_import_object</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">info</span><span class="p">)</span>
                <span class="n">f_globals</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">target_obj</span>
                <span class="k">return</span> <span class="n">target_obj</span>
            <span class="k">elif</span> <span class="n">_mod_getattr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">_mod_getattr</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="s2">&quot;module &#39;</span><span class="si">%s</span><span class="s2">&#39; has no attribute &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">f_globals</span><span class="p">[</span><span class="s1">&#39;__name__&#39;</span><span class="p">],</span> <span class="n">name</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="n">f_globals</span><span class="p">[</span><span class="s1">&#39;__getattr__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="fm">__getattr__</span>
    <span class="n">_relocated</span><span class="p">[</span><span class="n">local</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">remove_in</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span></div>


<div class="viewcode-block" id="RenamedClass"><a class="viewcode-back" href="../../../library_reference/common/deprecation.html#pyomo.common.deprecation.RenamedClass">[docs]</a><span class="k">class</span> <span class="nc">RenamedClass</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Metaclass to provide a deprecation path for renamed classes</span>

<span class="sd">    This metaclass provides a mechanism for renaming old classes while</span>
<span class="sd">    still preserving isinstance / issubclass relationships.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from pyomo.common.deprecation import RenamedClass</span>
<span class="sd">    &gt;&gt;&gt; class NewClass(object):</span>
<span class="sd">    ...     pass</span>
<span class="sd">    &gt;&gt;&gt; class OldClass(metaclass=RenamedClass):</span>
<span class="sd">    ...     __renamed__new_class__ = NewClass</span>
<span class="sd">    ...     __renamed__version__ = &#39;6.0&#39;</span>

<span class="sd">    Deriving from the old class generates a warning:</span>

<span class="sd">    &gt;&gt;&gt; class DerivedOldClass(OldClass):</span>
<span class="sd">    ...     pass</span>
<span class="sd">    WARNING: DEPRECATED: Declaring class &#39;DerivedOldClass&#39; derived from</span>
<span class="sd">        &#39;OldClass&#39;. The class &#39;OldClass&#39; has been renamed to &#39;NewClass&#39;.</span>
<span class="sd">        (deprecated in 6.0) ...</span>

<span class="sd">    As does instantiating the old class:</span>

<span class="sd">    &gt;&gt;&gt; old = OldClass()</span>
<span class="sd">    WARNING: DEPRECATED: Instantiating class &#39;OldClass&#39;.  The class</span>
<span class="sd">        &#39;OldClass&#39; has been renamed to &#39;NewClass&#39;.  (deprecated in 6.0) ...</span>

<span class="sd">    Finally, `isinstance` and `issubclass` still work, for example:</span>

<span class="sd">    &gt;&gt;&gt; isinstance(old, NewClass)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; class NewSubclass(NewClass):</span>
<span class="sd">    ...     pass</span>
<span class="sd">    &gt;&gt;&gt; new = NewSubclass()</span>
<span class="sd">    &gt;&gt;&gt; isinstance(new, OldClass)</span>
<span class="sd">    WARNING: DEPRECATED: Checking type relative to &#39;OldClass&#39;.  The class</span>
<span class="sd">        &#39;OldClass&#39; has been renamed to &#39;NewClass&#39;.  (deprecated in 6.0) ...</span>
<span class="sd">    True</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">classdict</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">new_class</span> <span class="o">=</span> <span class="n">classdict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;__renamed__new_class__&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">new_class</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="k">def</span> <span class="nf">__renamed__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">__renamed__warning__</span><span class="p">(</span><span class="s2">&quot;Instantiating class &#39;</span><span class="si">%s</span><span class="s2">&#39;.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,))</span>
                <span class="k">return</span> <span class="n">new_class</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="n">classdict</span><span class="p">[</span><span class="s1">&#39;__new__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">__renamed__new__</span>

            <span class="k">def</span> <span class="nf">__renamed__warning__</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
                <span class="n">version</span> <span class="o">=</span> <span class="n">classdict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;__renamed__version__&#39;</span><span class="p">)</span>
                <span class="n">remove_in</span> <span class="o">=</span> <span class="n">classdict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;__renamed__remove_in__&#39;</span><span class="p">)</span>
                <span class="n">deprecation_warning</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">  The class &#39;</span><span class="si">%s</span><span class="s2">&#39; has been renamed to &#39;</span><span class="si">%s</span><span class="s2">&#39;.&quot;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">new_class</span><span class="o">.</span><span class="vm">__name__</span><span class="p">),</span>
                    <span class="n">version</span><span class="o">=</span><span class="n">version</span><span class="p">,</span>
                    <span class="n">remove_in</span><span class="o">=</span><span class="n">remove_in</span><span class="p">,</span>
                    <span class="n">calling_frame</span><span class="o">=</span><span class="n">_find_calling_frame</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
                <span class="p">)</span>

            <span class="n">classdict</span><span class="p">[</span><span class="s1">&#39;__renamed__warning__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">__renamed__warning__</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">classdict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;__renamed__version__&#39;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">DeveloperError</span><span class="p">(</span>
                    <span class="s2">&quot;Declaring class &#39;</span><span class="si">%s</span><span class="s2">&#39; using the RenamedClass metaclass, &quot;</span>
                    <span class="s2">&quot;but without specifying the __renamed__version__ class &quot;</span>
                    <span class="s2">&quot;attribute&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,)</span>
                <span class="p">)</span>

        <span class="n">renamed_bases</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">bases</span><span class="p">:</span>
            <span class="n">new_class</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="s1">&#39;__renamed__new_class__&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">new_class</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">base</span><span class="o">.</span><span class="n">__renamed__warning__</span><span class="p">(</span>
                    <span class="s2">&quot;Declaring class &#39;</span><span class="si">%s</span><span class="s2">&#39; derived from &#39;</span><span class="si">%s</span><span class="s2">&#39;.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">base</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">base</span> <span class="o">=</span> <span class="n">new_class</span>
                <span class="c1"># Flag that this class is derived from a renamed class</span>
                <span class="n">classdict</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;__renamed__new_class__&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="c1"># Avoid duplicates (in case someone does a diamond between</span>
            <span class="c1"># the renamed class and [a class derived from] the new</span>
            <span class="c1"># class)</span>
            <span class="k">if</span> <span class="n">base</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">renamed_bases</span><span class="p">:</span>
                <span class="n">renamed_bases</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>

        <span class="c1"># Add the new class as a &quot;base class&quot; of the renamed class (this</span>
        <span class="c1"># makes issubclass(renamed, new_class) work correctly).  As we</span>
        <span class="c1"># still never create an actual instance of renamed, this doesn&#39;t</span>
        <span class="c1"># affect the API)</span>
        <span class="k">if</span> <span class="n">new_class</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">new_class</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">renamed_bases</span><span class="p">:</span>
            <span class="n">renamed_bases</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_class</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">new_class</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s1">&#39;__renamed__new_class__&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">classdict</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span>
                <span class="nb">hasattr</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="s1">&#39;__renamed__new_class__&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">mro</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span>
                    <span class="n">base</span><span class="o">.</span><span class="vm">__mro__</span> <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">renamed_bases</span>
                <span class="p">)</span>
            <span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="s2">&quot;Declaring class &#39;</span><span class="si">%s</span><span class="s2">&#39; using the RenamedClass metaclass, &quot;</span>
                    <span class="s2">&quot;but without specifying the __renamed__new_class__ class &quot;</span>
                    <span class="s2">&quot;attribute&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,)</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">renamed_bases</span><span class="p">),</span> <span class="n">classdict</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__instancecheck__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
        <span class="c1"># Note: the warning is issued by subclasscheck</span>
        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span>
            <span class="bp">cls</span><span class="o">.</span><span class="fm">__subclasscheck__</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">{</span><span class="nb">type</span><span class="p">(</span><span class="n">instance</span><span class="p">),</span> <span class="n">instance</span><span class="o">.</span><span class="vm">__class__</span><span class="p">}</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__subclasscheck__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s1">&#39;__renamed__warning__&#39;</span><span class="p">):</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">__renamed__warning__</span><span class="p">(</span>
                <span class="s2">&quot;Checking type relative to &#39;</span><span class="si">%s</span><span class="s2">&#39;.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">subclass</span> <span class="ow">is</span> <span class="bp">cls</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s1">&#39;__renamed__new_class__&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">subclass</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s1">&#39;__renamed__new_class__&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__subclasscheck__</span><span class="p">(</span><span class="n">subclass</span><span class="p">)</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2008-2023, Sandia National Laboratories.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>