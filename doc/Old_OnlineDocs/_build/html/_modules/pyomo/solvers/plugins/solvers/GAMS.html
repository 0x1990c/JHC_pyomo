

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>pyomo.solvers.plugins.solvers.GAMS &mdash; Pyomo 6.5.1.dev0 documentation</title>
  

  
  <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/theme_overrides.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../../../_static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../../" src="../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../_static/jquery.js"></script>
        <script src="../../../../../_static/underscore.js"></script>
        <script src="../../../../../_static/doctools.js"></script>
        <script src="../../../../../_static/clipboard.min.js"></script>
        <script src="../../../../../_static/copybutton.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../../index.html" class="icon icon-home"> Pyomo
          

          
          </a>

          
            
            
              <div class="version">
                6.5.1.dev0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../citing_pyomo.html">Citing Pyomo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../pyomo_overview/index.html">Pyomo Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../pyomo_modeling_components/index.html">Pyomo Modeling Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../solving_pyomo_models.html">Solving Pyomo Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../working_models.html">Working with Pyomo Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../working_abstractmodels/index.html">Working with Abstract Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../model_transformations/index.html">Model Transformations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../modeling_extensions/index.html">Modeling Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../tutorial_examples.html">Pyomo Tutorial Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../model_debugging/index.html">Debugging Pyomo Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../advanced_topics/index.html">Advanced Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../errors.html">Common Warnings/Errors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../developer_reference/index.html">Developer Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../library_reference/index.html">Library Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../contribution_guide.html">Contributing to Pyomo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../contributed_packages/index.html">Third-Party Contributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../related_packages.html">Related Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../bibliography.html">Bibliography</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">Pyomo</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../../../index.html">Module code</a> &raquo;</li>
        
      <li>pyomo.solvers.plugins.solvers.GAMS</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pyomo.solvers.plugins.solvers.GAMS</h1><div class="highlight"><pre>
<span></span><span class="c1">#  ___________________________________________________________________________</span>
<span class="c1">#</span>
<span class="c1">#  Pyomo: Python Optimization Modeling Objects</span>
<span class="c1">#  Copyright (c) 2008-2022</span>
<span class="c1">#  National Technology and Engineering Solutions of Sandia, LLC</span>
<span class="c1">#  Under the terms of Contract DE-NA0003525 with National Technology and</span>
<span class="c1">#  Engineering Solutions of Sandia, LLC, the U.S. Government retains certain</span>
<span class="c1">#  rights in this software.</span>
<span class="c1">#  This software is distributed under the 3-clause BSD License.</span>
<span class="c1">#  ___________________________________________________________________________</span>

<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">StringIO</span>
<span class="kn">import</span> <span class="nn">shlex</span>
<span class="kn">from</span> <span class="nn">tempfile</span> <span class="kn">import</span> <span class="n">mkdtemp</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">math</span><span class="o">,</span> <span class="nn">logging</span><span class="o">,</span> <span class="nn">shutil</span><span class="o">,</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">subprocess</span>

<span class="kn">from</span> <span class="nn">pyomo.core.base</span> <span class="kn">import</span> <span class="n">Constraint</span><span class="p">,</span> <span class="n">Var</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">Objective</span>
<span class="kn">from</span> <span class="nn">pyomo.opt</span> <span class="kn">import</span> <span class="n">ProblemFormat</span><span class="p">,</span> <span class="n">SolverFactory</span>

<span class="kn">import</span> <span class="nn">pyomo.common</span>
<span class="kn">from</span> <span class="nn">pyomo.common.collections</span> <span class="kn">import</span> <span class="n">Bunch</span>
<span class="kn">from</span> <span class="nn">pyomo.common.tee</span> <span class="kn">import</span> <span class="n">TeeStream</span>

<span class="kn">from</span> <span class="nn">pyomo.opt.base.solvers</span> <span class="kn">import</span> <span class="n">_extract_version</span>

<span class="kn">from</span> <span class="nn">pyomo.core.kernel.block</span> <span class="kn">import</span> <span class="n">IBlock</span>
<span class="kn">from</span> <span class="nn">pyomo.core.kernel.objective</span> <span class="kn">import</span> <span class="n">IObjective</span>
<span class="kn">from</span> <span class="nn">pyomo.core.kernel.variable</span> <span class="kn">import</span> <span class="n">IVariable</span>

<span class="kn">import</span> <span class="nn">pyomo.core.base.suffix</span>
<span class="kn">import</span> <span class="nn">pyomo.core.kernel.suffix</span>

<span class="kn">from</span> <span class="nn">pyomo.opt.results</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">SolverResults</span><span class="p">,</span>
    <span class="n">SolverStatus</span><span class="p">,</span>
    <span class="n">Solution</span><span class="p">,</span>
    <span class="n">SolutionStatus</span><span class="p">,</span>
    <span class="n">TerminationCondition</span><span class="p">,</span>
    <span class="n">ProblemSense</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">pyomo.common.dependencies</span> <span class="kn">import</span> <span class="n">attempt_import</span>

<span class="n">gdxcc</span><span class="p">,</span> <span class="n">gdxcc_available</span> <span class="o">=</span> <span class="n">attempt_import</span><span class="p">(</span><span class="s1">&#39;gdxcc&#39;</span><span class="p">,</span> <span class="n">defer_check</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;pyomo.solvers&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">_GAMSSolver</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Aggregate of common methods for GAMS interfaces&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_version</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default_variable_value</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_metasolver</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_capabilities</span> <span class="o">=</span> <span class="n">Bunch</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_capabilities</span><span class="o">.</span><span class="n">linear</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_capabilities</span><span class="o">.</span><span class="n">quadratic_objective</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_capabilities</span><span class="o">.</span><span class="n">quadratic_constraint</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_capabilities</span><span class="o">.</span><span class="n">integer</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_capabilities</span><span class="o">.</span><span class="n">sos1</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_capabilities</span><span class="o">.</span><span class="n">sos2</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">Bunch</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a 4-tuple describing the solver executable version.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_version</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_version</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_version</span>

    <span class="k">def</span> <span class="nf">warm_start_capable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;True is the solver can accept a warm-start solution.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">default_variable_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_variable_value</span>

    <span class="k">def</span> <span class="nf">set_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">istr</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">istr</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">istr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_options_string_to_dict</span><span class="p">(</span><span class="n">istr</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">istr</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">istr</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">istr</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_options_string_to_dict</span><span class="p">(</span><span class="n">istr</span><span class="p">):</span>
        <span class="n">ans</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">istr</span> <span class="o">=</span> <span class="n">istr</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">istr</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ans</span>
        <span class="k">if</span> <span class="n">istr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&#39;&quot;</span> <span class="ow">or</span> <span class="n">istr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">:</span>
            <span class="n">istr</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">istr</span><span class="p">)</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">istr</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Solver options must have the form option=value: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">istr</span>
                <span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">token</span><span class="p">[(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">:])</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">token</span><span class="p">[(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">:]</span>
            <span class="n">ans</span><span class="p">[</span><span class="n">token</span><span class="p">[:</span><span class="n">index</span><span class="p">]]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">return</span> <span class="n">ans</span>

    <span class="k">def</span> <span class="nf">_simple_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            option limrow = 0;</span>
<span class="s2">            option limcol = 0;</span>
<span class="s2">            option solprint = off;</span>
<span class="s2">            set I / 1 * </span><span class="si">%s</span><span class="s2"> /;</span>
<span class="s2">            variables ans;</span>
<span class="s2">            positive variables x(I);</span>
<span class="s2">            equations obj;</span>
<span class="s2">            obj.. ans =g= sum(I, x(I));</span>
<span class="s2">            model test / all /;</span>
<span class="s2">            solve test using lp minimizing ans;</span>
<span class="s2">            &quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">n</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1">#</span>
    <span class="c1"># Support &quot;with&quot; statements.</span>
    <span class="c1">#</span>
    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
        <span class="k">pass</span>


<span class="nd">@SolverFactory</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;gams&#39;</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;The GAMS modeling language&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">GAMSSolver</span><span class="p">(</span><span class="n">_GAMSSolver</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A generic interface to GAMS solvers.</span>

<span class="sd">    Pass solver_io keyword arg to SolverFactory to choose solver mode:</span>
<span class="sd">        solver_io=&#39;direct&#39; or &#39;python&#39; to use GAMS Python API</span>
<span class="sd">            Requires installation, visit Python API page on gams.com for help.</span>
<span class="sd">        solver_io=&#39;shell&#39; or &#39;gms&#39; to use command line to call gams</span>
<span class="sd">            Requires the gams executable be on your system PATH.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;solver_io&#39;</span><span class="p">,</span> <span class="s1">&#39;shell&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;shell&#39;</span>

        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;direct&#39;</span> <span class="ow">or</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;python&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">SolverFactory</span><span class="p">(</span><span class="s1">&#39;_gams_direct&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;shell&#39;</span> <span class="ow">or</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;gms&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">SolverFactory</span><span class="p">(</span><span class="s1">&#39;_gams_shell&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Unknown IO type: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">mode</span><span class="p">)</span>
            <span class="k">return</span>


<div class="viewcode-block" id="GAMSDirect"><a class="viewcode-back" href="../../../../../library_reference/solvers/gams.html#pyomo.solvers.plugins.solvers.GAMS.GAMSDirect">[docs]</a><span class="nd">@SolverFactory</span><span class="o">.</span><span class="n">register</span><span class="p">(</span>
    <span class="s1">&#39;_gams_direct&#39;</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;Direct python interface to the GAMS modeling language&#39;</span>
<span class="p">)</span>
<span class="k">class</span> <span class="nc">GAMSDirect</span><span class="p">(</span><span class="n">_GAMSSolver</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A generic python interface to GAMS solvers.</span>

<span class="sd">    Visit Python API page on gams.com for installation help.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="GAMSDirect.available"><a class="viewcode-back" href="../../../../../library_reference/solvers/gams.html#pyomo.solvers.plugins.solvers.GAMS.GAMSDirect.available">[docs]</a>    <span class="k">def</span> <span class="nf">available</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exception_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;True if the solver is available.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">gams</span> <span class="kn">import</span> <span class="n">GamsWorkspace</span><span class="p">,</span> <span class="n">DebugLevel</span>
        <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">exception_flag</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
                <span class="s2">&quot;Import of gams failed - GAMS direct &quot;</span>
                <span class="s2">&quot;solver functionality is not available.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;GAMS message: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="p">,)</span>
            <span class="p">)</span>
        <span class="n">avail</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_simple_model</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">avail</span> <span class="ow">and</span> <span class="n">exception_flag</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span>
                <span class="s2">&quot;&#39;gams&#39; command failed to solve a simple model - &quot;</span>
                <span class="s2">&quot;GAMS shell solver functionality is not available.&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">avail</span></div>

    <span class="k">def</span> <span class="nf">license_is_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># New versions of the community license can run LPs up to 5k</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_simple_model</span><span class="p">(</span><span class="mi">5001</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a tuple describing the solver executable version.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">available</span><span class="p">(</span><span class="n">exception_flag</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">_extract_version</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">gams</span> <span class="kn">import</span> <span class="n">GamsWorkspace</span>

        <span class="n">ws</span> <span class="o">=</span> <span class="n">GamsWorkspace</span><span class="p">()</span>
        <span class="n">version</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ws</span><span class="o">.</span><span class="n">_version</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[:</span><span class="mi">4</span><span class="p">])</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">version</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">version</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,)</span>
        <span class="k">return</span> <span class="n">version</span>

    <span class="k">def</span> <span class="nf">_run_simple_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="n">tmpdir</span> <span class="o">=</span> <span class="n">mkdtemp</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">gams</span> <span class="kn">import</span> <span class="n">GamsWorkspace</span><span class="p">,</span> <span class="n">DebugLevel</span>

            <span class="n">ws</span> <span class="o">=</span> <span class="n">GamsWorkspace</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="n">DebugLevel</span><span class="o">.</span><span class="n">Off</span><span class="p">,</span> <span class="n">working_directory</span><span class="o">=</span><span class="n">tmpdir</span><span class="p">)</span>
            <span class="n">t1</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">add_job_from_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_simple_model</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
            <span class="n">t1</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">)</span>

<div class="viewcode-block" id="GAMSDirect.solve"><a class="viewcode-back" href="../../../../../library_reference/solvers/gams.html#pyomo.solvers.plugins.solvers.GAMS.GAMSDirect.solve">[docs]</a>    <span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Solve a model via the GAMS Python API.</span>

<span class="sd">        Keyword Arguments</span>
<span class="sd">        -----------------</span>
<span class="sd">        tee=False: bool</span>
<span class="sd">            Output GAMS log to stdout.</span>
<span class="sd">        logfile=None: str</span>
<span class="sd">            Filename to output GAMS log to a file.</span>
<span class="sd">        load_solutions=True: bool</span>
<span class="sd">            Load solution into model. If False, the results</span>
<span class="sd">            object will contain the solution data.</span>
<span class="sd">        keepfiles=False: bool</span>
<span class="sd">            Keep temporary files. Equivalent of DebugLevel.KeepFiles.</span>
<span class="sd">            Summary of temp files can be found in _gams_py_gjo0.pf</span>
<span class="sd">        tmpdir=None: str</span>
<span class="sd">            Specify directory path for storing temporary files.</span>
<span class="sd">            A directory will be created if one of this name doesn&#39;t exist.</span>
<span class="sd">            By default uses the system default temporary path.</span>
<span class="sd">        report_timing=False: bool</span>
<span class="sd">            Print timing reports for presolve, solver, postsolve, etc.</span>
<span class="sd">        io_options: dict</span>
<span class="sd">            Options that get passed to the writer.</span>
<span class="sd">            See writer in pyomo.repn.plugins.gams_writer for details.</span>
<span class="sd">            Updated with any other keywords passed to solve method.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Make sure available() doesn&#39;t crash</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">available</span><span class="p">()</span>

        <span class="kn">from</span> <span class="nn">gams</span> <span class="kn">import</span> <span class="n">GamsWorkspace</span><span class="p">,</span> <span class="n">DebugLevel</span>
        <span class="kn">from</span> <span class="nn">gams.workspace</span> <span class="kn">import</span> <span class="n">GamsExceptionExecution</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;Exactly one model must be passed to solve method of GAMSSolver.&#39;</span>
            <span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># self.options are default for each run, overwritten by kwds</span>
        <span class="n">options</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
        <span class="n">options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwds</span><span class="p">)</span>

        <span class="n">load_solutions</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;load_solutions&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">tee</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;tee&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">logfile</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;logfile&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">keepfiles</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;keepfiles&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">tmpdir</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;tmpdir&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">report_timing</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;report_timing&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">io_options</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;io_options&quot;</span><span class="p">,</span> <span class="p">{})</span>

        <span class="c1"># Pass remaining keywords to writer, which will handle</span>
        <span class="c1"># any unrecognized arguments</span>
        <span class="n">io_options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>

        <span class="n">initial_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="c1"># Because GAMS changes the CWD when running the solver, we need</span>
        <span class="c1"># to convert user-provided file names to absolute paths</span>
        <span class="c1"># (relative to the current directory)</span>
        <span class="k">if</span> <span class="n">logfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">logfile</span><span class="p">)</span>

        <span class="c1">####################################################################</span>
        <span class="c1"># Presolve</span>
        <span class="c1">####################################################################</span>

        <span class="c1"># Create StringIO stream to pass to gams_writer, on which the</span>
        <span class="c1"># model file will be written. The writer also passes this StringIO</span>
        <span class="c1"># back, but output_file is defined in advance for clarity.</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">IBlock</span><span class="p">):</span>
            <span class="c1"># Kernel blocks have slightly different write method</span>
            <span class="n">smap_id</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="n">filename</span><span class="o">=</span><span class="n">output_file</span><span class="p">,</span>
                <span class="nb">format</span><span class="o">=</span><span class="n">ProblemFormat</span><span class="o">.</span><span class="n">gams</span><span class="p">,</span>
                <span class="n">_called_by_solver</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="o">**</span><span class="n">io_options</span>
            <span class="p">)</span>
            <span class="n">symbolMap</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;._symbol_maps&quot;</span><span class="p">)[</span><span class="n">smap_id</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">smap_id</span><span class="p">)</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="n">filename</span><span class="o">=</span><span class="n">output_file</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">ProblemFormat</span><span class="o">.</span><span class="n">gams</span><span class="p">,</span> <span class="n">io_options</span><span class="o">=</span><span class="n">io_options</span>
            <span class="p">)</span>
            <span class="n">symbolMap</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">solutions</span><span class="o">.</span><span class="n">symbol_map</span><span class="p">[</span><span class="n">smap_id</span><span class="p">]</span>

        <span class="n">presolve_completion_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">report_timing</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;      </span><span class="si">%6.2f</span><span class="s2"> seconds required for presolve&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">presolve_completion_time</span> <span class="o">-</span> <span class="n">initial_time</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="c1">####################################################################</span>
        <span class="c1"># Apply solver</span>
        <span class="c1">####################################################################</span>

        <span class="c1"># IMPORTANT - only delete the whole tmpdir if the solver was the one</span>
        <span class="c1"># that made the directory. Otherwise, just delete the files the solver</span>
        <span class="c1"># made, if not keepfiles. That way the user can select a directory</span>
        <span class="c1"># they already have, like the current directory, without having to</span>
        <span class="c1"># worry about the rest of the contents of that directory being deleted.</span>
        <span class="n">newdir</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">tmpdir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">):</span>
            <span class="n">newdir</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">ws</span> <span class="o">=</span> <span class="n">GamsWorkspace</span><span class="p">(</span>
            <span class="n">debug</span><span class="o">=</span><span class="n">DebugLevel</span><span class="o">.</span><span class="n">KeepFiles</span> <span class="k">if</span> <span class="n">keepfiles</span> <span class="k">else</span> <span class="n">DebugLevel</span><span class="o">.</span><span class="n">Off</span><span class="p">,</span>
            <span class="n">working_directory</span><span class="o">=</span><span class="n">tmpdir</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">t1</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">add_job_from_string</span><span class="p">(</span><span class="n">output_file</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">OutputStream</span><span class="p">(</span><span class="n">tee</span><span class="o">=</span><span class="n">tee</span><span class="p">,</span> <span class="n">logfile</span><span class="o">=</span><span class="n">logfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">output_stream</span><span class="p">:</span>
                <span class="n">t1</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="n">output_stream</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">GamsExceptionExecution</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">rc</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="c1"># Execution Error</span>
                    <span class="n">check_expr_evaluation</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">symbolMap</span><span class="p">,</span> <span class="s1">&#39;direct&#39;</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="c1"># Always name working directory or delete files,</span>
                <span class="c1"># regardless of any errors.</span>
                <span class="k">if</span> <span class="n">keepfiles</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">GAMS WORKING DIRECTORY: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ws</span><span class="o">.</span><span class="n">working_directory</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">tmpdir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># Garbage collect all references to t1.out_db</span>
                    <span class="c1"># So that .gdx file can be deleted</span>
                    <span class="n">t1</span> <span class="o">=</span> <span class="n">rec</span> <span class="o">=</span> <span class="n">rec_lo</span> <span class="o">=</span> <span class="n">rec_hi</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">file_removal_gams_direct</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">,</span> <span class="n">newdir</span><span class="p">)</span>
                <span class="k">raise</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="c1"># Catch other errors and remove files first</span>
            <span class="k">if</span> <span class="n">keepfiles</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">GAMS WORKING DIRECTORY: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ws</span><span class="o">.</span><span class="n">working_directory</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">tmpdir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Garbage collect all references to t1.out_db</span>
                <span class="c1"># So that .gdx file can be deleted</span>
                <span class="n">t1</span> <span class="o">=</span> <span class="n">rec</span> <span class="o">=</span> <span class="n">rec_lo</span> <span class="o">=</span> <span class="n">rec_hi</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">file_removal_gams_direct</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">,</span> <span class="n">newdir</span><span class="p">)</span>
            <span class="k">raise</span>

        <span class="n">solve_completion_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">report_timing</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;      </span><span class="si">%6.2f</span><span class="s2"> seconds required for solver&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">solve_completion_time</span> <span class="o">-</span> <span class="n">presolve_completion_time</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="c1">####################################################################</span>
        <span class="c1"># Postsolve</span>
        <span class="c1">####################################################################</span>

        <span class="c1"># import suffixes must be on the top-level model</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">IBlock</span><span class="p">):</span>
            <span class="n">model_suffixes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="n">comp</span><span class="o">.</span><span class="n">storage_key</span>
                <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">pyomo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">kernel</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">import_suffix_generator</span><span class="p">(</span>
                    <span class="n">model</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">descend_into</span><span class="o">=</span><span class="kc">False</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">model_suffixes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="n">name</span>
                <span class="k">for</span> <span class="p">(</span>
                    <span class="n">name</span><span class="p">,</span>
                    <span class="n">comp</span><span class="p">,</span>
                <span class="p">)</span> <span class="ow">in</span> <span class="n">pyomo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">active_import_suffix_generator</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="n">extract_dual</span> <span class="o">=</span> <span class="s1">&#39;dual&#39;</span> <span class="ow">in</span> <span class="n">model_suffixes</span>
        <span class="n">extract_rc</span> <span class="o">=</span> <span class="s1">&#39;rc&#39;</span> <span class="ow">in</span> <span class="n">model_suffixes</span>

        <span class="n">results</span> <span class="o">=</span> <span class="n">SolverResults</span><span class="p">()</span>
        <span class="n">results</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">working_directory</span><span class="p">,</span> <span class="n">t1</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.gms&#39;</span><span class="p">)</span>
        <span class="n">results</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">lower_bound</span> <span class="o">=</span> <span class="n">t1</span><span class="o">.</span><span class="n">out_db</span><span class="p">[</span><span class="s2">&quot;OBJEST&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">find_record</span><span class="p">()</span><span class="o">.</span><span class="n">value</span>
        <span class="n">results</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">upper_bound</span> <span class="o">=</span> <span class="n">t1</span><span class="o">.</span><span class="n">out_db</span><span class="p">[</span><span class="s2">&quot;OBJEST&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">find_record</span><span class="p">()</span><span class="o">.</span><span class="n">value</span>
        <span class="n">results</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">number_of_variables</span> <span class="o">=</span> <span class="n">t1</span><span class="o">.</span><span class="n">out_db</span><span class="p">[</span><span class="s2">&quot;NUMVAR&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">find_record</span><span class="p">()</span><span class="o">.</span><span class="n">value</span>
        <span class="n">results</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">number_of_constraints</span> <span class="o">=</span> <span class="n">t1</span><span class="o">.</span><span class="n">out_db</span><span class="p">[</span><span class="s2">&quot;NUMEQU&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">find_record</span><span class="p">()</span><span class="o">.</span><span class="n">value</span>
        <span class="n">results</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">number_of_nonzeros</span> <span class="o">=</span> <span class="n">t1</span><span class="o">.</span><span class="n">out_db</span><span class="p">[</span><span class="s2">&quot;NUMNZ&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">find_record</span><span class="p">()</span><span class="o">.</span><span class="n">value</span>
        <span class="n">results</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">number_of_binary_variables</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Includes binary vars:</span>
        <span class="n">results</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">number_of_integer_variables</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">t1</span><span class="o">.</span><span class="n">out_db</span><span class="p">[</span><span class="s2">&quot;NUMDVAR&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">find_record</span><span class="p">()</span><span class="o">.</span><span class="n">value</span>
        <span class="p">)</span>
        <span class="n">results</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">number_of_continuous_variables</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">t1</span><span class="o">.</span><span class="n">out_db</span><span class="p">[</span><span class="s2">&quot;NUMVAR&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">find_record</span><span class="p">()</span><span class="o">.</span><span class="n">value</span>
            <span class="o">-</span> <span class="n">t1</span><span class="o">.</span><span class="n">out_db</span><span class="p">[</span><span class="s2">&quot;NUMDVAR&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">find_record</span><span class="p">()</span><span class="o">.</span><span class="n">value</span>
        <span class="p">)</span>
        <span class="n">results</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">number_of_objectives</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># required by GAMS writer</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">component_data_objects</span><span class="p">(</span><span class="n">Objective</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Only one objective is allowed.&#39;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">objctvval</span> <span class="o">=</span> <span class="n">t1</span><span class="o">.</span><span class="n">out_db</span><span class="p">[</span><span class="s2">&quot;OBJVAL&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">find_record</span><span class="p">()</span><span class="o">.</span><span class="n">value</span>
        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">is_minimizing</span><span class="p">():</span>
            <span class="n">results</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">sense</span> <span class="o">=</span> <span class="n">ProblemSense</span><span class="o">.</span><span class="n">minimize</span>
            <span class="n">results</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">upper_bound</span> <span class="o">=</span> <span class="n">objctvval</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">sense</span> <span class="o">=</span> <span class="n">ProblemSense</span><span class="o">.</span><span class="n">maximize</span>
            <span class="n">results</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">lower_bound</span> <span class="o">=</span> <span class="n">objctvval</span>

        <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;GAMS &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">())</span>

        <span class="c1"># Init termination condition to None to give preference to this first</span>
        <span class="c1"># block of code, only set certain TC&#39;s below if it&#39;s still None</span>
        <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">solvestat</span> <span class="o">=</span> <span class="n">t1</span><span class="o">.</span><span class="n">out_db</span><span class="p">[</span><span class="s2">&quot;SOLVESTAT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">find_record</span><span class="p">()</span><span class="o">.</span><span class="n">value</span>
        <span class="k">if</span> <span class="n">solvestat</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">SolverStatus</span><span class="o">.</span><span class="n">ok</span>
        <span class="k">elif</span> <span class="n">solvestat</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">SolverStatus</span><span class="o">.</span><span class="n">ok</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="o">=</span> <span class="n">TerminationCondition</span><span class="o">.</span><span class="n">maxIterations</span>
        <span class="k">elif</span> <span class="n">solvestat</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">SolverStatus</span><span class="o">.</span><span class="n">ok</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="o">=</span> <span class="n">TerminationCondition</span><span class="o">.</span><span class="n">maxTimeLimit</span>
        <span class="k">elif</span> <span class="n">solvestat</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">SolverStatus</span><span class="o">.</span><span class="n">ok</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="o">=</span> <span class="n">TerminationCondition</span><span class="o">.</span><span class="n">maxEvaluations</span>
        <span class="k">elif</span> <span class="n">solvestat</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">SolverStatus</span><span class="o">.</span><span class="n">aborted</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">TerminationCondition</span><span class="o">.</span><span class="n">licensingProblems</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">solvestat</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">SolverStatus</span><span class="o">.</span><span class="n">aborted</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="o">=</span> <span class="n">TerminationCondition</span><span class="o">.</span><span class="n">userInterrupt</span>
        <span class="k">elif</span> <span class="n">solvestat</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">SolverStatus</span><span class="o">.</span><span class="n">error</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="o">=</span> <span class="n">TerminationCondition</span><span class="o">.</span><span class="n">solverFailure</span>
        <span class="k">elif</span> <span class="n">solvestat</span> <span class="o">==</span> <span class="mi">11</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">SolverStatus</span><span class="o">.</span><span class="n">error</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">TerminationCondition</span><span class="o">.</span><span class="n">internalSolverError</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">solvestat</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">SolverStatus</span><span class="o">.</span><span class="n">warning</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Solver quit with a problem (see LST file)&quot;</span>
        <span class="k">elif</span> <span class="n">solvestat</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">):</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">SolverStatus</span><span class="o">.</span><span class="n">error</span>
        <span class="k">elif</span> <span class="n">solvestat</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">SolverStatus</span><span class="o">.</span><span class="n">unknown</span>

        <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">return_code</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Not sure if this value is actually user time</span>
        <span class="c1"># &quot;the elapsed time it took to execute a solve statement in total&quot;</span>
        <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">user_time</span> <span class="o">=</span> <span class="n">t1</span><span class="o">.</span><span class="n">out_db</span><span class="p">[</span><span class="s2">&quot;ETSOLVE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">find_record</span><span class="p">()</span><span class="o">.</span><span class="n">value</span>
        <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">system_time</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">wallclock_time</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_message</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">soln</span> <span class="o">=</span> <span class="n">Solution</span><span class="p">()</span>

        <span class="n">modelstat</span> <span class="o">=</span> <span class="n">t1</span><span class="o">.</span><span class="n">out_db</span><span class="p">[</span><span class="s2">&quot;MODELSTAT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">find_record</span><span class="p">()</span><span class="o">.</span><span class="n">value</span>
        <span class="k">if</span> <span class="n">modelstat</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="o">=</span> <span class="n">TerminationCondition</span><span class="o">.</span><span class="n">optimal</span>
            <span class="n">soln</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">SolutionStatus</span><span class="o">.</span><span class="n">optimal</span>
        <span class="k">elif</span> <span class="n">modelstat</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="o">=</span> <span class="n">TerminationCondition</span><span class="o">.</span><span class="n">locallyOptimal</span>
            <span class="n">soln</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">SolutionStatus</span><span class="o">.</span><span class="n">locallyOptimal</span>
        <span class="k">elif</span> <span class="n">modelstat</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">18</span><span class="p">]:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="o">=</span> <span class="n">TerminationCondition</span><span class="o">.</span><span class="n">unbounded</span>
            <span class="n">soln</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">SolutionStatus</span><span class="o">.</span><span class="n">unbounded</span>
        <span class="k">elif</span> <span class="n">modelstat</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">19</span><span class="p">]:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="o">=</span> <span class="n">TerminationCondition</span><span class="o">.</span><span class="n">infeasible</span>
            <span class="n">soln</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">SolutionStatus</span><span class="o">.</span><span class="n">infeasible</span>
        <span class="k">elif</span> <span class="n">modelstat</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="o">=</span> <span class="n">TerminationCondition</span><span class="o">.</span><span class="n">feasible</span>
            <span class="n">soln</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">SolutionStatus</span><span class="o">.</span><span class="n">feasible</span>
        <span class="k">elif</span> <span class="n">modelstat</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
            <span class="c1"># &#39;Integer solution model found&#39;</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="o">=</span> <span class="n">TerminationCondition</span><span class="o">.</span><span class="n">optimal</span>
            <span class="n">soln</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">SolutionStatus</span><span class="o">.</span><span class="n">optimal</span>
        <span class="k">elif</span> <span class="n">modelstat</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">TerminationCondition</span><span class="o">.</span><span class="n">intermediateNonInteger</span>
            <span class="p">)</span>
            <span class="n">soln</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">SolutionStatus</span><span class="o">.</span><span class="n">other</span>
        <span class="k">elif</span> <span class="n">modelstat</span> <span class="o">==</span> <span class="mi">11</span><span class="p">:</span>
            <span class="c1"># Should be handled above, if modelstat and solvestat both</span>
            <span class="c1"># indicate a licensing problem</span>
            <span class="k">if</span> <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">TerminationCondition</span><span class="o">.</span><span class="n">licensingProblems</span>
                <span class="p">)</span>
            <span class="n">soln</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">SolutionStatus</span><span class="o">.</span><span class="n">error</span>
        <span class="k">elif</span> <span class="n">modelstat</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="o">=</span> <span class="n">TerminationCondition</span><span class="o">.</span><span class="n">error</span>
            <span class="n">soln</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">SolutionStatus</span><span class="o">.</span><span class="n">error</span>
        <span class="k">elif</span> <span class="n">modelstat</span> <span class="o">==</span> <span class="mi">14</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="o">=</span> <span class="n">TerminationCondition</span><span class="o">.</span><span class="n">noSolution</span>
            <span class="n">soln</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">SolutionStatus</span><span class="o">.</span><span class="n">unknown</span>
        <span class="k">elif</span> <span class="n">modelstat</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">15</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">17</span><span class="p">]:</span>
            <span class="c1"># Having to do with CNS models,</span>
            <span class="c1"># not sure what to make of status descriptions</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="o">=</span> <span class="n">TerminationCondition</span><span class="o">.</span><span class="n">optimal</span>
            <span class="n">soln</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">SolutionStatus</span><span class="o">.</span><span class="n">unsure</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># This is just a backup catch, all cases are handled above</span>
            <span class="n">soln</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">SolutionStatus</span><span class="o">.</span><span class="n">error</span>

        <span class="n">soln</span><span class="o">.</span><span class="n">gap</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">upper_bound</span> <span class="o">-</span> <span class="n">results</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">lower_bound</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">sym</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">symbolMap</span><span class="o">.</span><span class="n">bySymbol</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">IBlock</span><span class="p">):</span>
                <span class="c1"># Kernel variables have no &#39;parent_component&#39;</span>
                <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">ctype</span> <span class="ow">is</span> <span class="n">IObjective</span><span class="p">:</span>
                    <span class="n">soln</span><span class="o">.</span><span class="n">objective</span><span class="p">[</span><span class="n">sym</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Value&#39;</span><span class="p">:</span> <span class="n">objctvval</span><span class="p">}</span>
                <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">ctype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">IVariable</span><span class="p">:</span>
                    <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">parent_component</span><span class="p">()</span><span class="o">.</span><span class="n">ctype</span> <span class="ow">is</span> <span class="n">Objective</span><span class="p">:</span>
                    <span class="n">soln</span><span class="o">.</span><span class="n">objective</span><span class="p">[</span><span class="n">sym</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Value&#39;</span><span class="p">:</span> <span class="n">objctvval</span><span class="p">}</span>
                <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">parent_component</span><span class="p">()</span><span class="o">.</span><span class="n">ctype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Var</span><span class="p">:</span>
                    <span class="k">continue</span>
            <span class="n">rec</span> <span class="o">=</span> <span class="n">t1</span><span class="o">.</span><span class="n">out_db</span><span class="p">[</span><span class="n">sym</span><span class="p">]</span><span class="o">.</span><span class="n">find_record</span><span class="p">()</span>
            <span class="c1"># obj.value = rec.level</span>
            <span class="n">soln</span><span class="o">.</span><span class="n">variable</span><span class="p">[</span><span class="n">sym</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Value&quot;</span><span class="p">:</span> <span class="n">rec</span><span class="o">.</span><span class="n">level</span><span class="p">}</span>
            <span class="k">if</span> <span class="n">extract_rc</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">marginal</span><span class="p">):</span>
                <span class="c1"># Do not set marginals to nan</span>
                <span class="c1"># model.rc[obj] = rec.marginal</span>
                <span class="n">soln</span><span class="o">.</span><span class="n">variable</span><span class="p">[</span><span class="n">sym</span><span class="p">][</span><span class="s1">&#39;rc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">marginal</span>

        <span class="k">if</span> <span class="n">extract_dual</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">component_data_objects</span><span class="p">(</span><span class="n">Constraint</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">is_fixed</span><span class="p">()</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">has_lb</span><span class="p">()</span> <span class="ow">or</span> <span class="n">c</span><span class="o">.</span><span class="n">has_ub</span><span class="p">())):</span>
                    <span class="c1"># the constraint was not sent to GAMS</span>
                    <span class="k">continue</span>
                <span class="n">sym</span> <span class="o">=</span> <span class="n">symbolMap</span><span class="o">.</span><span class="n">getSymbol</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">equality</span><span class="p">:</span>
                    <span class="n">rec</span> <span class="o">=</span> <span class="n">t1</span><span class="o">.</span><span class="n">out_db</span><span class="p">[</span><span class="n">sym</span><span class="p">]</span><span class="o">.</span><span class="n">find_record</span><span class="p">()</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">marginal</span><span class="p">):</span>
                        <span class="c1"># model.dual[c] = rec.marginal</span>
                        <span class="n">soln</span><span class="o">.</span><span class="n">constraint</span><span class="p">[</span><span class="n">sym</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dual&#39;</span><span class="p">:</span> <span class="n">rec</span><span class="o">.</span><span class="n">marginal</span><span class="p">}</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># Solver didn&#39;t provide marginals,</span>
                        <span class="c1"># nothing else to do here</span>
                        <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Inequality, assume if 2-sided that only</span>
                    <span class="c1"># one side&#39;s marginal is nonzero</span>
                    <span class="c1"># Negate marginal for _lo equations</span>
                    <span class="n">marg</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">lower</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">rec_lo</span> <span class="o">=</span> <span class="n">t1</span><span class="o">.</span><span class="n">out_db</span><span class="p">[</span><span class="n">sym</span> <span class="o">+</span> <span class="s1">&#39;_lo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find_record</span><span class="p">()</span>
                        <span class="n">marg</span> <span class="o">-=</span> <span class="n">rec_lo</span><span class="o">.</span><span class="n">marginal</span>
                    <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">upper</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">rec_hi</span> <span class="o">=</span> <span class="n">t1</span><span class="o">.</span><span class="n">out_db</span><span class="p">[</span><span class="n">sym</span> <span class="o">+</span> <span class="s1">&#39;_hi&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find_record</span><span class="p">()</span>
                        <span class="n">marg</span> <span class="o">+=</span> <span class="n">rec_hi</span><span class="o">.</span><span class="n">marginal</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">marg</span><span class="p">):</span>
                        <span class="c1"># model.dual[c] = marg</span>
                        <span class="n">soln</span><span class="o">.</span><span class="n">constraint</span><span class="p">[</span><span class="n">sym</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dual&#39;</span><span class="p">:</span> <span class="n">marg</span><span class="p">}</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># Solver didn&#39;t provide marginals,</span>
                        <span class="c1"># nothing else to do here</span>
                        <span class="k">break</span>

        <span class="n">results</span><span class="o">.</span><span class="n">solution</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">soln</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">keepfiles</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">GAMS WORKING DIRECTORY: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ws</span><span class="o">.</span><span class="n">working_directory</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">tmpdir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Garbage collect all references to t1.out_db</span>
            <span class="c1"># So that .gdx file can be deleted</span>
            <span class="n">t1</span> <span class="o">=</span> <span class="n">rec</span> <span class="o">=</span> <span class="n">rec_lo</span> <span class="o">=</span> <span class="n">rec_hi</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">file_removal_gams_direct</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">,</span> <span class="n">newdir</span><span class="p">)</span>

        <span class="c1">####################################################################</span>
        <span class="c1"># Finish with results</span>
        <span class="c1">####################################################################</span>

        <span class="n">results</span><span class="o">.</span><span class="n">_smap_id</span> <span class="o">=</span> <span class="n">smap_id</span>
        <span class="n">results</span><span class="o">.</span><span class="n">_smap</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">IBlock</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">solution</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">results</span><span class="o">.</span><span class="n">solution</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">symbol_map</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;._symbol_maps&quot;</span><span class="p">)[</span>
                    <span class="n">results</span><span class="o">.</span><span class="n">_smap_id</span>
                <span class="p">]</span>
                <span class="n">results</span><span class="o">.</span><span class="n">solution</span><span class="p">(</span>
                    <span class="mi">0</span>
                <span class="p">)</span><span class="o">.</span><span class="n">default_variable_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_variable_value</span>
                <span class="k">if</span> <span class="n">load_solutions</span><span class="p">:</span>
                    <span class="n">model</span><span class="o">.</span><span class="n">load_solution</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">solution</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">solution</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="c1"># see the hack in the write method</span>
            <span class="c1"># we don&#39;t want this to stick around on the model</span>
            <span class="c1"># after the solve</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;._symbol_maps&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span>
            <span class="nb">delattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;._symbol_maps&quot;</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">results</span><span class="o">.</span><span class="n">_smap_id</span>
            <span class="k">if</span> <span class="n">load_solutions</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">solution</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;No solution is available&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">load_solutions</span><span class="p">:</span>
                <span class="n">model</span><span class="o">.</span><span class="n">solutions</span><span class="o">.</span><span class="n">load_from</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
                <span class="n">results</span><span class="o">.</span><span class="n">_smap_id</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">results</span><span class="o">.</span><span class="n">solution</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">results</span><span class="o">.</span><span class="n">_smap</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">solutions</span><span class="o">.</span><span class="n">symbol_map</span><span class="p">[</span><span class="n">smap_id</span><span class="p">]</span>
                <span class="n">model</span><span class="o">.</span><span class="n">solutions</span><span class="o">.</span><span class="n">delete_symbol_map</span><span class="p">(</span><span class="n">smap_id</span><span class="p">)</span>

        <span class="n">postsolve_completion_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">report_timing</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;      </span><span class="si">%6.2f</span><span class="s2"> seconds required for postsolve&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">postsolve_completion_time</span> <span class="o">-</span> <span class="n">solve_completion_time</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;      </span><span class="si">%6.2f</span><span class="s2"> seconds required total&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">postsolve_completion_time</span> <span class="o">-</span> <span class="n">initial_time</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">results</span></div></div>


<div class="viewcode-block" id="GAMSShell"><a class="viewcode-back" href="../../../../../library_reference/solvers/gams.html#pyomo.solvers.plugins.solvers.GAMS.GAMSShell">[docs]</a><span class="nd">@SolverFactory</span><span class="o">.</span><span class="n">register</span><span class="p">(</span>
    <span class="s1">&#39;_gams_shell&#39;</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;Shell interface to the GAMS modeling language&#39;</span>
<span class="p">)</span>
<span class="k">class</span> <span class="nc">GAMSShell</span><span class="p">(</span><span class="n">_GAMSSolver</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A generic shell interface to GAMS solvers.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="GAMSShell.available"><a class="viewcode-back" href="../../../../../library_reference/solvers/gams.html#pyomo.solvers.plugins.solvers.GAMS.GAMSShell.available">[docs]</a>    <span class="k">def</span> <span class="nf">available</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exception_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;True if the solver is available.&quot;&quot;&quot;</span>
        <span class="n">exe</span> <span class="o">=</span> <span class="n">pyomo</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">Executable</span><span class="p">(</span><span class="s2">&quot;gams&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">exe</span><span class="o">.</span><span class="n">available</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">exception_flag</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span>
                <span class="s2">&quot;No &#39;gams&#39; command found on system PATH - GAMS shell &quot;</span>
                <span class="s2">&quot;solver functionality is not available.&quot;</span>
            <span class="p">)</span>
        <span class="c1"># New versions of GAMS require a license to run anything.</span>
        <span class="c1"># Instead of parsing the output, we will try solving a trivial</span>
        <span class="c1"># model.</span>
        <span class="n">avail</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_simple_model</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">avail</span> <span class="ow">and</span> <span class="n">exception_flag</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span>
                <span class="s2">&quot;&#39;gams&#39; command failed to solve a simple model - &quot;</span>
                <span class="s2">&quot;GAMS shell solver functionality is not available.&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">avail</span></div>

    <span class="k">def</span> <span class="nf">license_is_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># New versions of the community license can run LPs up to 5k</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_simple_model</span><span class="p">(</span><span class="mi">5001</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_run_simple_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="n">solver_exec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">executable</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">solver_exec</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">tmpdir</span> <span class="o">=</span> <span class="n">mkdtemp</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">test</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">,</span> <span class="s1">&#39;test.gms&#39;</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">FILE</span><span class="p">:</span>
                <span class="n">FILE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_simple_model</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                <span class="p">[</span><span class="n">solver_exec</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="s2">&quot;curdir=&quot;</span> <span class="o">+</span> <span class="n">tmpdir</span><span class="p">,</span> <span class="s1">&#39;lo=0&#39;</span><span class="p">],</span>
                <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">DEVNULL</span><span class="p">,</span>
                <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">DEVNULL</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_default_executable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">executable</span> <span class="o">=</span> <span class="n">pyomo</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">Executable</span><span class="p">(</span><span class="s2">&quot;gams&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">executable</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Could not locate the &#39;gams&#39; executable, &quot;</span>
                <span class="s2">&quot;which is required for solver gams&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enable</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">executable</span><span class="o">.</span><span class="n">path</span><span class="p">()</span>

<div class="viewcode-block" id="GAMSShell.executable"><a class="viewcode-back" href="../../../../../library_reference/solvers/gams.html#pyomo.solvers.plugins.solvers.GAMS.GAMSShell.executable">[docs]</a>    <span class="k">def</span> <span class="nf">executable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the executable used by this solver.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_executable</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_get_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a tuple describing the solver executable version.&quot;&quot;&quot;</span>
        <span class="n">solver_exec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">executable</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">solver_exec</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_extract_version</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># specify logging to stdout for windows compatibility</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="n">solver_exec</span><span class="p">,</span> <span class="s2">&quot;audit&quot;</span><span class="p">,</span> <span class="s2">&quot;lo=3&quot;</span><span class="p">]</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                <span class="n">cmd</span><span class="p">,</span>
                <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">STDOUT</span><span class="p">,</span>
                <span class="n">universal_newlines</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">_extract_version</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_parse_special_values</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="mf">1.0e300</span> <span class="ow">or</span> <span class="n">value</span> <span class="o">==</span> <span class="mf">2.0e300</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="mf">3.0e300</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="mf">4.0e300</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="mf">5.0e300</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">sys</span><span class="o">.</span><span class="n">float_info</span><span class="o">.</span><span class="n">epsilon</span>
        <span class="k">return</span> <span class="n">value</span>

<div class="viewcode-block" id="GAMSShell.solve"><a class="viewcode-back" href="../../../../../library_reference/solvers/gams.html#pyomo.solvers.plugins.solvers.GAMS.GAMSShell.solve">[docs]</a>    <span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Solve a model via the GAMS executable.</span>

<span class="sd">        Keyword Arguments</span>
<span class="sd">        -----------------</span>
<span class="sd">        tee=False: bool</span>
<span class="sd">            Output GAMS log to stdout.</span>
<span class="sd">        logfile=None: str</span>
<span class="sd">            Filename to output GAMS log to a file.</span>
<span class="sd">        load_solutions=True: bool</span>
<span class="sd">            Load solution into model. If False, the results</span>
<span class="sd">            object will contain the solution data.</span>
<span class="sd">        keepfiles=False: bool</span>
<span class="sd">            Keep temporary files.</span>
<span class="sd">        tmpdir=None: str</span>
<span class="sd">            Specify directory path for storing temporary files.</span>
<span class="sd">            A directory will be created if one of this name doesn&#39;t exist.</span>
<span class="sd">            By default uses the system default temporary path.</span>
<span class="sd">        report_timing=False: bool</span>
<span class="sd">            Print timing reports for presolve, solver, postsolve, etc.</span>
<span class="sd">        io_options: dict</span>
<span class="sd">            Options that get passed to the writer.</span>
<span class="sd">            See writer in pyomo.repn.plugins.gams_writer for details.</span>
<span class="sd">            Updated with any other keywords passed to solve method.</span>
<span class="sd">            Note: put_results is not available for modification on</span>
<span class="sd">            GAMSShell solver.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Make sure available() doesn&#39;t crash</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">available</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;Exactly one model must be passed to solve method of GAMSSolver.&#39;</span>
            <span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># self.options are default for each run, overwritten by kwds</span>
        <span class="n">options</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
        <span class="n">options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwds</span><span class="p">)</span>

        <span class="n">load_solutions</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;load_solutions&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">tee</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;tee&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">logfile</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;logfile&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">keepfiles</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;keepfiles&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">tmpdir</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;tmpdir&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">report_timing</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;report_timing&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">io_options</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;io_options&quot;</span><span class="p">,</span> <span class="p">{})</span>

        <span class="n">io_options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>

        <span class="c1"># Pass remaining keywords to writer, which will handle</span>
        <span class="c1"># any unrecognized arguments</span>
        <span class="n">initial_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="c1"># Because GAMS changes the CWD when running the solver, we need</span>
        <span class="c1"># to convert user-provided file names to absolute paths</span>
        <span class="c1"># (relative to the current directory)</span>
        <span class="k">if</span> <span class="n">logfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">logfile</span><span class="p">)</span>

        <span class="c1">####################################################################</span>
        <span class="c1"># Presolve</span>
        <span class="c1">####################################################################</span>

        <span class="c1"># IMPORTANT - only delete the whole tmpdir if the solver was the one</span>
        <span class="c1"># that made the directory. Otherwise, just delete the files the solver</span>
        <span class="c1"># made, if not keepfiles. That way the user can select a directory</span>
        <span class="c1"># they already have, like the current directory, without having to</span>
        <span class="c1"># worry about the rest of the contents of that directory being deleted.</span>
        <span class="n">newdir</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">tmpdir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tmpdir</span> <span class="o">=</span> <span class="n">mkdtemp</span><span class="p">()</span>
            <span class="n">newdir</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">):</span>
            <span class="c1"># makedirs creates all necessary intermediate directories in order</span>
            <span class="c1"># to create the path to tmpdir, if they don&#39;t already exist.</span>
            <span class="c1"># However, if keepfiles is False, we only delete the final folder,</span>
            <span class="c1"># leaving the rest of the intermediate ones.</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">)</span>
            <span class="n">newdir</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">output</span> <span class="o">=</span> <span class="s2">&quot;model.gms&quot;</span>
        <span class="n">output_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
        <span class="n">lst</span> <span class="o">=</span> <span class="s2">&quot;output.lst&quot;</span>
        <span class="n">lst_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">,</span> <span class="n">lst</span><span class="p">)</span>

        <span class="n">put_results</span> <span class="o">=</span> <span class="s2">&quot;results&quot;</span>
        <span class="n">io_options</span><span class="p">[</span><span class="s2">&quot;put_results&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">put_results</span>
        <span class="n">io_options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;put_results_format&quot;</span><span class="p">,</span> <span class="s1">&#39;gdx&#39;</span> <span class="k">if</span> <span class="n">gdxcc_available</span> <span class="k">else</span> <span class="s1">&#39;dat&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">io_options</span><span class="p">[</span><span class="s1">&#39;put_results_format&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;gdx&#39;</span><span class="p">:</span>
            <span class="n">results_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">,</span> <span class="s2">&quot;GAMS_MODEL_p.gdx&quot;</span><span class="p">)</span>
            <span class="n">statresults_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_s.gdx&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">put_results</span><span class="p">,))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">results_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.dat&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">put_results</span><span class="p">,))</span>
            <span class="n">statresults_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">stat.dat&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">put_results</span><span class="p">,))</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">IBlock</span><span class="p">):</span>
            <span class="c1"># Kernel blocks have slightly different write method</span>
            <span class="n">smap_id</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="n">filename</span><span class="o">=</span><span class="n">output_filename</span><span class="p">,</span>
                <span class="nb">format</span><span class="o">=</span><span class="n">ProblemFormat</span><span class="o">.</span><span class="n">gams</span><span class="p">,</span>
                <span class="n">_called_by_solver</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="o">**</span><span class="n">io_options</span>
            <span class="p">)</span>
            <span class="n">symbolMap</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;._symbol_maps&quot;</span><span class="p">)[</span><span class="n">smap_id</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">smap_id</span><span class="p">)</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="n">filename</span><span class="o">=</span><span class="n">output_filename</span><span class="p">,</span>
                <span class="nb">format</span><span class="o">=</span><span class="n">ProblemFormat</span><span class="o">.</span><span class="n">gams</span><span class="p">,</span>
                <span class="n">io_options</span><span class="o">=</span><span class="n">io_options</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">symbolMap</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">solutions</span><span class="o">.</span><span class="n">symbol_map</span><span class="p">[</span><span class="n">smap_id</span><span class="p">]</span>

        <span class="n">presolve_completion_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">report_timing</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;      </span><span class="si">%6.2f</span><span class="s2"> seconds required for presolve&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">presolve_completion_time</span> <span class="o">-</span> <span class="n">initial_time</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="c1">####################################################################</span>
        <span class="c1"># Apply solver</span>
        <span class="c1">####################################################################</span>

        <span class="n">exe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">executable</span><span class="p">()</span>
        <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="n">exe</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="s2">&quot;o=&quot;</span> <span class="o">+</span> <span class="n">lst</span><span class="p">,</span> <span class="s2">&quot;curdir=&quot;</span> <span class="o">+</span> <span class="n">tmpdir</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">tee</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">logfile</span><span class="p">:</span>
            <span class="c1"># default behaviour of gams is to print to console, for</span>
            <span class="c1"># compatibility with windows and *nix we want to explicitly log to</span>
            <span class="c1"># stdout (see https://www.gams.com/latest/docs/UG_GamsCall.html)</span>
            <span class="n">command</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;lo=3&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">tee</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">logfile</span><span class="p">:</span>
            <span class="n">command</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;lo=0&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">tee</span> <span class="ow">and</span> <span class="n">logfile</span><span class="p">:</span>
            <span class="n">command</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;lo=2&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">tee</span> <span class="ow">and</span> <span class="n">logfile</span><span class="p">:</span>
            <span class="n">command</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;lo=4&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">logfile</span><span class="p">:</span>
            <span class="n">command</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;lf=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">logfile</span><span class="p">))</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">ostreams</span> <span class="o">=</span> <span class="p">[</span><span class="n">StringIO</span><span class="p">()]</span>
            <span class="k">if</span> <span class="n">tee</span><span class="p">:</span>
                <span class="n">ostreams</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">TeeStream</span><span class="p">(</span><span class="o">*</span><span class="n">ostreams</span><span class="p">)</span> <span class="k">as</span> <span class="n">t</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">t</span><span class="o">.</span><span class="n">STDOUT</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">t</span><span class="o">.</span><span class="n">STDERR</span><span class="p">)</span>
            <span class="n">rc</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span>
            <span class="n">txt</span> <span class="o">=</span> <span class="n">ostreams</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">keepfiles</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">GAMS WORKING DIRECTORY: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">tmpdir</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">rc</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">rc</span> <span class="o">==</span> <span class="mi">127</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Command &#39;gams&#39; was not recognized&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">rc</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">rc</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="c1"># Execution Error</span>
                    <span class="c1"># Run check_expr_evaluation, which errors if necessary</span>
                    <span class="n">check_expr_evaluation</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">symbolMap</span><span class="p">,</span> <span class="s1">&#39;shell&#39;</span><span class="p">)</span>
                <span class="c1"># If nothing was raised, or for all other cases, raise this</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="s2">&quot;GAMS encountered an error during solve. &quot;</span>
                    <span class="s2">&quot;Check listing file for details.&quot;</span>
                <span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">lst_filename</span><span class="p">):</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">lst_filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">FILE</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;GAMS Listing file:</span><span class="se">\n\n</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">FILE</span><span class="o">.</span><span class="n">read</span><span class="p">(),))</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s2">&quot;GAMS encountered an error during solve. &quot;</span>
                    <span class="s2">&quot;Check listing file for details.&quot;</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">io_options</span><span class="p">[</span><span class="s1">&#39;put_results_format&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;gdx&#39;</span><span class="p">:</span>
                <span class="n">model_soln</span><span class="p">,</span> <span class="n">stat_vars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_gdx_results</span><span class="p">(</span>
                    <span class="n">results_filename</span><span class="p">,</span> <span class="n">statresults_filename</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">model_soln</span><span class="p">,</span> <span class="n">stat_vars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_dat_results</span><span class="p">(</span>
                    <span class="n">results_filename</span><span class="p">,</span> <span class="n">statresults_filename</span>
                <span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">keepfiles</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">newdir</span><span class="p">:</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">output_filename</span><span class="p">)</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">lst_filename</span><span class="p">)</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">results_filename</span><span class="p">)</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">statresults_filename</span><span class="p">)</span>

        <span class="n">solve_completion_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">report_timing</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;      </span><span class="si">%6.2f</span><span class="s2"> seconds required for solver&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">solve_completion_time</span> <span class="o">-</span> <span class="n">presolve_completion_time</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="c1">####################################################################</span>
        <span class="c1"># Postsolve</span>
        <span class="c1">####################################################################</span>

        <span class="c1"># import suffixes must be on the top-level model</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">IBlock</span><span class="p">):</span>
            <span class="n">model_suffixes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="n">comp</span><span class="o">.</span><span class="n">storage_key</span>
                <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">pyomo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">kernel</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">import_suffix_generator</span><span class="p">(</span>
                    <span class="n">model</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">descend_into</span><span class="o">=</span><span class="kc">False</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">model_suffixes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="n">name</span>
                <span class="k">for</span> <span class="p">(</span>
                    <span class="n">name</span><span class="p">,</span>
                    <span class="n">comp</span><span class="p">,</span>
                <span class="p">)</span> <span class="ow">in</span> <span class="n">pyomo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">active_import_suffix_generator</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="n">extract_dual</span> <span class="o">=</span> <span class="s1">&#39;dual&#39;</span> <span class="ow">in</span> <span class="n">model_suffixes</span>
        <span class="n">extract_rc</span> <span class="o">=</span> <span class="s1">&#39;rc&#39;</span> <span class="ow">in</span> <span class="n">model_suffixes</span>

        <span class="n">results</span> <span class="o">=</span> <span class="n">SolverResults</span><span class="p">()</span>
        <span class="n">results</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">output_filename</span>
        <span class="n">results</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">lower_bound</span> <span class="o">=</span> <span class="n">stat_vars</span><span class="p">[</span><span class="s2">&quot;OBJEST&quot;</span><span class="p">]</span>
        <span class="n">results</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">upper_bound</span> <span class="o">=</span> <span class="n">stat_vars</span><span class="p">[</span><span class="s2">&quot;OBJEST&quot;</span><span class="p">]</span>
        <span class="n">results</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">number_of_variables</span> <span class="o">=</span> <span class="n">stat_vars</span><span class="p">[</span><span class="s2">&quot;NUMVAR&quot;</span><span class="p">]</span>
        <span class="n">results</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">number_of_constraints</span> <span class="o">=</span> <span class="n">stat_vars</span><span class="p">[</span><span class="s2">&quot;NUMEQU&quot;</span><span class="p">]</span>
        <span class="n">results</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">number_of_nonzeros</span> <span class="o">=</span> <span class="n">stat_vars</span><span class="p">[</span><span class="s2">&quot;NUMNZ&quot;</span><span class="p">]</span>
        <span class="n">results</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">number_of_binary_variables</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Includes binary vars:</span>
        <span class="n">results</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">number_of_integer_variables</span> <span class="o">=</span> <span class="n">stat_vars</span><span class="p">[</span><span class="s2">&quot;NUMDVAR&quot;</span><span class="p">]</span>
        <span class="n">results</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">number_of_continuous_variables</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">stat_vars</span><span class="p">[</span><span class="s2">&quot;NUMVAR&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">stat_vars</span><span class="p">[</span><span class="s2">&quot;NUMDVAR&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">results</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">number_of_objectives</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># required by GAMS writer</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">component_data_objects</span><span class="p">(</span><span class="n">Objective</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Only one objective is allowed.&#39;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">objctvval</span> <span class="o">=</span> <span class="n">stat_vars</span><span class="p">[</span><span class="s2">&quot;OBJVAL&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">is_minimizing</span><span class="p">():</span>
            <span class="n">results</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">sense</span> <span class="o">=</span> <span class="n">ProblemSense</span><span class="o">.</span><span class="n">minimize</span>
            <span class="n">results</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">upper_bound</span> <span class="o">=</span> <span class="n">objctvval</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">sense</span> <span class="o">=</span> <span class="n">ProblemSense</span><span class="o">.</span><span class="n">maximize</span>
            <span class="n">results</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">lower_bound</span> <span class="o">=</span> <span class="n">objctvval</span>

        <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;GAMS &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">())</span>

        <span class="c1"># Init termination condition to None to give preference to this first</span>
        <span class="c1"># block of code, only set certain TC&#39;s below if it&#39;s still None</span>
        <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">solvestat</span> <span class="o">=</span> <span class="n">stat_vars</span><span class="p">[</span><span class="s2">&quot;SOLVESTAT&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">solvestat</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">SolverStatus</span><span class="o">.</span><span class="n">ok</span>
        <span class="k">elif</span> <span class="n">solvestat</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">SolverStatus</span><span class="o">.</span><span class="n">ok</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="o">=</span> <span class="n">TerminationCondition</span><span class="o">.</span><span class="n">maxIterations</span>
        <span class="k">elif</span> <span class="n">solvestat</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">SolverStatus</span><span class="o">.</span><span class="n">ok</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="o">=</span> <span class="n">TerminationCondition</span><span class="o">.</span><span class="n">maxTimeLimit</span>
        <span class="k">elif</span> <span class="n">solvestat</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">SolverStatus</span><span class="o">.</span><span class="n">ok</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="o">=</span> <span class="n">TerminationCondition</span><span class="o">.</span><span class="n">maxEvaluations</span>
        <span class="k">elif</span> <span class="n">solvestat</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">SolverStatus</span><span class="o">.</span><span class="n">aborted</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">TerminationCondition</span><span class="o">.</span><span class="n">licensingProblems</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">solvestat</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">SolverStatus</span><span class="o">.</span><span class="n">aborted</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="o">=</span> <span class="n">TerminationCondition</span><span class="o">.</span><span class="n">userInterrupt</span>
        <span class="k">elif</span> <span class="n">solvestat</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">SolverStatus</span><span class="o">.</span><span class="n">error</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="o">=</span> <span class="n">TerminationCondition</span><span class="o">.</span><span class="n">solverFailure</span>
        <span class="k">elif</span> <span class="n">solvestat</span> <span class="o">==</span> <span class="mi">11</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">SolverStatus</span><span class="o">.</span><span class="n">error</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">TerminationCondition</span><span class="o">.</span><span class="n">internalSolverError</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">solvestat</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">SolverStatus</span><span class="o">.</span><span class="n">warning</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Solver quit with a problem (see LST file)&quot;</span>
        <span class="k">elif</span> <span class="n">solvestat</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">):</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">SolverStatus</span><span class="o">.</span><span class="n">error</span>
        <span class="k">elif</span> <span class="n">solvestat</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">SolverStatus</span><span class="o">.</span><span class="n">unknown</span>

        <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">return_code</span> <span class="o">=</span> <span class="n">rc</span>  <span class="c1"># 0</span>
        <span class="c1"># Not sure if this value is actually user time</span>
        <span class="c1"># &quot;the elapsed time it took to execute a solve statement in total&quot;</span>
        <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">user_time</span> <span class="o">=</span> <span class="n">stat_vars</span><span class="p">[</span><span class="s2">&quot;ETSOLVE&quot;</span><span class="p">]</span>
        <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">system_time</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">wallclock_time</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_message</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">soln</span> <span class="o">=</span> <span class="n">Solution</span><span class="p">()</span>

        <span class="n">modelstat</span> <span class="o">=</span> <span class="n">stat_vars</span><span class="p">[</span><span class="s2">&quot;MODELSTAT&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">modelstat</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="o">=</span> <span class="n">TerminationCondition</span><span class="o">.</span><span class="n">optimal</span>
            <span class="n">soln</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">SolutionStatus</span><span class="o">.</span><span class="n">optimal</span>
        <span class="k">elif</span> <span class="n">modelstat</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="o">=</span> <span class="n">TerminationCondition</span><span class="o">.</span><span class="n">locallyOptimal</span>
            <span class="n">soln</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">SolutionStatus</span><span class="o">.</span><span class="n">locallyOptimal</span>
        <span class="k">elif</span> <span class="n">modelstat</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">18</span><span class="p">]:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="o">=</span> <span class="n">TerminationCondition</span><span class="o">.</span><span class="n">unbounded</span>
            <span class="n">soln</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">SolutionStatus</span><span class="o">.</span><span class="n">unbounded</span>
        <span class="k">elif</span> <span class="n">modelstat</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">19</span><span class="p">]:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="o">=</span> <span class="n">TerminationCondition</span><span class="o">.</span><span class="n">infeasible</span>
            <span class="n">soln</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">SolutionStatus</span><span class="o">.</span><span class="n">infeasible</span>
        <span class="k">elif</span> <span class="n">modelstat</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="o">=</span> <span class="n">TerminationCondition</span><span class="o">.</span><span class="n">feasible</span>
            <span class="n">soln</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">SolutionStatus</span><span class="o">.</span><span class="n">feasible</span>
        <span class="k">elif</span> <span class="n">modelstat</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
            <span class="c1"># &#39;Integer solution model found&#39;</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="o">=</span> <span class="n">TerminationCondition</span><span class="o">.</span><span class="n">optimal</span>
            <span class="n">soln</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">SolutionStatus</span><span class="o">.</span><span class="n">optimal</span>
        <span class="k">elif</span> <span class="n">modelstat</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">TerminationCondition</span><span class="o">.</span><span class="n">intermediateNonInteger</span>
            <span class="p">)</span>
            <span class="n">soln</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">SolutionStatus</span><span class="o">.</span><span class="n">other</span>
        <span class="k">elif</span> <span class="n">modelstat</span> <span class="o">==</span> <span class="mi">11</span><span class="p">:</span>
            <span class="c1"># Should be handled above, if modelstat and solvestat both</span>
            <span class="c1"># indicate a licensing problem</span>
            <span class="k">if</span> <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">TerminationCondition</span><span class="o">.</span><span class="n">licensingProblems</span>
                <span class="p">)</span>
            <span class="n">soln</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">SolutionStatus</span><span class="o">.</span><span class="n">error</span>
        <span class="k">elif</span> <span class="n">modelstat</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="o">=</span> <span class="n">TerminationCondition</span><span class="o">.</span><span class="n">error</span>
            <span class="n">soln</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">SolutionStatus</span><span class="o">.</span><span class="n">error</span>
        <span class="k">elif</span> <span class="n">modelstat</span> <span class="o">==</span> <span class="mi">14</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="o">=</span> <span class="n">TerminationCondition</span><span class="o">.</span><span class="n">noSolution</span>
            <span class="n">soln</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">SolutionStatus</span><span class="o">.</span><span class="n">unknown</span>
        <span class="k">elif</span> <span class="n">modelstat</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">15</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">17</span><span class="p">]:</span>
            <span class="c1"># Having to do with CNS models,</span>
            <span class="c1"># not sure what to make of status descriptions</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">termination_condition</span> <span class="o">=</span> <span class="n">TerminationCondition</span><span class="o">.</span><span class="n">optimal</span>
            <span class="n">soln</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">SolutionStatus</span><span class="o">.</span><span class="n">unsure</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># This is just a backup catch, all cases are handled above</span>
            <span class="n">soln</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">SolutionStatus</span><span class="o">.</span><span class="n">error</span>

        <span class="n">soln</span><span class="o">.</span><span class="n">gap</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">upper_bound</span> <span class="o">-</span> <span class="n">results</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">lower_bound</span><span class="p">)</span>

        <span class="n">has_rc_info</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">sym</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">symbolMap</span><span class="o">.</span><span class="n">bySymbol</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">IBlock</span><span class="p">):</span>
                <span class="c1"># Kernel variables have no &#39;parent_component&#39;</span>
                <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">ctype</span> <span class="ow">is</span> <span class="n">IObjective</span><span class="p">:</span>
                    <span class="n">soln</span><span class="o">.</span><span class="n">objective</span><span class="p">[</span><span class="n">sym</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Value&#39;</span><span class="p">:</span> <span class="n">objctvval</span><span class="p">}</span>
                <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">ctype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">IVariable</span><span class="p">:</span>
                    <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">parent_component</span><span class="p">()</span><span class="o">.</span><span class="n">ctype</span> <span class="ow">is</span> <span class="n">Objective</span><span class="p">:</span>
                    <span class="n">soln</span><span class="o">.</span><span class="n">objective</span><span class="p">[</span><span class="n">sym</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Value&#39;</span><span class="p">:</span> <span class="n">objctvval</span><span class="p">}</span>
                <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">parent_component</span><span class="p">()</span><span class="o">.</span><span class="n">ctype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Var</span><span class="p">:</span>
                    <span class="k">continue</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">rec</span> <span class="o">=</span> <span class="n">model_soln</span><span class="p">[</span><span class="n">sym</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="c1"># no solution returned</span>
                <span class="n">rec</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">))</span>
            <span class="c1"># obj.value = float(rec[0])</span>
            <span class="n">soln</span><span class="o">.</span><span class="n">variable</span><span class="p">[</span><span class="n">sym</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Value&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="mi">0</span><span class="p">])}</span>
            <span class="k">if</span> <span class="n">extract_rc</span> <span class="ow">and</span> <span class="n">has_rc_info</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># model.rc[obj] = float(rec[1])</span>
                    <span class="n">soln</span><span class="o">.</span><span class="n">variable</span><span class="p">[</span><span class="n">sym</span><span class="p">][</span><span class="s1">&#39;rc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="c1"># Solver didn&#39;t provide marginals</span>
                    <span class="n">has_rc_info</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">extract_dual</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">component_data_objects</span><span class="p">(</span><span class="n">Constraint</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">is_fixed</span><span class="p">())</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">has_lb</span><span class="p">()</span> <span class="ow">or</span> <span class="n">c</span><span class="o">.</span><span class="n">has_ub</span><span class="p">())):</span>
                    <span class="c1"># the constraint was not sent to GAMS</span>
                    <span class="k">continue</span>
                <span class="n">sym</span> <span class="o">=</span> <span class="n">symbolMap</span><span class="o">.</span><span class="n">getSymbol</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">equality</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">rec</span> <span class="o">=</span> <span class="n">model_soln</span><span class="p">[</span><span class="n">sym</span><span class="p">]</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="c1"># no solution returned</span>
                        <span class="n">rec</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">))</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="c1"># model.dual[c] = float(rec[1])</span>
                        <span class="n">soln</span><span class="o">.</span><span class="n">constraint</span><span class="p">[</span><span class="n">sym</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dual&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="mi">1</span><span class="p">])}</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="c1"># Solver didn&#39;t provide marginals</span>
                        <span class="c1"># nothing else to do here</span>
                        <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Inequality, assume if 2-sided that only</span>
                    <span class="c1"># one side&#39;s marginal is nonzero</span>
                    <span class="c1"># Negate marginal for _lo equations</span>
                    <span class="n">marg</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">lower</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">rec_lo</span> <span class="o">=</span> <span class="n">model_soln</span><span class="p">[</span><span class="n">sym</span> <span class="o">+</span> <span class="s1">&#39;_lo&#39;</span><span class="p">]</span>
                        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                            <span class="c1"># no solution returned</span>
                            <span class="n">rec_lo</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">))</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">marg</span> <span class="o">-=</span> <span class="nb">float</span><span class="p">(</span><span class="n">rec_lo</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                            <span class="c1"># Solver didn&#39;t provide marginals</span>
                            <span class="n">marg</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">upper</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">rec_hi</span> <span class="o">=</span> <span class="n">model_soln</span><span class="p">[</span><span class="n">sym</span> <span class="o">+</span> <span class="s1">&#39;_hi&#39;</span><span class="p">]</span>
                        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                            <span class="c1"># no solution returned</span>
                            <span class="n">rec_hi</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">))</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">marg</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">rec_hi</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                            <span class="c1"># Solver didn&#39;t provide marginals</span>
                            <span class="n">marg</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">marg</span><span class="p">):</span>
                        <span class="c1"># model.dual[c] = marg</span>
                        <span class="n">soln</span><span class="o">.</span><span class="n">constraint</span><span class="p">[</span><span class="n">sym</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dual&#39;</span><span class="p">:</span> <span class="n">marg</span><span class="p">}</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># Solver didn&#39;t provide marginals</span>
                        <span class="c1"># nothing else to do here</span>
                        <span class="k">break</span>

        <span class="n">results</span><span class="o">.</span><span class="n">solution</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">soln</span><span class="p">)</span>

        <span class="c1">####################################################################</span>
        <span class="c1"># Finish with results</span>
        <span class="c1">####################################################################</span>

        <span class="n">results</span><span class="o">.</span><span class="n">_smap_id</span> <span class="o">=</span> <span class="n">smap_id</span>
        <span class="n">results</span><span class="o">.</span><span class="n">_smap</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">IBlock</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">solution</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">results</span><span class="o">.</span><span class="n">solution</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">symbol_map</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;._symbol_maps&quot;</span><span class="p">)[</span>
                    <span class="n">results</span><span class="o">.</span><span class="n">_smap_id</span>
                <span class="p">]</span>
                <span class="n">results</span><span class="o">.</span><span class="n">solution</span><span class="p">(</span>
                    <span class="mi">0</span>
                <span class="p">)</span><span class="o">.</span><span class="n">default_variable_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_variable_value</span>
                <span class="k">if</span> <span class="n">load_solutions</span><span class="p">:</span>
                    <span class="n">model</span><span class="o">.</span><span class="n">load_solution</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">solution</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">solution</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="c1"># see the hack in the write method</span>
            <span class="c1"># we don&#39;t want this to stick around on the model</span>
            <span class="c1"># after the solve</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;._symbol_maps&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span>
            <span class="nb">delattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;._symbol_maps&quot;</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">results</span><span class="o">.</span><span class="n">_smap_id</span>
            <span class="k">if</span> <span class="n">load_solutions</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">solution</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;No solution is available&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">load_solutions</span><span class="p">:</span>
                <span class="n">model</span><span class="o">.</span><span class="n">solutions</span><span class="o">.</span><span class="n">load_from</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
                <span class="n">results</span><span class="o">.</span><span class="n">_smap_id</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">results</span><span class="o">.</span><span class="n">solution</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">results</span><span class="o">.</span><span class="n">_smap</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">solutions</span><span class="o">.</span><span class="n">symbol_map</span><span class="p">[</span><span class="n">smap_id</span><span class="p">]</span>
                <span class="n">model</span><span class="o">.</span><span class="n">solutions</span><span class="o">.</span><span class="n">delete_symbol_map</span><span class="p">(</span><span class="n">smap_id</span><span class="p">)</span>

        <span class="n">postsolve_completion_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">report_timing</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;      </span><span class="si">%6.2f</span><span class="s2"> seconds required for postsolve&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">postsolve_completion_time</span> <span class="o">-</span> <span class="n">solve_completion_time</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;      </span><span class="si">%6.2f</span><span class="s2"> seconds required total&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">postsolve_completion_time</span> <span class="o">-</span> <span class="n">initial_time</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">results</span></div>

    <span class="k">def</span> <span class="nf">_parse_gdx_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results_filename</span><span class="p">,</span> <span class="n">statresults_filename</span><span class="p">):</span>
        <span class="n">model_soln</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">stat_vars</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s1">&#39;MODELSTAT&#39;</span><span class="p">,</span>
                <span class="s1">&#39;SOLVESTAT&#39;</span><span class="p">,</span>
                <span class="s1">&#39;OBJEST&#39;</span><span class="p">,</span>
                <span class="s1">&#39;OBJVAL&#39;</span><span class="p">,</span>
                <span class="s1">&#39;NUMVAR&#39;</span><span class="p">,</span>
                <span class="s1">&#39;NUMEQU&#39;</span><span class="p">,</span>
                <span class="s1">&#39;NUMDVAR&#39;</span><span class="p">,</span>
                <span class="s1">&#39;NUMNZ&#39;</span><span class="p">,</span>
                <span class="s1">&#39;ETSOLVE&#39;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="n">pgdx</span> <span class="o">=</span> <span class="n">gdxcc</span><span class="o">.</span><span class="n">new_gdxHandle_tp</span><span class="p">()</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">gdxcc</span><span class="o">.</span><span class="n">gdxCreateD</span><span class="p">(</span><span class="n">pgdx</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">executable</span><span class="p">()),</span> <span class="mi">128</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;GAMS GDX failure (gdxCreate): </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">ret</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">statresults_filename</span><span class="p">):</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">gdxcc</span><span class="o">.</span><span class="n">gdxOpenRead</span><span class="p">(</span><span class="n">pgdx</span><span class="p">,</span> <span class="n">statresults_filename</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;GAMS GDX failure (gdxOpenRead): </span><span class="si">%d</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">ret</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">gdxcc</span><span class="o">.</span><span class="n">gdxDataReadRawStart</span><span class="p">(</span><span class="n">pgdx</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="k">break</span>

                <span class="n">ret</span> <span class="o">=</span> <span class="n">gdxcc</span><span class="o">.</span><span class="n">gdxSymbolInfo</span><span class="p">(</span><span class="n">pgdx</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="k">break</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;GAMS GDX failure (gdxSymbolInfo).&quot;</span><span class="p">)</span>
                <span class="n">stat</span> <span class="o">=</span> <span class="n">ret</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">stat</span> <span class="ow">in</span> <span class="n">stat_vars</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="n">ret</span> <span class="o">=</span> <span class="n">gdxcc</span><span class="o">.</span><span class="n">gdxDataReadRaw</span><span class="p">(</span><span class="n">pgdx</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;GAMS GDX failure (gdxDataReadRaw).&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">stat</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;OBJEST&#39;</span><span class="p">,</span> <span class="s1">&#39;OBJVAL&#39;</span><span class="p">,</span> <span class="s1">&#39;ETSOLVE&#39;</span><span class="p">):</span>
                    <span class="n">stat_vars</span><span class="p">[</span><span class="n">stat</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_special_values</span><span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">stat_vars</span><span class="p">[</span><span class="n">stat</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

            <span class="n">gdxcc</span><span class="o">.</span><span class="n">gdxDataReadDone</span><span class="p">(</span><span class="n">pgdx</span><span class="p">)</span>
            <span class="n">gdxcc</span><span class="o">.</span><span class="n">gdxClose</span><span class="p">(</span><span class="n">pgdx</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">results_filename</span><span class="p">):</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">gdxcc</span><span class="o">.</span><span class="n">gdxOpenRead</span><span class="p">(</span><span class="n">pgdx</span><span class="p">,</span> <span class="n">results_filename</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;GAMS GDX failure (gdxOpenRead): </span><span class="si">%d</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">ret</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">gdxcc</span><span class="o">.</span><span class="n">gdxDataReadRawStart</span><span class="p">(</span><span class="n">pgdx</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="k">break</span>

                <span class="n">ret</span> <span class="o">=</span> <span class="n">gdxcc</span><span class="o">.</span><span class="n">gdxDataReadRaw</span><span class="p">(</span><span class="n">pgdx</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;GAMS GDX failure (gdxDataReadRaw).&quot;</span><span class="p">)</span>
                <span class="n">level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_special_values</span><span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">dual</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_special_values</span><span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

                <span class="n">ret</span> <span class="o">=</span> <span class="n">gdxcc</span><span class="o">.</span><span class="n">gdxSymbolInfo</span><span class="p">(</span><span class="n">pgdx</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="k">break</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;GAMS GDX failure (gdxSymbolInfo).&quot;</span><span class="p">)</span>
                <span class="n">model_soln</span><span class="p">[</span><span class="n">ret</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">dual</span><span class="p">)</span>

            <span class="n">gdxcc</span><span class="o">.</span><span class="n">gdxDataReadDone</span><span class="p">(</span><span class="n">pgdx</span><span class="p">)</span>
            <span class="n">gdxcc</span><span class="o">.</span><span class="n">gdxClose</span><span class="p">(</span><span class="n">pgdx</span><span class="p">)</span>

        <span class="n">gdxcc</span><span class="o">.</span><span class="n">gdxFree</span><span class="p">(</span><span class="n">pgdx</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">model_soln</span><span class="p">,</span> <span class="n">stat_vars</span>

    <span class="k">def</span> <span class="nf">_parse_dat_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results_filename</span><span class="p">,</span> <span class="n">statresults_filename</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">statresults_filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">statresults_file</span><span class="p">:</span>
            <span class="n">statresults_text</span> <span class="o">=</span> <span class="n">statresults_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

        <span class="n">stat_vars</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="c1"># Skip first line of explanatory text</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">statresults_text</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">items</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">stat_vars</span><span class="p">[</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="c1"># GAMS printed NA, just make it nan</span>
                <span class="n">stat_vars</span><span class="p">[</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">results_filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">results_file</span><span class="p">:</span>
            <span class="n">results_text</span> <span class="o">=</span> <span class="n">results_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

        <span class="n">model_soln</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="c1"># Skip first line of explanatory text</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">results_text</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">items</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">model_soln</span><span class="p">[</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">items</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">model_soln</span><span class="p">,</span> <span class="n">stat_vars</span></div>


<span class="k">class</span> <span class="nc">OutputStream</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Output stream object for simultaneously writing to multiple streams.</span>

<span class="sd">    tee=False:</span>
<span class="sd">        If set writing to this stream will write to stdout.</span>
<span class="sd">    logfile=None:</span>
<span class="sd">        Optionally a logfile can be written.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tee</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">logfile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize output stream object.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">tee</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tee</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tee</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logfile</span> <span class="o">=</span> <span class="n">logfile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logfile_buffer</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Enter context of output stream and open logfile if given.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logfile_buffer</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Enter context of output stream and close logfile if necessary.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logfile_buffer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logfile_buffer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logfile_buffer</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write messages to all streams.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tee</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tee</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logfile_buffer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logfile_buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">flush</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Needed for python3 compatibility.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tee</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tee</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logfile_buffer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logfile_buffer</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">check_expr_evaluation</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">symbolMap</span><span class="p">,</span> <span class="n">solver_io</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Temporarily initialize uninitialized variables in order to call</span>
        <span class="c1"># value() on each expression to check domain violations</span>
        <span class="n">uninit_vars</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">component_data_objects</span><span class="p">(</span><span class="n">Var</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">uninit_vars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
                <span class="n">var</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">skip_validation</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Constraints</span>
        <span class="k">for</span> <span class="n">con</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">component_data_objects</span><span class="p">(</span><span class="n">Constraint</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">is_fixed</span><span class="p">():</span>
                <span class="k">continue</span>
            <span class="n">check_expr</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">body</span><span class="p">,</span> <span class="n">con</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">solver_io</span><span class="p">)</span>

        <span class="c1"># Objective</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">component_data_objects</span><span class="p">(</span><span class="n">Objective</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;GAMS writer can only take 1 active objective&quot;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">check_expr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">expr</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">solver_io</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="c1"># Return uninitialized variables to None</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">uninit_vars</span><span class="p">:</span>
            <span class="n">var</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">check_expr</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">solver_io</span><span class="p">):</span>
    <span class="c1"># Check if GAMS will encounter domain violations in presolver</span>
    <span class="c1"># operations at current values, which are None (0) by default</span>
    <span class="c1"># Used to handle log and log10 violations, for example</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">value</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">ZeroDivisionError</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;While evaluating model.</span><span class="si">%s</span><span class="s2">&#39;s expression, GAMS solver &quot;</span>
            <span class="s2">&quot;encountered an error.</span><span class="se">\n</span><span class="s2">GAMS requires that all &quot;</span>
            <span class="s2">&quot;equations and expressions evaluate at initial values.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;Ensure variable values do not violate any domains, &quot;</span>
            <span class="s2">&quot;and use the warmstart=True keyword to solve().&quot;</span> <span class="o">%</span> <span class="n">name</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">solver_io</span> <span class="o">==</span> <span class="s1">&#39;shell&#39;</span><span class="p">:</span>
            <span class="c1"># For shell, there is no previous exception to worry about</span>
            <span class="c1"># overwriting, so raise the ValueError.</span>
            <span class="c1"># But for direct, the GamsExceptionExecution will be raised.</span>
            <span class="k">raise</span>


<span class="k">def</span> <span class="nf">file_removal_gams_direct</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">,</span> <span class="n">newdir</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">newdir</span><span class="p">:</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">,</span> <span class="s1">&#39;_gams_py_gjo0.gms&#39;</span><span class="p">))</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">,</span> <span class="s1">&#39;_gams_py_gjo0.lst&#39;</span><span class="p">))</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">,</span> <span class="s1">&#39;_gams_py_gdb0.gdx&#39;</span><span class="p">))</span>
        <span class="c1"># .pf file is not made when DebugLevel is Off</span>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2008-2023, Sandia National Laboratories.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>