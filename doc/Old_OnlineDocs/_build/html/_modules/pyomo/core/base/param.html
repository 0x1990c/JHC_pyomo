

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>pyomo.core.base.param &mdash; Pyomo 6.5.1.dev0 documentation</title>
  

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/theme_overrides.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/clipboard.min.js"></script>
        <script src="../../../../_static/copybutton.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> Pyomo
          

          
          </a>

          
            
            
              <div class="version">
                6.5.1.dev0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../citing_pyomo.html">Citing Pyomo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../pyomo_overview/index.html">Pyomo Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../pyomo_modeling_components/index.html">Pyomo Modeling Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../solving_pyomo_models.html">Solving Pyomo Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_models.html">Working with Pyomo Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_abstractmodels/index.html">Working with Abstract Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../model_transformations/index.html">Model Transformations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../modeling_extensions/index.html">Modeling Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorial_examples.html">Pyomo Tutorial Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../model_debugging/index.html">Debugging Pyomo Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../advanced_topics/index.html">Advanced Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../errors.html">Common Warnings/Errors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer_reference/index.html">Developer Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../library_reference/index.html">Library Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../contribution_guide.html">Contributing to Pyomo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../contributed_packages/index.html">Third-Party Contributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../related_packages.html">Related Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../bibliography.html">Bibliography</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Pyomo</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
      <li>pyomo.core.base.param</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pyomo.core.base.param</h1><div class="highlight"><pre>
<span></span><span class="c1">#  ___________________________________________________________________________</span>
<span class="c1">#</span>
<span class="c1">#  Pyomo: Python Optimization Modeling Objects</span>
<span class="c1">#  Copyright (c) 2008-2022</span>
<span class="c1">#  National Technology and Engineering Solutions of Sandia, LLC</span>
<span class="c1">#  Under the terms of Contract DE-NA0003525 with National Technology and</span>
<span class="c1">#  Engineering Solutions of Sandia, LLC, the U.S. Government retains certain</span>
<span class="c1">#  rights in this software.</span>
<span class="c1">#  This software is distributed under the 3-clause BSD License.</span>
<span class="c1">#  ___________________________________________________________________________</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Param&#39;</span><span class="p">]</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">types</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">weakref</span> <span class="kn">import</span> <span class="n">ref</span> <span class="k">as</span> <span class="n">weakref_ref</span>
<span class="kn">from</span> <span class="nn">pyomo.common.pyomo_typing</span> <span class="kn">import</span> <span class="n">overload</span>

<span class="kn">from</span> <span class="nn">pyomo.common.autoslots</span> <span class="kn">import</span> <span class="n">AutoSlots</span>
<span class="kn">from</span> <span class="nn">pyomo.common.deprecation</span> <span class="kn">import</span> <span class="n">deprecation_warning</span><span class="p">,</span> <span class="n">RenamedClass</span>
<span class="kn">from</span> <span class="nn">pyomo.common.log</span> <span class="kn">import</span> <span class="n">is_debug_set</span>
<span class="kn">from</span> <span class="nn">pyomo.common.modeling</span> <span class="kn">import</span> <span class="n">NOTSET</span>
<span class="kn">from</span> <span class="nn">pyomo.common.timing</span> <span class="kn">import</span> <span class="n">ConstructionTimer</span>

<span class="kn">from</span> <span class="nn">pyomo.core.base.component</span> <span class="kn">import</span> <span class="n">ComponentData</span><span class="p">,</span> <span class="n">ModelComponentFactory</span>
<span class="kn">from</span> <span class="nn">pyomo.core.base.global_set</span> <span class="kn">import</span> <span class="n">UnindexedComponent_index</span>
<span class="kn">from</span> <span class="nn">pyomo.core.base.indexed_component</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">IndexedComponent</span><span class="p">,</span>
    <span class="n">UnindexedComponent_set</span><span class="p">,</span>
    <span class="n">IndexedComponent_NDArrayMixin</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pyomo.core.base.initializer</span> <span class="kn">import</span> <span class="n">Initializer</span>
<span class="kn">from</span> <span class="nn">pyomo.core.base.misc</span> <span class="kn">import</span> <span class="n">apply_indexed_rule</span><span class="p">,</span> <span class="n">apply_parameterized_indexed_rule</span>
<span class="kn">from</span> <span class="nn">pyomo.core.base.numvalue</span> <span class="kn">import</span> <span class="n">NumericValue</span><span class="p">,</span> <span class="n">native_types</span><span class="p">,</span> <span class="n">value</span> <span class="k">as</span> <span class="n">expr_value</span>
<span class="kn">from</span> <span class="nn">pyomo.core.base.set</span> <span class="kn">import</span> <span class="n">Reals</span><span class="p">,</span> <span class="n">_AnySet</span>
<span class="kn">from</span> <span class="nn">pyomo.core.base.units_container</span> <span class="kn">import</span> <span class="n">units</span>
<span class="kn">from</span> <span class="nn">pyomo.core.expr.current</span> <span class="kn">import</span> <span class="n">GetItemExpression</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;pyomo.core&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_raise_modifying_immutable_error</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">is_indexed</span><span class="p">():</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">[</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">name</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Attempting to set the value of the immutable parameter &quot;</span>
        <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> after the parameter has been constructed.  If you intend &quot;</span>
        <span class="s2">&quot;to change the value of this parameter dynamically, please &quot;</span>
        <span class="s2">&quot;declare the parameter as mutable [i.e., Param(mutable=True)]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,)</span>
    <span class="p">)</span>


<span class="k">class</span> <span class="nc">_ImplicitAny</span><span class="p">(</span><span class="n">_AnySet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An Any that issues a deprecation warning for non-Real values.</span>

<span class="sd">    This is a helper class to implement the deprecation warnings for the</span>
<span class="sd">    change of Param&#39;s implicit domain from Any to Reals.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;_owner&#39;</span><span class="p">,)</span>
    <span class="n">__autoslot_mappers__</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;_owner&#39;</span><span class="p">:</span> <span class="n">AutoSlots</span><span class="o">.</span><span class="n">weakref_mapper</span><span class="p">}</span>

    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Strip off owner / kwargs before calling base __new__</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span> <span class="o">=</span> <span class="n">weakref_ref</span><span class="p">(</span><span class="n">owner</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_component</span> <span class="o">=</span> <span class="n">weakref_ref</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">construct</span><span class="p">()</span>
        <span class="c1"># Because this is a &quot;global set&quot;, we need to define the _bounds</span>
        <span class="c1"># and _interval fields</span>
        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_parent&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bounds</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_interval</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">val</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Reals</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Unknown&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span><span class="p">()</span><span class="o">.</span><span class="n">name</span>
            <span class="n">deprecation_warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Param &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; declared with an implicit domain of &#39;Any&#39;. &quot;</span>
                <span class="s2">&quot;The default domain for Param objects is &#39;Any&#39;.  However, &quot;</span>
                <span class="s2">&quot;we will be changing that default to &#39;Reals&#39; in the &quot;</span>
                <span class="s2">&quot;future.  If you really intend the domain of this Param&quot;</span>
                <span class="s2">&quot;to be &#39;Any&#39;, you can suppress this warning by explicitly &quot;</span>
                <span class="s2">&quot;specifying &#39;within=Any&#39; to the Param constructor.&quot;</span><span class="p">,</span>
                <span class="n">version</span><span class="o">=</span><span class="s1">&#39;5.6.9&#39;</span><span class="p">,</span>
                <span class="n">remove_in</span><span class="o">=</span><span class="s1">&#39;6.0&#39;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="c1"># This should &quot;mock up&quot; a global set, so the &quot;name&quot; should always be</span>
    <span class="c1"># the local name (without block scope)</span>
    <span class="k">def</span> <span class="nf">getname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fully_qualified</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">name_buffer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">relative_to</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">getname</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">name_buffer</span><span class="p">,</span> <span class="n">relative_to</span><span class="p">)</span>

    <span class="c1"># The parent tracks the parent of the owner.  We can&#39;t set it</span>
    <span class="c1"># directly here because the owner has not been assigned to a block</span>
    <span class="c1"># when we create the _ImplicitAny</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span><span class="p">()</span><span class="o">.</span><span class="n">_parent</span>

    <span class="c1"># This is not settable.  However the base classes assume that it is,</span>
    <span class="c1"># so we need to define the setter and just ignore the incoming value</span>
    <span class="nd">@_parent</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">pass</span>


<span class="k">class</span> <span class="nc">_ParamData</span><span class="p">(</span><span class="n">ComponentData</span><span class="p">,</span> <span class="n">NumericValue</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class defines the data for a mutable parameter.</span>

<span class="sd">    Constructor Arguments:</span>
<span class="sd">        owner       The Param object that owns this data.</span>
<span class="sd">        value       The value of this parameter.</span>

<span class="sd">    Public Class Attributes:</span>
<span class="sd">        value       The numeric value of this variable.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;_value&#39;</span><span class="p">,)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">component</span><span class="p">):</span>
        <span class="c1">#</span>
        <span class="c1"># The following is equivalent to calling</span>
        <span class="c1"># the base ComponentData constructor.</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_component</span> <span class="o">=</span> <span class="n">weakref_ref</span><span class="p">(</span><span class="n">component</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">=</span> <span class="n">NOTSET</span>
        <span class="c1">#</span>
        <span class="c1"># The following is equivalent to calling the</span>
        <span class="c1"># base NumericValue constructor.</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">Param</span><span class="o">.</span><span class="n">NoValue</span>

    <span class="c1"># Note: because NONE of the slots on this class need to be edited,</span>
    <span class="c1"># we don&#39;t need to implement a specialized __setstate__ method.</span>

    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clear the data in this component&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">Param</span><span class="o">.</span><span class="n">NoValue</span>

    <span class="c1"># FIXME: ComponentData need to have pointers to their index to make</span>
    <span class="c1"># operations like validation efficient.  As it stands now, if</span>
    <span class="c1"># set_value is called without specifying an index, this call</span>
    <span class="c1"># involves a linear scan of the _data dict.</span>
    <span class="k">def</span> <span class="nf">set_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="n">NOTSET</span><span class="p">):</span>
        <span class="c1">#</span>
        <span class="c1"># If this param has units, then we need to check the incoming</span>
        <span class="c1"># value and see if it is &quot;units compatible&quot;.  We only need to</span>
        <span class="c1"># check here in set_value, because all united Params are</span>
        <span class="c1"># required to be mutable.</span>
        <span class="c1">#</span>
        <span class="n">_comp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_component</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">native_types</span><span class="p">:</span>
            <span class="c1"># TODO: warn/error: check if this Param has units: assigning</span>
            <span class="c1"># a dimensionless value to a united param should be an error</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">_comp</span><span class="o">.</span><span class="n">_units</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_src_magnitude</span> <span class="o">=</span> <span class="n">expr_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">_src_units</span> <span class="o">=</span> <span class="n">units</span><span class="o">.</span><span class="n">get_units</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">units</span><span class="o">.</span><span class="n">convert_value</span><span class="p">(</span>
                <span class="n">num_value</span><span class="o">=</span><span class="n">_src_magnitude</span><span class="p">,</span> <span class="n">from_units</span><span class="o">=</span><span class="n">_src_units</span><span class="p">,</span> <span class="n">to_units</span><span class="o">=</span><span class="n">_comp</span><span class="o">.</span><span class="n">_units</span>
            <span class="p">)</span>

        <span class="n">old_value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">,</span> <span class="n">value</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_comp</span><span class="o">.</span><span class="n">_validate_value</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">old_value</span>
            <span class="k">raise</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exception</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the value of this object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="ow">is</span> <span class="n">Param</span><span class="o">.</span><span class="n">NoValue</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">exception</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Error evaluating Param value (</span><span class="si">%s</span><span class="s2">):</span><span class="se">\n\t</span><span class="s2">The Param value is &quot;</span>
                    <span class="s2">&quot;currently set to an invalid value.  This is</span><span class="se">\n\t</span><span class="s2">typically &quot;</span>
                    <span class="s2">&quot;from a scalar Param or mutable Indexed Param without</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">an initial or default value.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,)</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the value for this variable.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">()</span>

    <span class="nd">@value</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the value for this variable.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_units</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the units for this ParamData&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_component</span><span class="p">()</span><span class="o">.</span><span class="n">_units</span>

    <span class="k">def</span> <span class="nf">is_fixed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns True because this value is fixed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">is_constant</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns False because this is not a constant in an expression.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">is_parameter_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns True because this is a parameter object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_compute_polynomial_degree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns 0 because this object can never reference variables.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mi">0</span>


<div class="viewcode-block" id="Param"><a class="viewcode-back" href="../../../../library_reference/aml/index.html#pyomo.environ.Param">[docs]</a><span class="nd">@ModelComponentFactory</span><span class="o">.</span><span class="n">register</span><span class="p">(</span>
    <span class="s2">&quot;Parameter data that is used to define a model instance.&quot;</span>
<span class="p">)</span>
<span class="k">class</span> <span class="nc">Param</span><span class="p">(</span><span class="n">IndexedComponent</span><span class="p">,</span> <span class="n">IndexedComponent_NDArrayMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A parameter value, which may be defined over an index.</span>

<span class="sd">    Constructor Arguments:</span>
<span class="sd">        domain</span>
<span class="sd">            A set that defines the type of values that each parameter must be.</span>
<span class="sd">        within</span>
<span class="sd">            A set that defines the type of values that each parameter must be.</span>
<span class="sd">        validate</span>
<span class="sd">            A rule for validating this parameter w.r.t. data that exists in</span>
<span class="sd">            the model</span>
<span class="sd">        default</span>
<span class="sd">            A scalar, rule, or dictionary that defines default values for</span>
<span class="sd">            this parameter</span>
<span class="sd">        initialize</span>
<span class="sd">            A dictionary or rule for setting up this parameter with existing</span>
<span class="sd">            model data</span>
<span class="sd">        unit: pyomo unit expression</span>
<span class="sd">            An expression containing the units for the parameter</span>
<span class="sd">        mutable: `boolean`</span>
<span class="sd">            Flag indicating if the value of the parameter may change between</span>
<span class="sd">            calls to a solver. Defaults to `False`</span>
<span class="sd">        name</span>
<span class="sd">            Name for this component.</span>
<span class="sd">        doc</span>
<span class="sd">            Text describing this component.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DefaultMutable</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">_ComponentDataClass</span> <span class="o">=</span> <span class="n">_ParamData</span>

<div class="viewcode-block" id="Param.NoValue"><a class="viewcode-back" href="../../../../library_reference/aml/index.html#pyomo.environ.Param.NoValue">[docs]</a>    <span class="k">class</span> <span class="nc">NoValue</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A dummy type that is pickle-safe that we can use as the default</span>
<span class="sd">        value for Params to indicate that no valid value is present.&quot;&quot;&quot;</span>

        <span class="k">pass</span></div>

    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">cls</span> <span class="o">!=</span> <span class="n">Param</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Param</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span> <span class="ow">or</span> <span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="n">UnindexedComponent_set</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Param</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">ScalarParam</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Param</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">IndexedParam</span><span class="p">)</span>

    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="n">indexes</span><span class="p">,</span>
        <span class="n">rule</span><span class="o">=</span><span class="n">NOTSET</span><span class="p">,</span>
        <span class="n">initialize</span><span class="o">=</span><span class="n">NOTSET</span><span class="p">,</span>
        <span class="n">domain</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">within</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">validate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">mutable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">NoValue</span><span class="p">,</span>
        <span class="n">initialize_as_dense</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">units</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">doc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwd</span><span class="p">):</span>
        <span class="n">_init</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pop_from_kwargs</span><span class="p">(</span><span class="s1">&#39;Param&#39;</span><span class="p">,</span> <span class="n">kwd</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;rule&#39;</span><span class="p">,</span> <span class="s1">&#39;initialize&#39;</span><span class="p">),</span> <span class="n">NOTSET</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pop_from_kwargs</span><span class="p">(</span><span class="s1">&#39;Param&#39;</span><span class="p">,</span> <span class="n">kwd</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;domain&#39;</span><span class="p">,</span> <span class="s1">&#39;within&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span> <span class="o">=</span> <span class="n">kwd</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;validate&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mutable</span> <span class="o">=</span> <span class="n">kwd</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mutable&#39;</span><span class="p">,</span> <span class="n">Param</span><span class="o">.</span><span class="n">DefaultMutable</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default_val</span> <span class="o">=</span> <span class="n">kwd</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="n">Param</span><span class="o">.</span><span class="n">NoValue</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dense_initialize</span> <span class="o">=</span> <span class="n">kwd</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;initialize_as_dense&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_units</span> <span class="o">=</span> <span class="n">kwd</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;units&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_units</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_units</span> <span class="o">=</span> <span class="n">units</span><span class="o">.</span><span class="n">get_units</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_units</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mutable</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">kwd</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;ctype&#39;</span><span class="p">,</span> <span class="n">Param</span><span class="p">)</span>
        <span class="n">IndexedComponent</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwd</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="n">_ImplicitAny</span><span class="p">(</span><span class="n">owner</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Any&#39;</span><span class="p">)</span>
        <span class="c1"># After IndexedComponent.__init__ so we can call is_indexed().</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rule</span> <span class="o">=</span> <span class="n">Initializer</span><span class="p">(</span>
            <span class="n">_init</span><span class="p">,</span>
            <span class="n">treat_sequences_as_mappings</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">is_indexed</span><span class="p">(),</span>
            <span class="n">arg_not_specified</span><span class="o">=</span><span class="n">NOTSET</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the number of component data objects stored by this</span>
<span class="sd">        component.  If a default value is specified, then the</span>
<span class="sd">        length equals the number of items in the component index.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_val</span> <span class="ow">is</span> <span class="n">Param</span><span class="o">.</span><span class="n">NoValue</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_index_set</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return true if the index is in the dictionary.  If the default value</span>
<span class="sd">        is specified, then all members of the component index are valid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_val</span> <span class="ow">is</span> <span class="n">Param</span><span class="o">.</span><span class="n">NoValue</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">idx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
        <span class="k">return</span> <span class="n">idx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_set</span>

    <span class="c1"># We do not need to override keys(), as the __len__ override will</span>
    <span class="c1"># cause the base class keys() to correctly correctly handle default</span>
    <span class="c1"># values</span>
    <span class="c1"># def keys(self, ordered=False):</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">mutable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mutable</span>

<div class="viewcode-block" id="Param.get_units"><a class="viewcode-back" href="../../../../library_reference/aml/index.html#pyomo.environ.Param.get_units">[docs]</a>    <span class="k">def</span> <span class="nf">get_units</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the units for this ParamData&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_units</span></div>

    <span class="c1">#</span>
    <span class="c1"># These are &quot;sparse equivalent&quot; access / iteration methods that</span>
    <span class="c1"># only loop over the defined data.</span>
    <span class="c1">#</span>

<div class="viewcode-block" id="Param.sparse_keys"><a class="viewcode-back" href="../../../../library_reference/aml/index.html#pyomo.environ.Param.sparse_keys">[docs]</a>    <span class="k">def</span> <span class="nf">sparse_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of keys in the defined parameters&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></div>

<div class="viewcode-block" id="Param.sparse_values"><a class="viewcode-back" href="../../../../library_reference/aml/index.html#pyomo.environ.Param.sparse_values">[docs]</a>    <span class="k">def</span> <span class="nf">sparse_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of the defined param data objects&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">values</span><span class="p">())</span></div>

<div class="viewcode-block" id="Param.sparse_items"><a class="viewcode-back" href="../../../../library_reference/aml/index.html#pyomo.environ.Param.sparse_items">[docs]</a>    <span class="k">def</span> <span class="nf">sparse_items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list (index,data) tuples for defined parameters&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span></div>

<div class="viewcode-block" id="Param.sparse_iterkeys"><a class="viewcode-back" href="../../../../library_reference/aml/index.html#pyomo.environ.Param.sparse_iterkeys">[docs]</a>    <span class="k">def</span> <span class="nf">sparse_iterkeys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return an iterator for the keys in the defined parameters&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span></div>

<div class="viewcode-block" id="Param.sparse_itervalues"><a class="viewcode-back" href="../../../../library_reference/aml/index.html#pyomo.environ.Param.sparse_itervalues">[docs]</a>    <span class="k">def</span> <span class="nf">sparse_itervalues</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return an iterator for the defined param data objects&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">values</span><span class="p">()</span></div>

<div class="viewcode-block" id="Param.sparse_iteritems"><a class="viewcode-back" href="../../../../library_reference/aml/index.html#pyomo.environ.Param.sparse_iteritems">[docs]</a>    <span class="k">def</span> <span class="nf">sparse_iteritems</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return an iterator of (index,data) tuples for defined parameters&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span></div>

<div class="viewcode-block" id="Param.extract_values"><a class="viewcode-back" href="../../../../library_reference/aml/index.html#pyomo.environ.Param.extract_values">[docs]</a>    <span class="k">def</span> <span class="nf">extract_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A utility to extract all index-value pairs defined for this</span>
<span class="sd">        parameter, returned as a dictionary.</span>

<span class="sd">        This method is useful in contexts where key iteration and</span>
<span class="sd">        repeated __getitem__ calls are too expensive to extract</span>
<span class="sd">        the contents of a parameter.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mutable</span><span class="p">:</span>
            <span class="c1">#</span>
            <span class="c1"># The parameter is mutable, parameter data are ParamData types.</span>
            <span class="c1"># Thus, we need to create a temporary dictionary that contains the</span>
            <span class="c1"># values from the ParamData objects.</span>
            <span class="c1">#</span>
            <span class="k">return</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">param_value</span><span class="p">()</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">param_value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_indexed</span><span class="p">():</span>
            <span class="c1">#</span>
            <span class="c1"># The parameter is a scalar, so we need to create a temporary</span>
            <span class="c1"># dictionary using the value for this parameter.</span>
            <span class="c1">#</span>
            <span class="k">return</span> <span class="p">{</span><span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="p">()}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#</span>
            <span class="c1"># The parameter is not mutable, so iteritems() can be</span>
            <span class="c1"># converted into a dictionary containing parameter values.</span>
            <span class="c1">#</span>
            <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">())</span></div>

<div class="viewcode-block" id="Param.extract_values_sparse"><a class="viewcode-back" href="../../../../library_reference/aml/index.html#pyomo.environ.Param.extract_values_sparse">[docs]</a>    <span class="k">def</span> <span class="nf">extract_values_sparse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A utility to extract all index-value pairs defined with non-default</span>
<span class="sd">        values, returned as a dictionary.</span>

<span class="sd">        This method is useful in contexts where key iteration and</span>
<span class="sd">        repeated __getitem__ calls are too expensive to extract</span>
<span class="sd">        the contents of a parameter.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mutable</span><span class="p">:</span>
            <span class="c1">#</span>
            <span class="c1"># The parameter is mutable, parameter data are ParamData types.</span>
            <span class="c1"># Thus, we need to create a temporary dictionary that contains the</span>
            <span class="c1"># values from the ParamData objects.</span>
            <span class="c1">#</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">param_value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparse_iteritems</span><span class="p">():</span>
                <span class="n">ans</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_value</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">ans</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_indexed</span><span class="p">():</span>
            <span class="c1">#</span>
            <span class="c1"># The parameter is a scalar, so we need to create a temporary</span>
            <span class="c1"># dictionary using the value for this parameter.</span>
            <span class="c1">#</span>
            <span class="k">return</span> <span class="p">{</span><span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="p">()}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#</span>
            <span class="c1"># The parameter is not mutable, so sparse_iteritems() can be</span>
            <span class="c1"># converted into a dictionary containing parameter values.</span>
            <span class="c1">#</span>
            <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sparse_iteritems</span><span class="p">())</span></div>

<div class="viewcode-block" id="Param.store_values"><a class="viewcode-back" href="../../../../library_reference/aml/index.html#pyomo.environ.Param.store_values">[docs]</a>    <span class="k">def</span> <span class="nf">store_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_values</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A utility to update a Param with a dictionary or scalar.</span>

<span class="sd">        If check=True, then both the index and value</span>
<span class="sd">        are checked through the __getitem__ method.  Using check=False</span>
<span class="sd">        should only be used by developers!</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mutable</span><span class="p">:</span>
            <span class="n">_raise_modifying_immutable_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="n">_srcType</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">new_values</span><span class="p">)</span>
        <span class="n">_isDict</span> <span class="o">=</span> <span class="n">_srcType</span> <span class="ow">is</span> <span class="nb">dict</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="nb">hasattr</span><span class="p">(</span><span class="n">_srcType</span><span class="p">,</span> <span class="s1">&#39;__getitem__&#39;</span><span class="p">)</span>
            <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_values</span><span class="p">,</span> <span class="n">NumericValue</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">check</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_isDict</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">new_value</span> <span class="ow">in</span> <span class="n">new_values</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="bp">self</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_set</span><span class="p">:</span>
                    <span class="bp">self</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_values</span>
            <span class="k">return</span>
        <span class="c1">#</span>
        <span class="c1"># The argument check is False, so we bypass almost all of the</span>
        <span class="c1"># Param logic for ensuring data integrity.</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_indexed</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">_isDict</span><span class="p">:</span>
                <span class="c1"># It is possible that the Param is sparse and that the</span>
                <span class="c1"># index is not already in the _data dict.  As these</span>
                <span class="c1"># cases are rare, we will recover from the exception</span>
                <span class="c1"># instead of incurring the penalty of checking.</span>
                <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">new_value</span> <span class="ow">in</span> <span class="n">new_values</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">index</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">_ParamData</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">new_value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># For scalars, we will choose an approach based on</span>
                <span class="c1"># how &quot;dense&quot; the Param is</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">:</span>  <span class="c1"># empty</span>
                    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_set</span><span class="p">:</span>
                        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">_ParamData</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                        <span class="n">p</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">new_values</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_index_set</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_set</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">new_values</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_set</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">index</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">_ParamData</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">new_values</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#</span>
            <span class="c1"># Initialize a scalar</span>
            <span class="c1">#</span>
            <span class="k">if</span> <span class="n">_isDict</span><span class="p">:</span>
                <span class="k">if</span> <span class="kc">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_values</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                        <span class="s2">&quot;Cannot store value for scalar Param </span><span class="si">%s</span><span class="s2">:</span><span class="se">\n\t</span><span class="s2">No value &quot;</span>
                        <span class="s2">&quot;with index None in the new values dict.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,)</span>
                    <span class="p">)</span>
                <span class="n">new_values</span> <span class="o">=</span> <span class="n">new_values</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span>
            <span class="c1"># scalars have to be handled differently</span>
            <span class="bp">self</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_values</span></div>

<div class="viewcode-block" id="Param.set_default"><a class="viewcode-back" href="../../../../library_reference/aml/index.html#pyomo.environ.Param.set_default">[docs]</a>    <span class="k">def</span> <span class="nf">set_default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform error checks and then set the default value for this parameter.</span>

<span class="sd">        NOTE: this test will not validate the value of function return values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_constructed</span>
            <span class="ow">and</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Param</span><span class="o">.</span><span class="n">NoValue</span>
            <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="ow">in</span> <span class="n">native_types</span>
            <span class="ow">and</span> <span class="n">val</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Default value (</span><span class="si">%s</span><span class="s2">) is not valid for Param </span><span class="si">%s</span><span class="s2"> domain </span><span class="si">%s</span><span class="s2">&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default_val</span> <span class="o">=</span> <span class="n">val</span></div>

<div class="viewcode-block" id="Param.default"><a class="viewcode-back" href="../../../../library_reference/aml/index.html#pyomo.environ.Param.default">[docs]</a>    <span class="k">def</span> <span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the value of the parameter default.</span>

<span class="sd">        Possible values:</span>
<span class="sd">            Param.NoValue</span>
<span class="sd">                No default value is provided.</span>
<span class="sd">            Numeric</span>
<span class="sd">                A constant value that is the default value for all undefined</span>
<span class="sd">                parameters.</span>
<span class="sd">            Function</span>
<span class="sd">                f(model, i) returns the value for the default value for</span>
<span class="sd">                parameter i</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_val</span></div>

    <span class="k">def</span> <span class="nf">_getitem_when_not_present</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the default component data value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#</span>
        <span class="c1"># Local values</span>
        <span class="c1">#</span>
        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_val</span>
        <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="n">Param</span><span class="o">.</span><span class="n">NoValue</span><span class="p">:</span>
            <span class="c1"># We should allow the creation of mutable params without</span>
            <span class="c1"># a default value, as long as *solving* a model without</span>
            <span class="c1"># reasonable values produces an informative error.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mutable</span><span class="p">:</span>
                <span class="c1"># Note: _ParamData defaults to Param.NoValue</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_indexed</span><span class="p">():</span>
                    <span class="n">ans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">_ParamData</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>
                <span class="n">ans</span><span class="o">.</span><span class="n">_index</span> <span class="o">=</span> <span class="n">index</span>
                <span class="k">return</span> <span class="n">ans</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_indexed</span><span class="p">():</span>
                <span class="n">idx_str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">[</span><span class="si">%s</span><span class="s1">]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">idx_str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Error retrieving immutable Param value (</span><span class="si">%s</span><span class="s2">):</span><span class="se">\n\t</span><span class="s2">The Param &quot;</span>
                <span class="s2">&quot;value is undefined and no default value is specified.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">idx_str</span><span class="p">,)</span>
            <span class="p">)</span>

        <span class="n">_default_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="n">_check_value_domain</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">_default_type</span> <span class="ow">in</span> <span class="n">native_types</span><span class="p">:</span>
            <span class="c1">#</span>
            <span class="c1"># The set_default() method validates the domain of native types, so</span>
            <span class="c1"># we can skip the check on the value domain.</span>
            <span class="c1">#</span>
            <span class="n">_check_value_domain</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="n">_default_type</span> <span class="ow">is</span> <span class="n">types</span><span class="o">.</span><span class="n">FunctionType</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">apply_indexed_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_block</span><span class="p">(),</span> <span class="n">index</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="s1">&#39;__getitem__&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">NumericValue</span><span class="p">)</span> <span class="ow">or</span> <span class="n">val</span><span class="o">.</span><span class="n">is_indexed</span><span class="p">()</span>
        <span class="p">):</span>
            <span class="c1"># Things that look like Dictionaries should be allowable.  This</span>
            <span class="c1"># includes other IndexedComponent objects.</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># this is something simple like a non-indexed component</span>
            <span class="k">pass</span>

        <span class="c1">#</span>
        <span class="c1"># If the user wants to validate values, we need to validate the</span>
        <span class="c1"># default value as well. For Mutable Params, this is easy:</span>
        <span class="c1"># _setitem_impl will inject the value into _data and</span>
        <span class="c1"># then call validate.</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mutable</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setitem_when_not_present</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># For immutable params, we never inject the default into the data</span>
        <span class="c1"># dictionary.  This will break validation, as the validation rule is</span>
        <span class="c1"># allowed to assume the data is already present (actually, it will</span>
        <span class="c1"># die on infinite recursion, as Param.__getitem__() will re-call</span>
        <span class="c1"># _getitem_when_not_present).</span>
        <span class="c1">#</span>
        <span class="c1"># So, we will do something very inefficient: if we are</span>
        <span class="c1"># validating, we will inject the value into the dictionary,</span>
        <span class="c1"># call validate, and remove it.</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">_check_value_domain</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_validate_value</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">_check_value_domain</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">val</span>

    <span class="k">def</span> <span class="nf">_setitem_impl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The __setitem__ method performs significant validation around the</span>
<span class="sd">        input indices, particularly when the index value is new.  In</span>
<span class="sd">        various contexts, we don&#39;t need to incur this overhead</span>
<span class="sd">        (e.g. during initialization).  The _setitem_impl</span>
<span class="sd">        assumes the input value is in the set native_types</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#</span>
        <span class="c1"># We need to ensure that users don&#39;t override the value for immutable</span>
        <span class="c1"># parameters.</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_constructed</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mutable</span><span class="p">:</span>
            <span class="n">_raise_modifying_immutable_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># Params should contain *values*.  Note that if we just call</span>
        <span class="c1"># value(), then that forces the value to be a numeric value.</span>
        <span class="c1"># Notably, we allow Params with domain==Any to hold strings, tuples,</span>
        <span class="c1"># etc.  The following lets us use NumericValues to initialize</span>
        <span class="c1"># Params, but is optimized to check for &quot;known&quot; native types to</span>
        <span class="c1"># bypass a potentially expensive isinstance()==False call.</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="vm">__class__</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">native_types</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">NumericValue</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">()</span>
        <span class="c1">#</span>
        <span class="c1"># Set the value depending on the type of param value.</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mutable</span><span class="p">:</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">obj</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">old_value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">value</span>
            <span class="c1"># Because we do not have a _ParamData, we cannot rely on the</span>
            <span class="c1"># validation that occurs in _ParamData.set_value()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_validate_value</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">value</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">old_value</span>
                <span class="k">raise</span>

    <span class="k">def</span> <span class="nf">_setitem_when_not_present</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">_check_domain</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="c1">#</span>
        <span class="c1"># We need to ensure that users don&#39;t override the value for immutable</span>
        <span class="c1"># parameters.</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_constructed</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mutable</span><span class="p">:</span>
            <span class="n">_raise_modifying_immutable_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># Params should contain *values*.  Note that if we just call</span>
        <span class="c1"># value(), then that forces the value to be a numeric value.</span>
        <span class="c1"># Notably, we allow Params with domain==Any to hold strings, tuples,</span>
        <span class="c1"># etc.  The following lets us use NumericValues to initialize</span>
        <span class="c1"># Params, but is optimized to check for &quot;known&quot; native types to</span>
        <span class="c1"># bypass a potentially expensive isinstance()==False call.</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="vm">__class__</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">native_types</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">NumericValue</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">()</span>

        <span class="c1">#</span>
        <span class="c1"># Set the value depending on the type of param value.</span>
        <span class="c1">#</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_indexed</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">=</span> <span class="n">UnindexedComponent_index</span>
                <span class="k">return</span> <span class="bp">self</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mutable</span><span class="p">:</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">_ParamData</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">_index</span> <span class="o">=</span> <span class="n">index</span>
                <span class="k">return</span> <span class="n">obj</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                <span class="c1"># Because we do not have a _ParamData, we cannot rely on the</span>
                <span class="c1"># validation that occurs in _ParamData.set_value()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_validate_value</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">_check_domain</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">value</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="k">raise</span>

    <span class="k">def</span> <span class="nf">_validate_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">validate_domain</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate a given input/value pair.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#</span>
        <span class="c1"># Check if the value is valid within the current domain</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">validate_domain</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="n">NOTSET</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">()</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Invalid parameter value: </span><span class="si">%s</span><span class="s2">[</span><span class="si">%s</span><span class="s2">] = &#39;</span><span class="si">%s</span><span class="s2">&#39;, value type=</span><span class="si">%s</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Value not in parameter domain </span><span class="si">%s</span><span class="s2">&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="n">NOTSET</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">()</span>
            <span class="n">valid</span> <span class="o">=</span> <span class="n">apply_parameterized_indexed_rule</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_block</span><span class="p">(),</span> <span class="n">value</span><span class="p">,</span> <span class="n">index</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Invalid parameter value: </span><span class="si">%s</span><span class="s2">[</span><span class="si">%s</span><span class="s2">] = &#39;</span><span class="si">%s</span><span class="s2">&#39;, value type=</span><span class="si">%s</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Value failed parameter validation rule&quot;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
                <span class="p">)</span>

<div class="viewcode-block" id="Param.construct"><a class="viewcode-back" href="../../../../library_reference/aml/index.html#pyomo.environ.Param.construct">[docs]</a>    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize this component.</span>

<span class="sd">        A parameter is constructed using the initial data or</span>
<span class="sd">        the data loaded from an external source.  We first</span>
<span class="sd">        set all the values based on self._rule, and then</span>
<span class="sd">        allow the data dictionary to overwrite anything.</span>

<span class="sd">        Note that we allow an undefined Param value to be</span>
<span class="sd">        constructed.  We throw an exception if a user tries</span>
<span class="sd">        to use an uninitialized Param.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_constructed</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">timer</span> <span class="o">=</span> <span class="n">ConstructionTimer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_debug_set</span><span class="p">(</span><span class="n">logger</span><span class="p">):</span>  <span class="c1"># pragma:nocover</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;Constructing Param, name=</span><span class="si">%s</span><span class="s2">, from data=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
            <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1">#</span>
            <span class="c1"># If the default value is a simple type, we check it versus</span>
            <span class="c1"># the domain.</span>
            <span class="c1">#</span>
            <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_val</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Param</span><span class="o">.</span><span class="n">NoValue</span>
                <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="ow">in</span> <span class="n">native_types</span>
                <span class="ow">and</span> <span class="n">val</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span>
            <span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Default value (</span><span class="si">%s</span><span class="s2">) is not valid for Param </span><span class="si">%s</span><span class="s2"> domain </span><span class="si">%s</span><span class="s2">&quot;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="c1">#</span>
            <span class="c1"># Flag that we are in the &quot;during construction&quot; phase</span>
            <span class="c1">#</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_constructed</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="c1">#</span>
            <span class="c1"># Step #1: initialize data from rule value</span>
            <span class="c1">#</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_construct_from_rule_using_setitem</span><span class="p">()</span>
            <span class="c1">#</span>
            <span class="c1"># Step #2: allow any user-specified (external) data to override</span>
            <span class="c1"># the initialization</span>
            <span class="c1">#</span>
            <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">data_items</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;Attempting to initialize parameter=</span><span class="si">%s</span><span class="s2"> with data=</span><span class="si">%s</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Data type is not a mapping type, and a Mapping is &quot;</span>
                        <span class="s2">&quot;expected.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data_items</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(())</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">data_items</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_setitem_when_not_present</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_validate_index</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">val</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s2">&quot;Failed to set value for param=</span><span class="si">%s</span><span class="s2">, index=</span><span class="si">%s</span><span class="s2">, value=</span><span class="si">%s</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">source error message=</span><span class="si">%s</span><span class="s2">&quot;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>
                <span class="p">)</span>
            <span class="c1">#</span>
            <span class="c1"># Flag that things are fully constructed now (and changing an</span>
            <span class="c1"># immutable Param is now an exception).</span>
            <span class="c1">#</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_constructed</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1"># populate all other indices with default data</span>
            <span class="c1"># (avoids calling _set_contains on self._index_set at runtime)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dense_initialize</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">to_dense_data</span><span class="p">()</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">timer</span><span class="o">.</span><span class="n">report</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_pprint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return data that will be printed for this component.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_val</span> <span class="ow">is</span> <span class="n">Param</span><span class="o">.</span><span class="n">NoValue</span><span class="p">:</span>
            <span class="n">default</span> <span class="o">=</span> <span class="s2">&quot;None&quot;</span>  <span class="c1"># for backwards compatibility in reporting</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_default_val</span><span class="p">)</span> <span class="ow">is</span> <span class="n">types</span><span class="o">.</span><span class="n">FunctionType</span><span class="p">:</span>
            <span class="n">default</span> <span class="o">=</span> <span class="s2">&quot;(function)&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">default</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_default_val</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mutable</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_indexed</span><span class="p">():</span>
            <span class="n">dataGen</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">_value</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dataGen</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="p">[</span><span class="n">v</span><span class="p">]</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;Size&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)),</span>
            <span class="p">(</span><span class="s2">&quot;Index&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_set</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_indexed</span><span class="p">()</span> <span class="k">else</span> <span class="kc">None</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;Domain&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;Default&quot;</span><span class="p">,</span> <span class="n">default</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;Mutable&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mutable</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_units</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">headers</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Units&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_units</span><span class="p">)))</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparse_iteritems</span><span class="p">(),</span> <span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">,),</span> <span class="n">dataGen</span><span class="p">)</span></div>


<span class="k">class</span> <span class="nc">ScalarParam</span><span class="p">(</span><span class="n">_ParamData</span><span class="p">,</span> <span class="n">Param</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="n">Param</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
        <span class="n">_ParamData</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">component</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">=</span> <span class="n">UnindexedComponent_index</span>

    <span class="c1">#</span>
    <span class="c1"># Since this class derives from Component and Component.__getstate__</span>
    <span class="c1"># just packs up the entire __dict__ into the state dict, there s</span>
    <span class="c1"># nothng special that we need to do here.  We will just defer to the</span>
    <span class="c1"># super() get/set state.  Since all of our get/set state methods</span>
    <span class="c1"># rely on super() to traverse the MRO, this will automatically pick</span>
    <span class="c1"># up both the Component and Data base classes.</span>
    <span class="c1">#</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exception</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the value of this parameter.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_constructed</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mutable</span><span class="p">:</span>
                    <span class="c1"># This will trigger populating the _data dict and setting</span>
                    <span class="c1"># the _default, if applicable</span>
                    <span class="bp">self</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Immutable Param defaults never get added to the</span>
                    <span class="c1"># _data dict</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">ScalarParam</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="n">exception</span><span class="o">=</span><span class="n">exception</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">exception</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Evaluating the numeric value of parameter &#39;</span><span class="si">%s</span><span class="s2">&#39; before</span><span class="se">\n\t</span><span class="s2">&quot;</span>
                <span class="s2">&quot;the Param has been constructed (there is currently no &quot;</span>
                <span class="s2">&quot;value to return).&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,)</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">NOTSET</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="n">NOTSET</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_constructed</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mutable</span><span class="p">:</span>
            <span class="n">_raise_modifying_immutable_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ScalarParam</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">is_constant</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determine if this ScalarParam is constant (and can be eliminated)</span>

<span class="sd">        Returns False if either unconstructed or mutable, as it must be kept</span>
<span class="sd">        in expressions (as it either doesn&#39;t have a value yet or the value</span>
<span class="sd">        can change later.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_constructed</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mutable</span>


<span class="k">class</span> <span class="nc">SimpleParam</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">RenamedClass</span><span class="p">):</span>
    <span class="n">__renamed__new_class__</span> <span class="o">=</span> <span class="n">ScalarParam</span>
    <span class="n">__renamed__version__</span> <span class="o">=</span> <span class="s1">&#39;6.0&#39;</span>


<span class="k">class</span> <span class="nc">IndexedParam</span><span class="p">(</span><span class="n">Param</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exception</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute the value of the parameter&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">exception</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s1">&#39;Cannot compute the value of an indexed Param (</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,)</span>
            <span class="p">)</span>

    <span class="c1"># Because IndexedParam can use a non-standard data store (i.e., the</span>
    <span class="c1"># values in the _data dict may not be ComponentData objects), we</span>
    <span class="c1"># need to override the normal scheme for pre-allocating</span>
    <span class="c1"># ComponentData objects during deepcopy.</span>
    <span class="k">def</span> <span class="nf">_create_objects_for_deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memo</span><span class="p">,</span> <span class="n">component_list</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutable</span><span class="p">:</span>
            <span class="c1"># Normal indexed object; leverage base implementation</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_create_objects_for_deepcopy</span><span class="p">(</span><span class="n">memo</span><span class="p">,</span> <span class="n">component_list</span><span class="p">)</span>
        <span class="c1"># This is immutable; only add the container (not the _data) to</span>
        <span class="c1"># the component_list.</span>
        <span class="n">_new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>
        <span class="n">_ans</span> <span class="o">=</span> <span class="n">memo</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">_new</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_ans</span> <span class="ow">is</span> <span class="n">_new</span><span class="p">:</span>
            <span class="n">component_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_ans</span>

    <span class="c1"># Because CP supports indirection [the ability to index objects by</span>
    <span class="c1"># another (inter) Var] for certain types (including Var), we will</span>
    <span class="c1"># catch the normal RuntimeError and return a (variable)</span>
    <span class="c1"># GetItemExpression.</span>
    <span class="c1">#</span>
    <span class="c1"># FIXME: We should integrate this logic into the base implementation</span>
    <span class="c1"># of `__getitem__()`, including the recognition / differentiation</span>
    <span class="c1"># between potentially variable GetItemExpression objects and</span>
    <span class="c1"># &quot;constant&quot; GetItemExpression objects.  That will need to wait for</span>
    <span class="c1"># the expression rework [JDS; Nov 22].</span>
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">args</span> <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="vm">__class__</span> <span class="ow">is</span> <span class="nb">tuple</span> <span class="k">else</span> <span class="p">(</span><span class="n">args</span><span class="p">,)</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
                <span class="nb">hasattr</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="s1">&#39;is_potentially_variable&#39;</span><span class="p">)</span>
                <span class="ow">and</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_potentially_variable</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">tmp</span>
            <span class="p">):</span>
                <span class="k">return</span> <span class="n">GetItemExpression</span><span class="p">((</span><span class="bp">self</span><span class="p">,)</span> <span class="o">+</span> <span class="n">tmp</span><span class="p">)</span>
            <span class="k">raise</span>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2008-2023, Sandia National Laboratories.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>