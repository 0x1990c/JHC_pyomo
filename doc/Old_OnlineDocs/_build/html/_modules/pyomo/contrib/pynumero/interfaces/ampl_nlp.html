

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>pyomo.contrib.pynumero.interfaces.ampl_nlp &mdash; Pyomo 6.5.1.dev0 documentation</title>
  

  
  <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/theme_overrides.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../../../_static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../../" src="../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../_static/jquery.js"></script>
        <script src="../../../../../_static/underscore.js"></script>
        <script src="../../../../../_static/doctools.js"></script>
        <script src="../../../../../_static/clipboard.min.js"></script>
        <script src="../../../../../_static/copybutton.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../../index.html" class="icon icon-home"> Pyomo
          

          
          </a>

          
            
            
              <div class="version">
                6.5.1.dev0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../citing_pyomo.html">Citing Pyomo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../pyomo_overview/index.html">Pyomo Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../pyomo_modeling_components/index.html">Pyomo Modeling Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../solving_pyomo_models.html">Solving Pyomo Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../working_models.html">Working with Pyomo Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../working_abstractmodels/index.html">Working with Abstract Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../model_transformations/index.html">Model Transformations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../modeling_extensions/index.html">Modeling Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../tutorial_examples.html">Pyomo Tutorial Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../model_debugging/index.html">Debugging Pyomo Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../advanced_topics/index.html">Advanced Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../errors.html">Common Warnings/Errors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../developer_reference/index.html">Developer Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../library_reference/index.html">Library Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../contribution_guide.html">Contributing to Pyomo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../contributed_packages/index.html">Third-Party Contributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../related_packages.html">Related Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../bibliography.html">Bibliography</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">Pyomo</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../../../index.html">Module code</a> &raquo;</li>
        
      <li>pyomo.contrib.pynumero.interfaces.ampl_nlp</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pyomo.contrib.pynumero.interfaces.ampl_nlp</h1><div class="highlight"><pre>
<span></span><span class="c1">#  ___________________________________________________________________________</span>
<span class="c1">#</span>
<span class="c1">#  Pyomo: Python Optimization Modeling Objects</span>
<span class="c1">#  Copyright (c) 2008-2022</span>
<span class="c1">#  National Technology and Engineering Solutions of Sandia, LLC</span>
<span class="c1">#  Under the terms of Contract DE-NA0003525 with National Technology and</span>
<span class="c1">#  Engineering Solutions of Sandia, LLC, the U.S. Government retains certain</span>
<span class="c1">#  rights in this software.</span>
<span class="c1">#  This software is distributed under the 3-clause BSD License.</span>
<span class="c1">#  ___________________________________________________________________________</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module defines the classes that provide an NLP interface based on</span>
<span class="sd">the Ampl Solver Library (ASL) implementation</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">pyomo.contrib.pynumero.asl</span> <span class="k">as</span> <span class="nn">_asl</span>
<span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
    <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
        <span class="s1">&#39;Error importing asl.&#39;</span>
        <span class="s1">&#39;Make sure libpynumero_ASL is installed and added to path.&#39;</span>
    <span class="p">)</span>

<span class="kn">from</span> <span class="nn">scipy.sparse</span> <span class="kn">import</span> <span class="n">coo_matrix</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">pyomo.common.deprecation</span> <span class="kn">import</span> <span class="n">deprecated</span>
<span class="kn">from</span> <span class="nn">pyomo.contrib.pynumero.interfaces.nlp</span> <span class="kn">import</span> <span class="n">ExtendedNLP</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;AslNLP&#39;</span><span class="p">,</span> <span class="s1">&#39;AmplNLP&#39;</span><span class="p">]</span>


<span class="c1"># ToDo: need to add support for modifying bounds.</span>
<span class="c1"># support for changing variable bounds seems possible.</span>
<span class="c1"># support for changing inequality bounds would require more work. (this is less frequent?)</span>
<span class="c1"># TODO: check performance impacts of caching - memory and computational time.</span>
<span class="c1"># TODO: only create and cache data for ExtendedNLP methods if they are ever asked for</span>
<span class="c1"># TODO: There are todos in the code below</span>
<div class="viewcode-block" id="AslNLP"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.asl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AslNLP">[docs]</a><span class="k">class</span> <span class="nc">AslNLP</span><span class="p">(</span><span class="n">ExtendedNLP</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nl_file</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Base class for NLP classes based on the Ampl Solver Library and</span>
<span class="sd">        NL files.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nl_file : string</span>
<span class="sd">            filename of the NL-file containing the model</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">AslNLP</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1"># nl file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nl_file</span> <span class="o">=</span> <span class="n">nl_file</span>

        <span class="c1"># initialize the ampl interface</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_asl</span> <span class="o">=</span> <span class="n">_asl</span><span class="o">.</span><span class="n">AmplInterface</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nl_file</span><span class="p">)</span>

        <span class="c1"># collect the NLP structure and key data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_collect_nlp_structure</span><span class="p">()</span>

        <span class="c1"># create vectors to store the values for the primals and the duals</span>
        <span class="c1"># TODO: Check if we should initialize these to zero or from the init values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_primals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_primals</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_duals_full</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_duals_full</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_duals_eq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_duals_eq</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_duals_ineq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_duals_ineq</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_obj_factor</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cached_objective</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cached_grad_objective</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_new_vector</span><span class="p">(</span><span class="s1">&#39;primals&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cached_con_full</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_con_full</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cached_jac_full</span> <span class="o">=</span> <span class="n">coo_matrix</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nnz_jac_full</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_irows_jac_full</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jcols_jac_full</span><span class="p">),</span>
            <span class="p">),</span>
            <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_con_full</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_primals</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="c1"># these are only being cached for quicker copy of the matrix with the nonzero structure</span>
        <span class="c1"># TODO: only create these caches if the ExtendedNLP methods are asked for?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cached_jac_eq</span> <span class="o">=</span> <span class="n">coo_matrix</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nnz_jac_eq</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_irows_jac_eq</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jcols_jac_eq</span><span class="p">),</span>
            <span class="p">),</span>
            <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_con_eq</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_primals</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cached_jac_ineq</span> <span class="o">=</span> <span class="n">coo_matrix</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nnz_jac_ineq</span><span class="p">),</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_irows_jac_ineq</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jcols_jac_ineq</span><span class="p">),</span>
            <span class="p">),</span>
            <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_con_ineq</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_primals</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cached_hessian_lag</span> <span class="o">=</span> <span class="n">coo_matrix</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nnz_hessian_lag</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_irows_hess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jcols_hess</span><span class="p">),</span>
            <span class="p">),</span>
            <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_primals</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_primals</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_invalidate_primals_cache</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_invalidate_duals_cache</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_invalidate_obj_factor_cache</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_invalidate_primals_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_objective_is_cached</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_grad_objective_is_cached</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_con_full_is_cached</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_jac_full_is_cached</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hessian_lag_is_cached</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_invalidate_duals_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hessian_lag_is_cached</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_invalidate_obj_factor_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hessian_lag_is_cached</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_collect_nlp_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Collect characteristics of the NLP from the ASL interface</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get the problem dimensions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_n_primals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_asl</span><span class="o">.</span><span class="n">get_n_vars</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_n_con_full</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_asl</span><span class="o">.</span><span class="n">get_n_constraints</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nnz_jac_full</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_asl</span><span class="o">.</span><span class="n">get_nnz_jac_g</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nnz_hess_lag_lower</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_asl</span><span class="o">.</span><span class="n">get_nnz_hessian_lag</span><span class="p">()</span>

        <span class="c1"># get the initial values for the primals</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_primals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_primals</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_duals_full</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_con_full</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_asl</span><span class="o">.</span><span class="n">get_init_x</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_init_primals</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_asl</span><span class="o">.</span><span class="n">get_init_multipliers</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_init_duals_full</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_primals</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">writeable</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_duals_full</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">writeable</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># get the bounds on the primal variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_primals_lb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_primals</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_primals_ub</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_primals</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_asl</span><span class="o">.</span><span class="n">get_x_lower_bounds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_primals_lb</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_asl</span><span class="o">.</span><span class="n">get_x_upper_bounds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_primals_ub</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_primals_lb</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">writeable</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_primals_ub</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">writeable</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># get the bounds on the constraints (equality and</span>
        <span class="c1"># inequality are mixed in the ampl solver library)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_con_full_lb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_con_full</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_con_full_ub</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_con_full</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_asl</span><span class="o">.</span><span class="n">get_g_lower_bounds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_con_full_lb</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_asl</span><span class="o">.</span><span class="n">get_g_upper_bounds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_con_full_ub</span><span class="p">)</span>

        <span class="c1"># check to make sure there are no crossed bounds</span>
        <span class="n">bounds_difference</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_primals_ub</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_primals_lb</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">bounds_difference</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">bounds_difference</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Some variables have lower bounds that are greater than the upper bounds.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Build the maps for converting from the full constraint</span>
        <span class="c1"># vector (which includes all equality and inequality constraints)</span>
        <span class="c1"># to separate vectors of equality and inequality constraints.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_build_constraint_maps</span><span class="p">()</span>

        <span class="c1"># get the values for the lower and upper bounds on the</span>
        <span class="c1"># inequalities (extracted from con_full)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_con_ineq_lb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_con_full_ineq_mask</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_con_full_lb</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_con_ineq_ub</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_con_full_ineq_mask</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_con_full_ub</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_con_ineq_lb</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">writeable</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_con_ineq_ub</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">writeable</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># get the initial values for the dual variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_duals_eq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_con_full_eq_mask</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_duals_full</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_duals_ineq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_con_full_ineq_mask</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_duals_full</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_duals_eq</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">writeable</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_duals_ineq</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">writeable</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># TODO: Should we be doing this or not?</span>
        <span class="c1"># adjust the rhs to be 0 for equality constraints (in both full and eq)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_con_full_rhs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_con_full_ub</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1"># set the rhs to zero for the inequality constraints (will use lb, ub)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_con_full_rhs</span><span class="p">[</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">_con_full_eq_mask</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="c1"># change the upper and lower bounds to zero for equality constraints</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_con_full_lb</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_con_full_eq_mask</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_con_full_ub</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_con_full_eq_mask</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_con_full_lb</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">writeable</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_con_full_ub</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">writeable</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># set number of equatity and inequality constraints from maps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_n_con_eq</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_con_eq_full_map</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_n_con_ineq</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_con_ineq_full_map</span><span class="p">)</span>

        <span class="c1"># populate jacobian structure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_irows_jac_full</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nnz_jac_full</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">intc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_jcols_jac_full</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nnz_jac_full</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">intc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_asl</span><span class="o">.</span><span class="n">struct_jac_g</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_irows_jac_full</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jcols_jac_full</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_irows_jac_full</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_jcols_jac_full</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_irows_jac_full</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">writeable</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_jcols_jac_full</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">writeable</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_nz_con_full_eq_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_irows_jac_full</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_con_eq_full_map</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nz_con_full_ineq_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nz_con_full_eq_mask</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_irows_jac_eq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_nz_con_full_eq_mask</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_irows_jac_full</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_jcols_jac_eq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_nz_con_full_eq_mask</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jcols_jac_full</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_irows_jac_ineq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_nz_con_full_ineq_mask</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_irows_jac_full</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_jcols_jac_ineq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_nz_con_full_ineq_mask</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jcols_jac_full</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nnz_jac_eq</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_irows_jac_eq</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nnz_jac_ineq</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_irows_jac_ineq</span><span class="p">)</span>

        <span class="c1"># this is expensive but only done once - can we do this with numpy somehow?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_con_full_eq_map</span> <span class="o">=</span> <span class="n">full_eq_map</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_con_eq_full_map</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_con_eq</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_irows_jac_eq</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_irows_jac_eq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">full_eq_map</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_con_full_ineq_map</span> <span class="o">=</span> <span class="n">full_ineq_map</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_con_ineq_full_map</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_con_ineq</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_irows_jac_ineq</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_irows_jac_ineq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">full_ineq_map</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_irows_jac_eq</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">writeable</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_jcols_jac_eq</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">writeable</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_irows_jac_ineq</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">writeable</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_jcols_jac_ineq</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">writeable</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># set nnz for equality and inequality jacobian</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nnz_jac_eq</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_jcols_jac_eq</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nnz_jac_ineq</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_jcols_jac_ineq</span><span class="p">)</span>

        <span class="c1"># populate hessian structure (lower triangular)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_irows_hess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nnz_hess_lag_lower</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">intc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_jcols_hess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nnz_hess_lag_lower</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">intc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_asl</span><span class="o">.</span><span class="n">struct_hes_lag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_irows_hess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jcols_hess</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_irows_hess</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_jcols_hess</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="c1"># rework hessian to full matrix (lower and upper)</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_irows_hess</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jcols_hess</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lower_hess_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">diff</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">lower</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lower_hess_mask</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_irows_hess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_irows_hess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jcols_hess</span><span class="p">[</span><span class="n">lower</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_jcols_hess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_jcols_hess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_irows_hess</span><span class="p">[</span><span class="n">lower</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nnz_hessian_lag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_irows_hess</span><span class="o">.</span><span class="n">size</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_irows_hess</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">writeable</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_jcols_hess</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">writeable</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_build_constraint_maps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates internal maps and masks that convert from the full</span>
<span class="sd">        vector of constraints (the vector that includes all equality</span>
<span class="sd">        and inequality constraints combined) to separate vectors that</span>
<span class="sd">        include the equality and inequality constraints only.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check the bounds on the constraints for crossing</span>
        <span class="n">bounds_difference</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_con_full_ub</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_con_full_lb</span>
        <span class="n">inconsistent_bounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">bounds_difference</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">inconsistent_bounds</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Bounds on range constraints found with upper bounds set below the lower bounds.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># build maps from con_full to con_eq and con_ineq</span>
        <span class="n">abs_bounds_difference</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">bounds_difference</span><span class="p">)</span>
        <span class="n">tolerance_equalities</span> <span class="o">=</span> <span class="mf">1e-8</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_con_full_eq_mask</span> <span class="o">=</span> <span class="n">abs_bounds_difference</span> <span class="o">&lt;</span> <span class="n">tolerance_equalities</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_con_eq_full_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_con_full_eq_mask</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_con_full_ineq_mask</span> <span class="o">=</span> <span class="n">abs_bounds_difference</span> <span class="o">&gt;=</span> <span class="n">tolerance_equalities</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_con_ineq_full_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_con_full_ineq_mask</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_con_full_eq_mask</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">writeable</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_con_eq_full_map</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">writeable</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_con_full_ineq_mask</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">writeable</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_con_ineq_full_map</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">writeable</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># these do not appear to be used anywhere - keeping the logic for now</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        #TODO: Can we simplify this logic?</span>
<span class="sd">        con_full_fulllb_mask = np.isfinite(self._con_full_lb) * self._con_full_ineq_mask + self._con_full_eq_mask</span>
<span class="sd">        con_fulllb_full_map = con_full_fulllb_mask.nonzero()[0]</span>
<span class="sd">        con_full_fullub_mask = np.isfinite(self._con_full_ub) * self._con_full_ineq_mask + self._con_full_eq_mask</span>
<span class="sd">        con_fullub_full_map = con_full_fullub_mask.nonzero()[0]</span>

<span class="sd">        self._ineq_lb_mask = np.isin(self._ineq_g_map, lb_g_map)</span>
<span class="sd">        self._lb_ineq_map = np.where(self._ineq_lb_mask)[0]</span>
<span class="sd">        self._ineq_ub_mask = np.isin(self._ineq_g_map, ub_g_map)</span>
<span class="sd">        self._ub_ineq_map = np.where(self._ineq_ub_mask)[0]</span>
<span class="sd">        self._ineq_lb_mask.flags.writeable = False</span>
<span class="sd">        self._lb_ineq_map.flags.writeable = False</span>
<span class="sd">        self._ineq_ub_mask.flags.writeable = False</span>
<span class="sd">        self._ub_ineq_map.flags.writeable = False</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="c1"># overloaded from NLP</span>
<div class="viewcode-block" id="AslNLP.n_primals"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.asl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AslNLP.n_primals">[docs]</a>    <span class="k">def</span> <span class="nf">n_primals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_primals</span></div>

    <span class="c1"># overloaded from NLP</span>
<div class="viewcode-block" id="AslNLP.n_constraints"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.asl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AslNLP.n_constraints">[docs]</a>    <span class="k">def</span> <span class="nf">n_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_con_full</span></div>

    <span class="c1"># overloaded from ExtendedNLP</span>
<div class="viewcode-block" id="AslNLP.n_eq_constraints"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.asl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AslNLP.n_eq_constraints">[docs]</a>    <span class="k">def</span> <span class="nf">n_eq_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_con_eq</span></div>

    <span class="c1"># overloaded from ExtendedNLP</span>
<div class="viewcode-block" id="AslNLP.n_ineq_constraints"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.asl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AslNLP.n_ineq_constraints">[docs]</a>    <span class="k">def</span> <span class="nf">n_ineq_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_con_ineq</span></div>

    <span class="c1"># overloaded from NLP</span>
<div class="viewcode-block" id="AslNLP.nnz_jacobian"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.asl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AslNLP.nnz_jacobian">[docs]</a>    <span class="k">def</span> <span class="nf">nnz_jacobian</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nnz_jac_full</span></div>

    <span class="c1"># overloaded from ExtendedNLP</span>
<div class="viewcode-block" id="AslNLP.nnz_jacobian_eq"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.asl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AslNLP.nnz_jacobian_eq">[docs]</a>    <span class="k">def</span> <span class="nf">nnz_jacobian_eq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nnz_jac_eq</span></div>

    <span class="c1"># overloaded from ExtendedNLP</span>
<div class="viewcode-block" id="AslNLP.nnz_jacobian_ineq"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.asl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AslNLP.nnz_jacobian_ineq">[docs]</a>    <span class="k">def</span> <span class="nf">nnz_jacobian_ineq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nnz_jac_ineq</span></div>

    <span class="c1"># overloaded from NLP</span>
<div class="viewcode-block" id="AslNLP.nnz_hessian_lag"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.asl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AslNLP.nnz_hessian_lag">[docs]</a>    <span class="k">def</span> <span class="nf">nnz_hessian_lag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nnz_hessian_lag</span></div>

    <span class="c1"># overloaded from NLP</span>
<div class="viewcode-block" id="AslNLP.primals_lb"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.asl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AslNLP.primals_lb">[docs]</a>    <span class="k">def</span> <span class="nf">primals_lb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_primals_lb</span></div>

    <span class="c1"># overloaded from NLP</span>
<div class="viewcode-block" id="AslNLP.primals_ub"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.asl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AslNLP.primals_ub">[docs]</a>    <span class="k">def</span> <span class="nf">primals_ub</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_primals_ub</span></div>

    <span class="c1"># overloaded from NLP</span>
<div class="viewcode-block" id="AslNLP.constraints_lb"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.asl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AslNLP.constraints_lb">[docs]</a>    <span class="k">def</span> <span class="nf">constraints_lb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_con_full_lb</span></div>

    <span class="c1"># overloaded from NLP</span>
<div class="viewcode-block" id="AslNLP.constraints_ub"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.asl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AslNLP.constraints_ub">[docs]</a>    <span class="k">def</span> <span class="nf">constraints_ub</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_con_full_ub</span></div>

    <span class="c1"># overloaded from ExtendedNLP</span>
<div class="viewcode-block" id="AslNLP.ineq_lb"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.asl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AslNLP.ineq_lb">[docs]</a>    <span class="k">def</span> <span class="nf">ineq_lb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_con_ineq_lb</span></div>

    <span class="c1"># overloaded from ExtendedNLP</span>
<div class="viewcode-block" id="AslNLP.ineq_ub"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.asl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AslNLP.ineq_ub">[docs]</a>    <span class="k">def</span> <span class="nf">ineq_ub</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_con_ineq_ub</span></div>

    <span class="c1"># overloaded from NLP</span>
<div class="viewcode-block" id="AslNLP.init_primals"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.asl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AslNLP.init_primals">[docs]</a>    <span class="k">def</span> <span class="nf">init_primals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_primals</span></div>

    <span class="c1"># overloaded from NLP</span>
<div class="viewcode-block" id="AslNLP.init_duals"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.asl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AslNLP.init_duals">[docs]</a>    <span class="k">def</span> <span class="nf">init_duals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_duals_full</span></div>

    <span class="c1"># overloaded from ExtendedNLP</span>
<div class="viewcode-block" id="AslNLP.init_duals_eq"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.asl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AslNLP.init_duals_eq">[docs]</a>    <span class="k">def</span> <span class="nf">init_duals_eq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_duals_eq</span></div>

    <span class="c1"># overloaded from ExtendedNLP</span>
<div class="viewcode-block" id="AslNLP.init_duals_ineq"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.asl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AslNLP.init_duals_ineq">[docs]</a>    <span class="k">def</span> <span class="nf">init_duals_ineq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_duals_ineq</span></div>

    <span class="c1"># overloaded from NLP / Extended NLP</span>
<div class="viewcode-block" id="AslNLP.create_new_vector"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.asl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AslNLP.create_new_vector">[docs]</a>    <span class="k">def</span> <span class="nf">create_new_vector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vector_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a vector of the appropriate length and structure as</span>
<span class="sd">        requested</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        vector_type: {&#39;primals&#39;, &#39;constraints&#39;, &#39;eq_constraints&#39;, &#39;ineq_constraints&#39;,</span>
<span class="sd">                      &#39;duals&#39;, &#39;duals_eq&#39;, &#39;duals_ineq&#39;}</span>
<span class="sd">            String identifying the appropriate  vector  to create.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        numpy.ndarray</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">vector_type</span> <span class="o">==</span> <span class="s1">&#39;primals&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_primals</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">vector_type</span> <span class="o">==</span> <span class="s1">&#39;constraints&#39;</span> <span class="ow">or</span> <span class="n">vector_type</span> <span class="o">==</span> <span class="s1">&#39;duals&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_constraints</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">vector_type</span> <span class="o">==</span> <span class="s1">&#39;eq_constraints&#39;</span> <span class="ow">or</span> <span class="n">vector_type</span> <span class="o">==</span> <span class="s1">&#39;duals_eq&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_eq_constraints</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">vector_type</span> <span class="o">==</span> <span class="s1">&#39;ineq_constraints&#39;</span> <span class="ow">or</span> <span class="n">vector_type</span> <span class="o">==</span> <span class="s1">&#39;duals_ineq&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_ineq_constraints</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Called create_new_vector with an unknown vector_type&#39;</span><span class="p">)</span></div>

    <span class="c1"># overloaded from NLP</span>
<div class="viewcode-block" id="AslNLP.set_primals"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.asl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AslNLP.set_primals">[docs]</a>    <span class="k">def</span> <span class="nf">set_primals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">primals</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_invalidate_primals_cache</span><span class="p">()</span>
        <span class="n">np</span><span class="o">.</span><span class="n">copyto</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_primals</span><span class="p">,</span> <span class="n">primals</span><span class="p">)</span></div>

    <span class="c1"># overloaded from NLP</span>
<div class="viewcode-block" id="AslNLP.get_primals"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.asl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AslNLP.get_primals">[docs]</a>    <span class="k">def</span> <span class="nf">get_primals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_primals</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>

    <span class="c1"># overloaded from NLP</span>
<div class="viewcode-block" id="AslNLP.set_duals"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.asl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AslNLP.set_duals">[docs]</a>    <span class="k">def</span> <span class="nf">set_duals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">duals</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_invalidate_duals_cache</span><span class="p">()</span>
        <span class="n">np</span><span class="o">.</span><span class="n">copyto</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_duals_full</span><span class="p">,</span> <span class="n">duals</span><span class="p">)</span>
        <span class="c1"># keep the separated duals up to date just in case</span>
        <span class="n">np</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_con_full_eq_mask</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_duals_full</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_duals_eq</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_con_full_ineq_mask</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_duals_full</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_duals_ineq</span><span class="p">)</span></div>

    <span class="c1"># overloaded from NLP</span>
<div class="viewcode-block" id="AslNLP.get_duals"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.asl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AslNLP.get_duals">[docs]</a>    <span class="k">def</span> <span class="nf">get_duals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_duals_full</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>

    <span class="c1"># overloaded from NLP</span>
<div class="viewcode-block" id="AslNLP.set_obj_factor"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.asl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AslNLP.set_obj_factor">[docs]</a>    <span class="k">def</span> <span class="nf">set_obj_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj_factor</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_invalidate_obj_factor_cache</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_obj_factor</span> <span class="o">=</span> <span class="n">obj_factor</span></div>

    <span class="c1"># overloaded from NLP</span>
<div class="viewcode-block" id="AslNLP.get_obj_factor"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.asl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AslNLP.get_obj_factor">[docs]</a>    <span class="k">def</span> <span class="nf">get_obj_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obj_factor</span></div>

    <span class="c1"># overloaded from ExtendedNLP</span>
<div class="viewcode-block" id="AslNLP.set_duals_eq"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.asl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AslNLP.set_duals_eq">[docs]</a>    <span class="k">def</span> <span class="nf">set_duals_eq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">duals_eq</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_invalidate_duals_cache</span><span class="p">()</span>
        <span class="n">np</span><span class="o">.</span><span class="n">copyto</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_duals_eq</span><span class="p">,</span> <span class="n">duals_eq</span><span class="p">)</span>
        <span class="c1"># keep duals_full up to date just in case</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_duals_full</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_con_full_eq_mask</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_duals_eq</span></div>

    <span class="c1"># overloaded from ExtendedNLP</span>
<div class="viewcode-block" id="AslNLP.get_duals_eq"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.asl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AslNLP.get_duals_eq">[docs]</a>    <span class="k">def</span> <span class="nf">get_duals_eq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_duals_eq</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>

    <span class="c1"># overloaded from ExtendedNLP</span>
<div class="viewcode-block" id="AslNLP.set_duals_ineq"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.asl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AslNLP.set_duals_ineq">[docs]</a>    <span class="k">def</span> <span class="nf">set_duals_ineq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">duals_ineq</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_invalidate_duals_cache</span><span class="p">()</span>
        <span class="n">np</span><span class="o">.</span><span class="n">copyto</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_duals_ineq</span><span class="p">,</span> <span class="n">duals_ineq</span><span class="p">)</span>
        <span class="c1"># keep duals_full up to date just in case</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_duals_full</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_con_full_ineq_mask</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_duals_ineq</span></div>

    <span class="c1"># overloaded from ExtendedNLP</span>
<div class="viewcode-block" id="AslNLP.get_duals_ineq"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.asl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AslNLP.get_duals_ineq">[docs]</a>    <span class="k">def</span> <span class="nf">get_duals_ineq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_duals_ineq</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>

    <span class="c1"># overloaded from NLP</span>
<div class="viewcode-block" id="AslNLP.get_obj_scaling"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.asl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AslNLP.get_obj_scaling">[docs]</a>    <span class="k">def</span> <span class="nf">get_obj_scaling</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span></div>

    <span class="c1"># overloaded from NLP - derived classes may implement</span>
<div class="viewcode-block" id="AslNLP.get_primals_scaling"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.asl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AslNLP.get_primals_scaling">[docs]</a>    <span class="k">def</span> <span class="nf">get_primals_scaling</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span></div>

    <span class="c1"># overloaded from NLP - derived classes may implement</span>
<div class="viewcode-block" id="AslNLP.get_constraints_scaling"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.asl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AslNLP.get_constraints_scaling">[docs]</a>    <span class="k">def</span> <span class="nf">get_constraints_scaling</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span></div>

    <span class="c1"># overloaded from ExtendedNLP</span>
<div class="viewcode-block" id="AslNLP.get_eq_constraints_scaling"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.asl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AslNLP.get_eq_constraints_scaling">[docs]</a>    <span class="k">def</span> <span class="nf">get_eq_constraints_scaling</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">constraints_scaling</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_constraints_scaling</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">constraints_scaling</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_con_full_eq_mask</span><span class="p">,</span> <span class="n">constraints_scaling</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>

    <span class="c1"># overloaded from ExtendedNLP</span>
<div class="viewcode-block" id="AslNLP.get_ineq_constraints_scaling"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.asl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AslNLP.get_ineq_constraints_scaling">[docs]</a>    <span class="k">def</span> <span class="nf">get_ineq_constraints_scaling</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">constraints_scaling</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_constraints_scaling</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">constraints_scaling</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_con_full_ineq_mask</span><span class="p">,</span> <span class="n">constraints_scaling</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>

    <span class="k">def</span> <span class="nf">_evaluate_objective_and_cache_if_necessary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_objective_is_cached</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cached_objective</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_asl</span><span class="o">.</span><span class="n">eval_f</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_primals</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_objective_is_cached</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># overloaded from NLP</span>
<div class="viewcode-block" id="AslNLP.evaluate_objective"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.asl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AslNLP.evaluate_objective">[docs]</a>    <span class="k">def</span> <span class="nf">evaluate_objective</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_objective_and_cache_if_necessary</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cached_objective</span></div>

    <span class="c1"># overloaded from NLP</span>
<div class="viewcode-block" id="AslNLP.evaluate_grad_objective"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.asl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AslNLP.evaluate_grad_objective">[docs]</a>    <span class="k">def</span> <span class="nf">evaluate_grad_objective</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_grad_objective_is_cached</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_asl</span><span class="o">.</span><span class="n">eval_deriv_f</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_primals</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cached_grad_objective</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_grad_objective_is_cached</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="n">out</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_primals</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s1">&#39;Called evaluate_grad_objective with an invalid &quot;out&quot; argument - should take an ndarray of size </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_n_primals</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="n">np</span><span class="o">.</span><span class="n">copyto</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cached_grad_objective</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">out</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cached_grad_objective</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_evaluate_constraints_and_cache_if_necessary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># ASL computes the full constraint vector, therefore, we merge</span>
        <span class="c1"># this computation into one</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_con_full_is_cached</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_asl</span><span class="o">.</span><span class="n">eval_g</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_primals</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cached_con_full</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cached_con_full</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_con_full_rhs</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_con_full_is_cached</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># overloaded from NLP</span>
<div class="viewcode-block" id="AslNLP.evaluate_constraints"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.asl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AslNLP.evaluate_constraints">[docs]</a>    <span class="k">def</span> <span class="nf">evaluate_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_constraints_and_cache_if_necessary</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="n">out</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_con_full</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s1">&#39;Called evaluate_constraints with an invalid&#39;</span>
                    <span class="s1">&#39; &quot;out&quot; argument - should take an ndarray of &#39;</span>
                    <span class="s1">&#39;size </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_con_full</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="n">np</span><span class="o">.</span><span class="n">copyto</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cached_con_full</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">out</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cached_con_full</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>

    <span class="c1"># overloaded from ExtendedNLP</span>
<div class="viewcode-block" id="AslNLP.evaluate_eq_constraints"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.asl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AslNLP.evaluate_eq_constraints">[docs]</a>    <span class="k">def</span> <span class="nf">evaluate_eq_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_constraints_and_cache_if_necessary</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="n">out</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_con_eq</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s1">&#39;Called evaluate_eq_constraints with an invalid&#39;</span>
                    <span class="s1">&#39; &quot;out&quot; argument - should take an ndarray of &#39;</span>
                    <span class="s1">&#39;size </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_con_eq</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cached_con_full</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_con_full_eq_mask</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">out</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">out</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cached_con_full</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_con_full_eq_mask</span><span class="p">)</span></div>

    <span class="c1"># overloaded from ExtendedNLP</span>
<div class="viewcode-block" id="AslNLP.evaluate_ineq_constraints"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.asl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AslNLP.evaluate_ineq_constraints">[docs]</a>    <span class="k">def</span> <span class="nf">evaluate_ineq_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_constraints_and_cache_if_necessary</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="n">out</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_con_ineq</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s1">&#39;Called evaluate_ineq_constraints with an invalid&#39;</span>
                    <span class="s1">&#39; &quot;out&quot; argument - should take an ndarray of &#39;</span>
                    <span class="s1">&#39;size </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_con_ineq</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cached_con_full</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_con_full_ineq_mask</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">out</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">out</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cached_con_full</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_con_full_ineq_mask</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_evaluate_jacobians_and_cache_if_necessary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># ASL computes the jacobian for the full constraints, therefore, we merge</span>
        <span class="c1"># this computation into one</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jac_full_is_cached</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_asl</span><span class="o">.</span><span class="n">eval_jac_g</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_primals</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cached_jac_full</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_jac_full_is_cached</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># overloaded from NLP</span>
<div class="viewcode-block" id="AslNLP.evaluate_jacobian"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.asl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AslNLP.evaluate_jacobian">[docs]</a>    <span class="k">def</span> <span class="nf">evaluate_jacobian</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_jacobians_and_cache_if_necessary</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">coo_matrix</span><span class="p">)</span>
                <span class="ow">or</span> <span class="n">out</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_con_full</span>
                <span class="ow">or</span> <span class="n">out</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_primals</span>
                <span class="ow">or</span> <span class="n">out</span><span class="o">.</span><span class="n">nnz</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nnz_jac_full</span>
            <span class="p">):</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s1">&#39;evaluate_jacobian called with an &quot;out&quot; argument&#39;</span>
                    <span class="s1">&#39; that is invalid. This should be a coo_matrix with&#39;</span>
                    <span class="s1">&#39; shape=(</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">) and nnz=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_n_con_full</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_primals</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nnz_jac_full</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="n">np</span><span class="o">.</span><span class="n">copyto</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cached_jac_full</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">out</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cached_jac_full</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>

    <span class="c1"># overloaded from ExtendedNLP</span>
<div class="viewcode-block" id="AslNLP.evaluate_jacobian_eq"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.asl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AslNLP.evaluate_jacobian_eq">[docs]</a>    <span class="k">def</span> <span class="nf">evaluate_jacobian_eq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_jacobians_and_cache_if_necessary</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">coo_matrix</span><span class="p">)</span>
                <span class="ow">or</span> <span class="n">out</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_con_eq</span>
                <span class="ow">or</span> <span class="n">out</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_primals</span>
                <span class="ow">or</span> <span class="n">out</span><span class="o">.</span><span class="n">nnz</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nnz_jac_eq</span>
            <span class="p">):</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s1">&#39;evaluate_jacobian_eq called with an &quot;out&quot; argument&#39;</span>
                    <span class="s1">&#39; that is invalid. This should be a coo_matrix with&#39;</span>
                    <span class="s1">&#39; shape=(</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">) and nnz=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_n_con_eq</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_primals</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nnz_jac_eq</span>
                    <span class="p">)</span>
                <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_cached_jac_full</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nz_con_full_eq_mask</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">out</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">out</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cached_jac_full</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_nz_con_full_eq_mask</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_cached_jac_eq</span><span class="o">.</span><span class="n">data</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cached_jac_eq</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>

    <span class="c1"># overloaded from NLP</span>
<div class="viewcode-block" id="AslNLP.evaluate_jacobian_ineq"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.asl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AslNLP.evaluate_jacobian_ineq">[docs]</a>    <span class="k">def</span> <span class="nf">evaluate_jacobian_ineq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_jacobians_and_cache_if_necessary</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">coo_matrix</span><span class="p">)</span>
                <span class="ow">or</span> <span class="n">out</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_con_ineq</span>
                <span class="ow">or</span> <span class="n">out</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_primals</span>
                <span class="ow">or</span> <span class="n">out</span><span class="o">.</span><span class="n">nnz</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nnz_jac_ineq</span>
            <span class="p">):</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s1">&#39;evaluate_jacobian_ineq called with an &quot;out&quot; argument&#39;</span>
                    <span class="s1">&#39; that is invalid. This should be a coo_matrix with&#39;</span>
                    <span class="s1">&#39; shape=(</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">) and nnz=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_n_con_ineq</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_primals</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nnz_jac_ineq</span>
                    <span class="p">)</span>
                <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_cached_jac_full</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_nz_con_full_ineq_mask</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">out</span><span class="o">.</span><span class="n">data</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">out</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cached_jac_full</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_nz_con_full_ineq_mask</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_cached_jac_ineq</span><span class="o">.</span><span class="n">data</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cached_jac_ineq</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>

<div class="viewcode-block" id="AslNLP.evaluate_hessian_lag"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.asl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AslNLP.evaluate_hessian_lag">[docs]</a>    <span class="k">def</span> <span class="nf">evaluate_hessian_lag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hessian_lag_is_cached</span><span class="p">:</span>
            <span class="c1"># evaluating the hessian requires that we have first</span>
            <span class="c1"># evaluated the objective and the constraints</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_objective_and_cache_if_necessary</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_constraints_and_cache_if_necessary</span><span class="p">()</span>

            <span class="c1"># get the hessian</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nnz_hess_lag_lower</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_asl</span><span class="o">.</span><span class="n">eval_hes_lag</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_primals</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_duals_full</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">obj_factor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_obj_factor</span>
            <span class="p">)</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">data</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_lower_hess_mask</span><span class="p">]))</span>
            <span class="c1"># note: this was done to ensure that scipy did not change</span>
            <span class="c1"># the structure of a sparse matrix if one of the nonzeros</span>
            <span class="c1"># happened to be zero.</span>
            <span class="c1"># CDL: I am removing this for now to see if it is necessary</span>
            <span class="c1"># values += 1e-16 # this is to deal with scipy bug temporarily</span>
            <span class="c1"># CDL</span>
            <span class="n">np</span><span class="o">.</span><span class="n">copyto</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cached_hessian_lag</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hessian_lag_is_cached</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">coo_matrix</span><span class="p">)</span>
                <span class="ow">or</span> <span class="n">out</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_primals</span>
                <span class="ow">or</span> <span class="n">out</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_primals</span>
                <span class="ow">or</span> <span class="n">out</span><span class="o">.</span><span class="n">nnz</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nnz_hessian_lag</span>
            <span class="p">):</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s1">&#39;evaluate_hessian_lag called with an &quot;out&quot; argument&#39;</span>
                    <span class="s1">&#39; that is invalid. This should be a coo_matrix with&#39;</span>
                    <span class="s1">&#39; shape=(</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">) and nnz=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_n_primals</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_primals</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nnz_hessian_lag</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="n">np</span><span class="o">.</span><span class="n">copyto</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cached_hessian_lag</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">out</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cached_hessian_lag</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>

<div class="viewcode-block" id="AslNLP.report_solver_status"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.asl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AslNLP.report_solver_status">[docs]</a>    <span class="k">def</span> <span class="nf">report_solver_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status_code</span><span class="p">,</span> <span class="n">status_message</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_asl</span><span class="o">.</span><span class="n">finalize_solution</span><span class="p">(</span>
            <span class="n">status_code</span><span class="p">,</span> <span class="n">status_message</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_primals</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_duals</span>
        <span class="p">)</span></div></div>


<div class="viewcode-block" id="AmplNLP"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.ampl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AmplNLP">[docs]</a><span class="k">class</span> <span class="nc">AmplNLP</span><span class="p">(</span><span class="n">AslNLP</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nl_file</span><span class="p">,</span> <span class="n">row_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">col_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        AMPL nonlinear program interface.</span>
<span class="sd">        If row_filename and col_filename are not provided, the interface</span>
<span class="sd">        will see if files exist (with same name as nl_file but the .row</span>
<span class="sd">        and .col extensions)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nl_file: str</span>
<span class="sd">            filename of the NL-file containing the model</span>
<span class="sd">        row_filename: str, optional</span>
<span class="sd">            filename of .row file with identity of constraints</span>
<span class="sd">        col_filename: str, optional</span>
<span class="sd">            filename of .col file with identity of variables</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># call parent class to set the nl file name and load the model</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">AmplNLP</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">nl_file</span><span class="p">)</span>

        <span class="c1"># check for the existence of the row / col files</span>
        <span class="k">if</span> <span class="n">row_filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tmp_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">nl_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.row&#39;</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">tmp_filename</span><span class="p">):</span>
                <span class="n">row_filename</span> <span class="o">=</span> <span class="n">tmp_filename</span>

        <span class="k">if</span> <span class="n">col_filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tmp_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">nl_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.col&#39;</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">tmp_filename</span><span class="p">):</span>
                <span class="n">col_filename</span> <span class="o">=</span> <span class="n">tmp_filename</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_rowfile</span> <span class="o">=</span> <span class="n">row_filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_colfile</span> <span class="o">=</span> <span class="n">col_filename</span>

        <span class="c1"># create containers with names of variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vidx_to_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name_to_vidx</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">col_filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_vidx_to_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_component_names_list</span><span class="p">(</span><span class="n">col_filename</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_name_to_vidx</span> <span class="o">=</span> <span class="p">{</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_vidx_to_name</span><span class="p">[</span><span class="n">vidx</span><span class="p">]:</span> <span class="n">vidx</span> <span class="k">for</span> <span class="n">vidx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_primals</span><span class="p">)</span>
            <span class="p">}</span>

        <span class="c1"># create containers with names of constraints and objective</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_con_full_idx_to_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name_to_con_full_idx</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_obj_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">row_filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">all_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_component_names_list</span><span class="p">(</span><span class="n">row_filename</span><span class="p">)</span>
            <span class="c1"># objective is the last one in the list</span>
            <span class="c1"># TODO: what happens with multiple objectives?</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_obj_name</span> <span class="o">=</span> <span class="n">all_names</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">all_names</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_con_full_idx_to_name</span> <span class="o">=</span> <span class="n">all_names</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_con_eq_idx_to_name</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">all_names</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_con_eq_full_map</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_con_eq</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_con_ineq_idx_to_name</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">all_names</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_con_ineq_full_map</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_con_ineq</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_name_to_con_full_idx</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">all_names</span><span class="p">[</span><span class="n">cidx</span><span class="p">]:</span> <span class="n">cidx</span> <span class="k">for</span> <span class="n">cidx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_con_full</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_name_to_con_eq_idx</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">name</span><span class="p">:</span> <span class="n">idx</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_con_eq_idx_to_name</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_name_to_con_ineq_idx</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">name</span><span class="p">:</span> <span class="n">idx</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_con_ineq_idx_to_name</span><span class="p">)</span>
            <span class="p">}</span>

<div class="viewcode-block" id="AmplNLP.primals_names"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.ampl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AmplNLP.primals_names">[docs]</a>    <span class="k">def</span> <span class="nf">primals_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns ordered list with names of primal variables&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vidx_to_name</span><span class="p">)</span></div>

<div class="viewcode-block" id="AmplNLP.variable_names"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.ampl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AmplNLP.variable_names">[docs]</a>    <span class="nd">@deprecated</span><span class="p">(</span>
        <span class="n">msg</span><span class="o">=</span><span class="s1">&#39;This method has been replaced with primals_names&#39;</span><span class="p">,</span>
        <span class="n">version</span><span class="o">=</span><span class="s1">&#39;6.0.0.dev0&#39;</span><span class="p">,</span>
        <span class="n">remove_in</span><span class="o">=</span><span class="s1">&#39;6.0&#39;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">variable_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns ordered list with names of primal variables&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">primals_names</span><span class="p">()</span></div>

<div class="viewcode-block" id="AmplNLP.constraint_names"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.ampl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AmplNLP.constraint_names">[docs]</a>    <span class="k">def</span> <span class="nf">constraint_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns an ordered list with the names of all the constraints</span>
<span class="sd">        (corresponding to evaluate_constraints)&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_con_full_idx_to_name</span><span class="p">)</span></div>

<div class="viewcode-block" id="AmplNLP.eq_constraint_names"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.ampl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AmplNLP.eq_constraint_names">[docs]</a>    <span class="k">def</span> <span class="nf">eq_constraint_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns ordered list with names of equality constraints only</span>
<span class="sd">        (corresponding to evaluate_eq_constraints)&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_con_eq_idx_to_name</span><span class="p">)</span></div>

<div class="viewcode-block" id="AmplNLP.ineq_constraint_names"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.ampl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AmplNLP.ineq_constraint_names">[docs]</a>    <span class="k">def</span> <span class="nf">ineq_constraint_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns ordered list with names of inequality constraints only</span>
<span class="sd">        (corresponding to evaluate_ineq_constraints)&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_con_ineq_idx_to_name</span><span class="p">)</span></div>

<div class="viewcode-block" id="AmplNLP.variable_idx"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.ampl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AmplNLP.variable_idx">[docs]</a>    <span class="nd">@deprecated</span><span class="p">(</span>
        <span class="n">msg</span><span class="o">=</span><span class="s1">&#39;This method has been replaced with primal_idx&#39;</span><span class="p">,</span>
        <span class="n">version</span><span class="o">=</span><span class="s1">&#39;6.0.0.dev0&#39;</span><span class="p">,</span>
        <span class="n">remove_in</span><span class="o">=</span><span class="s1">&#39;6.0&#39;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">variable_idx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">primal_idx</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span></div>

<div class="viewcode-block" id="AmplNLP.primal_idx"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.ampl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AmplNLP.primal_idx">[docs]</a>    <span class="k">def</span> <span class="nf">primal_idx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the index of the primal variable named var_name</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        var_name: str</span>
<span class="sd">            Name of primal variable</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name_to_vidx</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span></div>

<div class="viewcode-block" id="AmplNLP.constraint_idx"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.ampl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AmplNLP.constraint_idx">[docs]</a>    <span class="k">def</span> <span class="nf">constraint_idx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">con_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the index of the constraint named con_name</span>
<span class="sd">        (corresponding to the order returned by evaluate_constraints)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        con_name: str</span>
<span class="sd">            Name of constraint</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name_to_con_full_idx</span><span class="p">[</span><span class="n">con_name</span><span class="p">]</span></div>

<div class="viewcode-block" id="AmplNLP.eq_constraint_idx"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.ampl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AmplNLP.eq_constraint_idx">[docs]</a>    <span class="k">def</span> <span class="nf">eq_constraint_idx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">con_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the index of the equality constraint named con_name</span>
<span class="sd">        (corresponding to the order returned by evaluate_eq_constraints)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        con_name: str</span>
<span class="sd">            Name of constraint</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name_to_con_eq_idx</span><span class="p">[</span><span class="n">con_name</span><span class="p">]</span></div>

<div class="viewcode-block" id="AmplNLP.ineq_constraint_idx"><a class="viewcode-back" href="../../../../../contributed_packages/pynumero/pynumero.interfaces.ampl_nlp.html#pyomo.contrib.pynumero.interfaces.ampl_nlp.AmplNLP.ineq_constraint_idx">[docs]</a>    <span class="k">def</span> <span class="nf">ineq_constraint_idx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">con_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the index of the inequality constraint named con_name</span>
<span class="sd">        (corresponding to the order returned by evaluate_ineq_constraints)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        con_name: str</span>
<span class="sd">            Name of constraint</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name_to_con_ineq_idx</span><span class="p">[</span><span class="n">con_name</span><span class="p">]</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_build_component_names_list</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Builds an ordered list of strings from a file</span>
<span class="sd">        containing strings on separate lines (e.g., the row</span>
<span class="sd">        and col files&quot;&quot;&quot;</span>
        <span class="n">ordered_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">ordered_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ordered_names</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2008-2023, Sandia National Laboratories.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>