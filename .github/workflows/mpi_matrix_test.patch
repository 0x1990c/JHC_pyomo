--- unix_python_matrix_test.yml	2020-04-10 09:36:48.625616329 -0600
+++ mpi_matrix_test.yml	2020-04-10 09:36:34.424518734 -0600
@@ -1,4 +1,4 @@
-name: GitHub CI (unix)
+name: GitHub CI (mpi)
 
 on:
   push:
@@ -9,19 +9,17 @@
       - master
 
 jobs:
-  pyomo-unix-tests:
+  pyomo-mpi-tests:
     name: ${{ matrix.TARGET }}/py${{ matrix.python-version }}
     runs-on: ${{ matrix.os }}
     strategy:
       fail-fast: false
       matrix:
-        os: [macos-latest, ubuntu-latest]
+        os: [ubuntu-latest]
         include:
-        - os: macos-latest
-          TARGET: osx
         - os: ubuntu-latest
           TARGET: linux
-        python-version: [3.5, 3.6, 3.7, 3.8]
+        python-version: [3.7]
 
     steps:
     - uses: actions/checkout@v2
@@ -40,10 +38,12 @@
         path: download-cache
         key: download-v1-${{runner.os}}
 
-    - name: Set up Python ${{ matrix.python-version }}
-      uses: actions/setup-python@v1
+    - name: Setup conda environment
+      uses: s-weigand/setup-conda@v1
       with:
         python-version: ${{ matrix.python-version }}
+        update-conda: true
+        conda-channels: anaconda, conda-forge
 
     - name: Install dependencies
       run: |
@@ -71,6 +71,10 @@
             sudo chmod -R 777 ${GITHUB_WORKSPACE}/pkg-cache
         fi
         echo ""
+        echo "Install conda packages"
+        echo ""
+        conda install mpi4py
+        echo ""
         echo "Upgrade pip..."
         echo ""
         python -m pip install --upgrade pip
@@ -176,12 +180,16 @@
 
     - name: Run Pyomo tests
       run: |
-        echo "Run test.pyomo..."
-        test.pyomo -v --cat="nightly" pyomo `pwd`/pyomo-model-libraries
+        echo "Run Pyomo tests..."
+        # Manually invoke the DAT parser so that parse_table_datacmds.py is
+        # fully generated by a single process before invoking MPI
+        python -c "from pyomo.dataportal.parse_datacmds import parse_data_commands; parse_data_commands(data='')"
+        mpirun -np 3 --oversubscribe nosetests -v --eval-attr="mpi and (not fragile)" \
+            pyomo `pwd`/pyomo-model-libraries
 
     - name: Process code coverage report
       env:
-        GITHUB_JOB_NAME: unix/${{ matrix.TARGET }}/py${{ matrix.python-version }}
+        GITHUB_JOB_NAME: mpi/${{ matrix.TARGET }}/py${{ matrix.python-version }}
       run: |
         find . -maxdepth 10 -name ".cov*"
         coverage combine
