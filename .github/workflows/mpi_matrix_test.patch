--- unix_python_matrix_test.yml	2020-04-13 17:03:42.566313500 -0600
+++ mpi_matrix_test.yml	2020-04-13 17:08:29.573147747 -0600
@@ -1,4 +1,4 @@
-name: GitHub CI (unix)
+name: GitHub CI (mpi)
 
 on:
   push:
@@ -9,19 +9,17 @@
       - master
 
 jobs:
-  pyomo-unix-tests:
+  pyomo-mpi-tests:
     name: ${{ matrix.TARGET }}/py${{ matrix.python-version }}
     runs-on: ${{ matrix.os }}
     strategy:
       fail-fast: false
       matrix:
-        os: [macos-latest, ubuntu-latest]
+        os: [ubuntu-latest]
         include:
-        - os: macos-latest
-          TARGET: osx
         - os: ubuntu-latest
           TARGET: linux
-        python-version: [3.5, 3.6, 3.7, 3.8]
+        python-version: [3.7]
 
     steps:
     - uses: actions/checkout@v2
@@ -40,10 +38,12 @@
         path: download-cache
         key: download-v1-${{runner.os}}
 
-    - name: Set up Python ${{ matrix.python-version }}
-      uses: actions/setup-python@v1
+    - name: Setup conda environment
+      uses: s-weigand/setup-conda@v1
       with:
         python-version: ${{ matrix.python-version }}
+        update-conda: true
+        conda-channels: anaconda, conda-forge
 
     - name: Install dependencies
       run: |
@@ -70,6 +70,10 @@
                 install libopenblas-dev gfortran liblapack-dev
             sudo chmod -R 777 ${GITHUB_WORKSPACE}/pkg-cache
         fi
+        echo "Install conda packages"
+        echo ""
+        conda install mpi4py
+        echo ""
         echo ""
         echo "Upgrade pip..."
         echo ""
@@ -183,11 +187,16 @@
     - name: Run Pyomo tests
       run: |
         echo "Run Pyomo tests..."
-        test.pyomo -v --cat="nightly" pyomo `pwd`/pyomo-model-libraries
+        # Manually invoke the DAT parser so that parse_table_datacmds.py is
+        # fully generated by a single process before invoking MPI
+        python -c "from pyomo.dataportal.parse_datacmds import parse_data_commands; parse_data_commands(data='')"
+        mpirun -np 3 --oversubscribe nosetests -v \
+            --eval-attr="mpi and (not fragile)" \
+            pyomo `pwd`/pyomo-model-libraries
 
     - name: Process code coverage report
       env:
-        GITHUB_JOB_NAME: unix/${{matrix.TARGET}}/py${{matrix.python-version}}
+        GITHUB_JOB_NAME: mpi/${{matrix.TARGET}}/py${{matrix.python-version}}
       run: |
         coverage combine
         coverage report -i
